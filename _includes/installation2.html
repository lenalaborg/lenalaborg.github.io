<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="LENA Support">
<title>Installation</title>
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
@import url(http://fonts.googleapis.com/earlyaccess/notosanskr.css);
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:"Noto Sans KR";-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
* {font-family:"Noto Sans KR","Open Sans","DejaVu Sans",sans-serif !important;}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0; color: #111 !important; font-weight: bold !important;}
h2,h3,h4,h5,h6 {font-weight: bold !important; color: #111 !important;}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
.button{background: #f5f5f5; padding: 2px 5px;}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Sans KR","Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
.admonitionblock table {border-radius: 0px;}
.admonitionblock>table td.icon {width: 0 !important;}
.admonitionblock>table td.content {width: 0 !important;padding-left: 0.125em !important;}
.admonitionblock>table td.content::after {border-left: none !important;}
.admonitionblock.important>table { border: 1px solid #df331259 !important; background-color: rgba(253,243,241,.8); border-left: 3px solid #e04e4e !important; }
.admonitionblock.important>table td.icon > i { display: block; position: absolute; top: 10px; left: 20px; width: 200px; text-align: left; text-shadow: 1px 1px 2px rgba(0,0,0,.0); font-size: 20px !important; background: transparent; }
.admonitionblock.important>table td.icon > i::after { content: "Important"; font-size: 15px; font-weight: 600; padding-left: 8px; margin-top: 0px; display: inline-block; vertical-align: middle; }
.admonitionblock.important>table td.icon > i::before { display: inline-block; vertical-align: middle;color: #e04e4e; }
.admonitionblock.important>table td.content { padding-top: 2.5em; padding-left: 1.8em !important; }
.admonitionblock.note>table { border: 1px solid rgba(0,115,187,.35) !important; background-color: rgba(241,250,255,.8); border-left:3px solid #4273bf !important; }
.admonitionblock.note>table td.icon > i { display: block; position: absolute; top: 10px; left: 20px; width: 200px; text-align: left; text-shadow: 1px 1px 2px rgba(0,0,0,.0); font-size: 20px !important; background: transparent; }
.admonitionblock.note>table td.icon > i::after { content: "Note"; font-size: 15px; font-weight: 600; padding-left: 8px; margin-top: 0px; display: inline-block; vertical-align: middle; }
.admonitionblock.note>table td.icon > i::before { color: #4273bf; }
.admonitionblock.note>table td.icon > i::before { display: inline-block; vertical-align: middle;color: #0073bb; }
.admonitionblock.note>table td.content { padding-top: 2.5em; padding-left: 1.8em !important; }

.admonitionblock table {border: 1px solid #e6e6e6 !important;}
.admonitionblock th, .admonitionblock td { position: relative;  vertical-align: middle; border-bottom: 1px solid #e6e6e6;}
.admonitionblock tr:last-child th, .admonitionblock tr:last-child td {border: none !important;}
.admonitionblock td li:last-child p {margin-bottom: 0;}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:15px;line-height:1.3;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Noto Sans KR","Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#111;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:3em !important;}
h2{font-size:2.35em !important; }
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.875em !important;}
h4{font-size:1.6em !important;}
h5{font-size:1.4em !important;}
h6{font-size:1.125em !important;}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code[data-lang="bash"]{font-family:Consolas,"Courier New",monospace !important;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
.paragraph a { display: inline-block; margin-bottom: 1.25rem;}
    
@media screen and (min-width:768px) {
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2em; margin-bottom: 1em;}
h3{font-size:1.6em; margin-top: 1.2em; margin-bottom: .85em;}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.3em; margin-top: 1.5em; margin-bottom: .85em;}
h4>a { color: #333; }
h5{font-size:1.15em; margin-top: 1.5em; margin-bottom: .85em;}
h6{font-size:1em; margin-top: 1.5em; margin-bottom: .85em;}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:0.25rem 0.25rem; font-size: 0.85em; height: 40px; vertical-align: middle !important;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6;font-size: 0.85em; height: 40px; vertical-align: middle !important;}
    table tbody tr td {height: 45px;}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Noto Sans KR","Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Noto Sans KR","Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
.button {font-weight: bold; color: #c40352;}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:2.25em;padding-bottom:5.25em;padding-left:.25em;font-size: 0.85em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Noto Sans KR","Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc ul.sectlevel1 > li > a { font-size: 1.2em; font-weight: 500; }
#toc ul li a { color: #222; line-height: 1.5; }
#toc ul li ul.sectlevel2 li a { font-size: 0.95em; color: #666; }
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518; font-size: 1.0em; font-weight: 400;}

@media screen and (min-width:768px){
#toctitle{font-size:1.375em !important;}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){
body.toc2{padding-left:23em;padding-right:3em}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.2em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#111;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Sans KR","Noto Serif","DejaVu Serif",serif;font-size:0.8rem; color: #70767b;}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph>.title { font-size: 1em; }
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Noto Sans KR","Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;color:rgba(0,0,0,.6); position:relative;}
.admonitionblock>table td.content:after {content:''; display: block; width: 1px; height:80%; position: absolute; left: 0; top: 10%; border-left: 1px solid #e6e6e6;}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Noto Sans KR","Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:15px;}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0; text-align: center; background: none !important; color: #111; font-weight: bold;}
table.grid-all>thead>tr>td.tableblock,table.grid-all>tbody>tr>td.tableblock {text-align: left;}
table.grid-all>tbody>tr>td.tableblock p {font-size: 1em;}   
table.grid-all>thead>tr:nth-child(even)>td {background: #f8f9fa !important;}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock {}
.imageblock .content { box-shadow: 0px 3px 10px 0 rgba(0, 0, 0, 0.16); padding: 10px 3%; text-align: center; margin-bottom: 10px; border: 1px solid #e6e6e6; border-radius: 6px;}
.imageblock .content img {width: 94%;}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.fa {font: normal normal normal 30px/1 FontAwesome !important;}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default; font-family: FontAwesome;}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Noto Sans KR","Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:15px; line-height: 1.6}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

pre.CodeRay {background-color:#f7f7f8; border: 1px solid #e6e6e6; border-radius: 10px;}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Installation</h1>
<div class="details">
<span id="author" class="author">LENA Support</span><br>
<span id="email" class="email"><a href="mailto:lena-support@lgcns.com">lena-support@lgcns.com</a></span><br>
<span id="revnumber">version 1.5.0.1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. OVERVIEW</a>
<ul class="sectlevel2">
<li><a href="#_구성요소">1.1. 구성요소</a>
<ul class="sectlevel3">
<li><a href="#_server">1.1.1. Server</a></li>
<li><a href="#_agent_advertiser">1.1.2. Agent, Advertiser</a></li>
<li><a href="#_manager">1.1.3. Manager</a></li>
</ul>
</li>
<li><a href="#_mechanism">1.2. Mechanism</a></li>
<li><a href="#_제공_asset">1.3. 제공 Asset</a></li>
<li><a href="#_시스템_요구사항">1.4. 시스템 요구사항</a></li>
</ul>
</li>
<li><a href="#_architecture_결정사항">2. Architecture 결정사항</a>
<ul class="sectlevel2">
<li><a href="#_절차">2.1. 절차</a></li>
<li><a href="#_container_운영_환경에_대한_고려사항">2.2. Container 운영 환경에 대한 고려사항</a>
<ul class="sectlevel3">
<li><a href="#_container_플랫폼_별_운영환경_특성">2.2.1. Container 플랫폼 별 운영환경 특성</a>
<ul class="sectlevel4">
<li><a href="#_kubernetes">Kubernetes</a></li>
<li><a href="#_docker_swarm">Docker Swarm</a></li>
<li><a href="#_ecs">ECS</a></li>
<li><a href="#_container_플랫폼_별_특성_종합">Container 플랫폼 별 특성 종합</a></li>
</ul>
</li>
<li><a href="#_lena_server_유형별_운영방식">2.2.2. LENA Server 유형별 운영방식</a></li>
</ul>
</li>
<li><a href="#_공통_고려사항">2.3. 공통 고려사항</a>
<ul class="sectlevel3">
<li><a href="#_os">2.3.1. OS</a></li>
<li><a href="#_jdk">2.3.2. JDK</a></li>
<li><a href="#_실행_user">2.3.3. 실행 User</a></li>
<li><a href="#_library">2.3.4. Library</a></li>
</ul>
</li>
<li><a href="#_server_유형별_고려사항_manager">2.4. Server 유형별 고려사항 – Manager</a>
<ul class="sectlevel3">
<li><a href="#architecture_decision-manager-deployment">2.4.1. 배포</a></li>
<li><a href="#_사양">2.4.2. 사양</a>
<ul class="sectlevel4">
<li><a href="#_memory">Memory</a></li>
<li><a href="#_disk">Disk</a></li>
</ul>
</li>
<li><a href="#_설정">2.4.3. 설정</a>
<ul class="sectlevel4">
<li><a href="#_네트워크">네트워크</a></li>
<li><a href="#architecture_decision_manager_env">환경변수</a></li>
<li><a href="#_directory_구조">Directory 구조</a></li>
<li><a href="#_log_dump_출력">Log &amp; Dump 출력</a></li>
<li><a href="#architecture_decision-manager-healthcheck">Health Check</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_server_유형별_고려사항_session_server">2.5. Server 유형별 고려사항 – Session Server</a>
<ul class="sectlevel3">
<li><a href="#architecture_decision-session-deployment">2.5.1. 배포</a></li>
<li><a href="#_사양_2">2.5.2. 사양</a>
<ul class="sectlevel4">
<li><a href="#_memory_2">Memory</a></li>
<li><a href="#_disk_2">Disk</a></li>
<li><a href="#_설정_2">설정</a></li>
<li><a href="#_네트워크_2">네트워크</a></li>
<li><a href="#architecture_decision_session_env">환경변수</a></li>
<li><a href="#_directory_구조_2">Directory 구조</a></li>
<li><a href="#_log">Log</a></li>
<li><a href="#_health_check">Health Check</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_server_유형별_고려사항_was">2.6. Server 유형별 고려사항 – WAS</a>
<ul class="sectlevel3">
<li><a href="#architecture_decision-was-deployment">2.6.1. 배포</a></li>
<li><a href="#_사양_3">2.6.2. 사양</a>
<ul class="sectlevel4">
<li><a href="#_memory_3">Memory</a></li>
<li><a href="#_disk_3">Disk</a></li>
</ul>
</li>
<li><a href="#_설정_3">2.6.3. 설정</a>
<ul class="sectlevel4">
<li><a href="#architecture_decision-app-network">네트워크</a></li>
<li><a href="#architecture_decision_application_env">환경변수</a></li>
<li><a href="#_directory_구조_3">Directory 구조</a></li>
<li><a href="#architecture_decision_app-logoutput">Log &amp; Dump 출력</a></li>
<li><a href="#_health_check_2">Health Check</a></li>
<li><a href="#architecture_decision-app-config">Server Configuration 관리</a></li>
<li><a href="#architecture_decision-app-imageBuild">Container Image Build</a></li>
<li><a href="#_application_배포">Application 배포</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_server_유형별_고려사항_embedded_was">2.7. Server 유형별 고려사항 – Embedded WAS</a>
<ul class="sectlevel3">
<li><a href="#architecture_decision-was-deployment">2.7.1. 배포</a></li>
<li><a href="#_사양_4">2.7.2. 사양</a>
<ul class="sectlevel4">
<li><a href="#_memory_4">Memory</a></li>
<li><a href="#_disk_4">Disk</a></li>
</ul>
</li>
<li><a href="#_설정_4">2.7.3. 설정</a>
<ul class="sectlevel4">
<li><a href="#architecture_decision-app-network">네트워크</a></li>
<li><a href="#architecture_decision_embedded_application_env">환경변수</a></li>
<li><a href="#_directory_구조_4">Directory 구조</a></li>
<li><a href="#architecture_decision_embedded_app-logoutput">Log &amp; Dump 출력</a></li>
<li><a href="#_health_check_3">Health Check</a></li>
<li><a href="#architecture_decision-app-imageBuild">Container Image Build</a></li>
<li><a href="#_application_배포_2">Application 배포</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_server_유형별_고려사항_web_server">2.8. Server 유형별 고려사항 – Web Server</a>
<ul class="sectlevel3">
<li><a href="#_배포">2.8.1. 배포</a></li>
<li><a href="#_사양_5">2.8.2. 사양</a>
<ul class="sectlevel4">
<li><a href="#_memory_5">Memory</a></li>
<li><a href="#_disk_5">Disk</a></li>
</ul>
</li>
<li><a href="#_설정_5">2.8.3. 설정</a>
<ul class="sectlevel4">
<li><a href="#_네트워크_3">네트워크</a></li>
<li><a href="#architecture_decision_web_env">환경변수</a></li>
<li><a href="#_directory_구조_5">Directory 구조</a></li>
<li><a href="#_log_2">Log</a></li>
<li><a href="#_health_check_4">Health Check</a></li>
<li><a href="#_server_configuration_관리">Server Configuration 관리</a></li>
<li><a href="#_container_image_build">Container Image Build</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_설치_공통_사항">3. 설치 공통 사항</a>
<ul class="sectlevel2">
<li><a href="#_설치_준비">3.1. 설치 준비</a></li>
<li><a href="#installation_prerequistes-baseImage">3.2. Base Image 생성</a>
<ul class="sectlevel3">
<li><a href="#_base_image_생성_절차">3.2.1. Base Image 생성 절차</a>
<ul class="sectlevel4">
<li><a href="#_dockerfile_작성">Dockerfile 작성</a></li>
<li><a href="#_docker_image_빌드">Docker Image 빌드</a></li>
<li><a href="#_docker_image_등록">Docker Image 등록</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_kubernetes_기반_배포">4. Kubernetes 기반 배포</a>
<ul class="sectlevel2">
<li><a href="#_배포_공통사항">4.1. 배포 공통사항</a>
<ul class="sectlevel3">
<li><a href="#_배포_준비">4.1.1. 배포 준비</a></li>
<li><a href="#_배포_실행">4.1.2. 배포 실행</a>
<ul class="sectlevel4">
<li><a href="#_작업_namespace의_설정">작업 namespace의 설정</a></li>
<li><a href="#_kubernetes_resource배포_및_업데이트">Kubernetes Resource배포 및 업데이트</a></li>
<li><a href="#_kubernetes_resource의_삭제">Kubernetes Resource의 삭제</a></li>
<li><a href="#_workload_업데이트_및_롤백">Workload 업데이트 및 롤백</a></li>
<li><a href="#_배포된_resource의_확인">배포된 Resource의 확인</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_manager_배포">4.2. Manager 배포</a>
<ul class="sectlevel3">
<li><a href="#_설정_항목">4.2.1. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_workload_관련">적용시점 결정 항목 – Workload 관련</a></li>
<li><a href="#_적용시점_결정_항목_service관련">적용시점 결정 항목 – Service관련</a></li>
</ul>
</li>
<li><a href="#_manifest_기반_배포">4.2.2. Manifest 기반 배포</a>
<ul class="sectlevel4">
<li><a href="#_workload">Workload</a></li>
<li><a href="#_service">Service</a></li>
</ul>
</li>
<li><a href="#_manager_접속">4.2.3. Manager 접속</a></li>
</ul>
</li>
<li><a href="#_session_server_배포">4.3. Session Server 배포</a>
<ul class="sectlevel3">
<li><a href="#kubernetes_based_deployment-session-prepare">4.3.1. 배포 준비</a></li>
<li><a href="#_설정_항목_2">4.3.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_2">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_workload_관련_2">적용시점 결정 항목 – Workload 관련</a></li>
<li><a href="#_적용시점_결정_항목_service관련_2">적용시점 결정 항목 – Service관련</a></li>
</ul>
</li>
<li><a href="#_manifest_기반_배포_2">4.3.3. Manifest 기반 배포</a>
<ul class="sectlevel4">
<li><a href="#_workload_2">Workload</a></li>
<li><a href="#_service_2">Service</a></li>
</ul>
</li>
<li><a href="#_server_등록_확인">4.3.4. Server 등록 확인</a></li>
</ul>
</li>
<li><a href="#_was_배포">4.4. WAS 배포</a>
<ul class="sectlevel3">
<li><a href="#kubernetes_based_deployment-application-prepare">4.4.1. 배포 준비</a></li>
<li><a href="#_설정_항목_3">4.4.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_3">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_workload_관련_3">적용시점 결정 항목 – Workload 관련</a></li>
<li><a href="#_적용시점_결정_항목_service관련_3">적용시점 결정 항목 – Service관련</a></li>
</ul>
</li>
<li><a href="#_manifest_기반_배포_3">4.4.3. Manifest 기반 배포</a>
<ul class="sectlevel4">
<li><a href="#_workload_3">Workload</a></li>
<li><a href="#_service_3">Service</a></li>
</ul>
</li>
<li><a href="#_server_등록_확인_2">4.4.4. Server 등록 확인</a></li>
</ul>
</li>
<li><a href="#_embedded_was_배포">4.5. Embedded WAS 배포</a>
<ul class="sectlevel3">
<li><a href="#kubernetes_based_deployment-embedded-application-prepare">4.5.1. 배포 준비</a></li>
<li><a href="#_설정_항목_4">4.5.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_4">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_workload_관련_4">적용시점 결정 항목 – Workload 관련</a></li>
<li><a href="#_적용시점_결정_항목_service관련_4">적용시점 결정 항목 – Service관련</a></li>
</ul>
</li>
<li><a href="#_manifest_기반_배포_4">4.5.3. Manifest 기반 배포</a>
<ul class="sectlevel4">
<li><a href="#_workload_4">Workload</a></li>
<li><a href="#_service_4">Service</a></li>
</ul>
</li>
<li><a href="#_server_등록_확인_3">4.5.4. Server 등록 확인</a></li>
</ul>
</li>
<li><a href="#_web_server_배포">4.6. Web Server 배포</a>
<ul class="sectlevel3">
<li><a href="#kubernetes_based_deployment-web-prepare">4.6.1. 배포 준비</a></li>
<li><a href="#_설정_항목_5">4.6.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_5">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_workload_관련_5">적용시점 결정 항목 – Workload 관련</a></li>
<li><a href="#_적용시점_결정_항목_service관련_5">적용시점 결정 항목 – Service관련</a></li>
</ul>
</li>
<li><a href="#_manifest_기반_배포_5">4.6.3. Manifest 기반 배포</a>
<ul class="sectlevel4">
<li><a href="#_workload_5">Workload</a></li>
<li><a href="#_service_5">Service</a></li>
</ul>
</li>
<li><a href="#_server_등록_확인_4">4.6.4. Server 등록 확인</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_docker_swarm_기반_배포">5. Docker Swarm 기반 배포</a>
<ul class="sectlevel2">
<li><a href="#_배포_공통사항_2">5.1. 배포 공통사항</a>
<ul class="sectlevel3">
<li><a href="#_배포_준비_2">5.1.1. 배포 준비</a>
<ul class="sectlevel4">
<li><a href="#_swarm_cluster의_구성">Swarm Cluster의 구성</a></li>
<li><a href="#_overlay_network_구성">Overlay Network 구성</a></li>
</ul>
</li>
<li><a href="#_배포_실행_2">5.1.2. 배포 실행</a>
<ul class="sectlevel4">
<li><a href="#_docker_service_배포">Docker Service 배포</a></li>
<li><a href="#_docker_service_갱신">Docker Service 갱신</a></li>
<li><a href="#_docker_service_rollback">Docker Service Rollback</a></li>
<li><a href="#_docker_service_삭제">Docker Service 삭제</a></li>
<li><a href="#_docker_service_조회">Docker Service 조회</a></li>
<li><a href="#_compose_파일_service_명세서_의_활용">Compose 파일 (Service 명세서) 의 활용</a></li>
<li><a href="#_stack의_구성">Stack의 구성</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_manager_배포_2">5.2. Manager 배포</a>
<ul class="sectlevel3">
<li><a href="#_설정_항목_6">5.2.1. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_6">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_service관련_6">적용시점 결정 항목 – Service관련</a></li>
</ul>
</li>
<li><a href="#_명세서_compose_파일_기반_배포">5.2.2. 명세서 (Compose 파일) 기반 배포</a></li>
<li><a href="#_manager_접속_2">5.2.3. Manager 접속</a></li>
</ul>
</li>
<li><a href="#_session_server_배포_2">5.3. Session Server 배포</a>
<ul class="sectlevel3">
<li><a href="#_배포_준비_3">5.3.1. 배포 준비</a></li>
<li><a href="#_설정_항목_7">5.3.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_7">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_service_관련">적용시점 결정 항목 – Service 관련</a></li>
</ul>
</li>
<li><a href="#_docker_compose_기반_배포">5.3.3. Docker Compose 기반 배포</a></li>
<li><a href="#_server_등록_확인_5">5.3.4. Server 등록 확인</a></li>
</ul>
</li>
<li><a href="#_was_배포_2">5.4. WAS 배포</a>
<ul class="sectlevel3">
<li><a href="#_배포_준비_4">5.4.1. 배포 준비</a></li>
<li><a href="#_설정_항목_8">5.4.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_8">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_service_관련_2">적용시점 결정 항목 – Service 관련</a></li>
</ul>
</li>
<li><a href="#_명세서_compose_파일_기반_배포_2">5.4.3. 명세서 (Compose 파일) 기반 배포</a></li>
<li><a href="#_server_등록_확인_6">5.4.4. Server 등록 확인</a></li>
</ul>
</li>
<li><a href="#_embedded_was_배포_2">5.5. Embedded WAS 배포</a>
<ul class="sectlevel3">
<li><a href="#_배포_준비_5">5.5.1. 배포 준비</a></li>
<li><a href="#_설정_항목_9">5.5.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_9">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_service_관련_3">적용시점 결정 항목 – Service 관련</a></li>
</ul>
</li>
<li><a href="#_명세서_compose_파일_기반_배포_3">5.5.3. 명세서 (Compose 파일) 기반 배포</a></li>
<li><a href="#_server_등록_확인_7">5.5.4. Server 등록 확인</a></li>
</ul>
</li>
<li><a href="#_web_server_배포_2">5.6. Web Server 배포</a>
<ul class="sectlevel3">
<li><a href="#_배포_준비_6">5.6.1. 배포 준비</a></li>
<li><a href="#_설정_항목_10">5.6.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_10">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_service_관련_4">적용시점 결정 항목 – Service 관련</a></li>
</ul>
</li>
<li><a href="#_명세서_compose_파일_기반_배포_4">5.6.3. 명세서 (Compose 파일) 기반 배포</a></li>
<li><a href="#_server_등록_확인_8">5.6.4. Server 등록 확인</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ecs_기반_설치">6. ECS 기반 설치</a>
<ul class="sectlevel2">
<li><a href="#_ecs_개요">6.1. ECS 개요</a></li>
<li><a href="#_설치_준비_2">6.2. 설치 준비</a></li>
<li><a href="#_manager_배포_3">6.3. Manager 배포</a>
<ul class="sectlevel3">
<li><a href="#ecs_based_deployment-mgr_config">6.3.1. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_11">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목">적용시점 결정 항목</a></li>
</ul>
</li>
<li><a href="#_task_설정">6.3.2. Task 설정</a>
<ul class="sectlevel4">
<li><a href="#_task_정의">Task 정의</a></li>
<li><a href="#_volume_추가">Volume 추가</a></li>
<li><a href="#_container_추가">Container 추가</a></li>
<li><a href="#_환경변수_설정">환경변수 설정</a></li>
<li><a href="#_health_check_설정">Health Check 설정</a></li>
<li><a href="#_volume_매핑">Volume 매핑</a></li>
</ul>
</li>
<li><a href="#_service_설정">6.3.3. Service 설정</a>
<ul class="sectlevel4">
<li><a href="#_서비스_정의">서비스 정의</a></li>
<li><a href="#_서비스_검색_service_discovery_설정">서비스 검색 (Service Discovery) 설정</a></li>
</ul>
</li>
<li><a href="#_service_기동_및_확인">6.3.4. Service 기동 및 확인</a>
<ul class="sectlevel4">
<li><a href="#_service_상태_확인">Service 상태 확인</a></li>
<li><a href="#_task_상태_확인">Task 상태 확인</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_session_server_배포_3">6.4. Session Server 배포</a>
<ul class="sectlevel3">
<li><a href="#_배포_준비_7">6.4.1. 배포 준비</a></li>
<li><a href="#ecs_based_deployment-ses_config">6.4.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_12">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_2">적용시점 결정 항목</a></li>
</ul>
</li>
<li><a href="#_task_설정_2">6.4.3. Task 설정</a>
<ul class="sectlevel4">
<li><a href="#_task_정의_2">Task 정의</a></li>
<li><a href="#_container_추가_2">Container 추가</a></li>
<li><a href="#_환경변수_설정_2">환경변수 설정</a></li>
</ul>
</li>
<li><a href="#_service_설정_2">6.4.4. Service 설정</a>
<ul class="sectlevel4">
<li><a href="#_서비스_정의_2">서비스 정의</a></li>
<li><a href="#_서비스_검색_service_discovery_설정_2">서비스 검색 (Service Discovery) 설정</a></li>
</ul>
</li>
<li><a href="#_service_기동_및_확인_2">6.4.5. Service 기동 및 확인</a>
<ul class="sectlevel4">
<li><a href="#_service_상태_확인_2">Service 상태 확인</a></li>
<li><a href="#_task_상태_확인_2">Task 상태 확인</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_was_배포_3">6.5. WAS 배포</a>
<ul class="sectlevel3">
<li><a href="#_배포_준비_8">6.5.1. 배포 준비</a></li>
<li><a href="#ecs_based_deployment_app_config">6.5.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_13">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_3">적용시점 결정 항목</a></li>
</ul>
</li>
<li><a href="#_task_설정_3">6.5.3. Task 설정</a>
<ul class="sectlevel4">
<li><a href="#_task정의">Task정의</a></li>
<li><a href="#_container_추가_3">Container 추가</a></li>
<li><a href="#_환경변수_설정_3">환경변수 설정</a></li>
</ul>
</li>
<li><a href="#_service_설정_3">6.5.4. Service 설정</a>
<ul class="sectlevel4">
<li><a href="#_서비스_정의_3">서비스 정의</a></li>
<li><a href="#_서비스_검색_service_discovery_설정_3">서비스 검색 (Service Discovery) 설정</a></li>
</ul>
</li>
<li><a href="#_service_기동_및_확인_3">6.5.5. Service 기동 및 확인</a>
<ul class="sectlevel4">
<li><a href="#_service_상태_확인_3">Service 상태 확인</a></li>
<li><a href="#_task_상태_확인_3">Task 상태 확인</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_embedded_was_배포_3">6.6. Embedded WAS 배포</a>
<ul class="sectlevel3">
<li><a href="#_배포_준비_9">6.6.1. 배포 준비</a></li>
<li><a href="#ecs_based_deployment_embedded_app_config">6.6.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_14">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_4">적용시점 결정 항목</a></li>
</ul>
</li>
<li><a href="#_task_설정_4">6.6.3. Task 설정</a>
<ul class="sectlevel4">
<li><a href="#_task정의_2">Task정의</a></li>
<li><a href="#_container_추가_4">Container 추가</a></li>
<li><a href="#_환경변수_설정_4">환경변수 설정</a></li>
</ul>
</li>
<li><a href="#_service_설정_4">6.6.4. Service 설정</a>
<ul class="sectlevel4">
<li><a href="#_서비스_정의_4">서비스 정의</a></li>
<li><a href="#_서비스_검색_service_discovery_설정_4">서비스 검색 (Service Discovery) 설정</a></li>
</ul>
</li>
<li><a href="#_service_기동_및_확인_4">6.6.5. Service 기동 및 확인</a>
<ul class="sectlevel4">
<li><a href="#_service_상태_확인_4">Service 상태 확인</a></li>
<li><a href="#_task_상태_확인_4">Task 상태 확인</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_web_server_배포_3">6.7. Web Server 배포</a>
<ul class="sectlevel3">
<li><a href="#_배포준비">6.7.1. 배포준비</a></li>
<li><a href="#ecs_based_deployment_web_config">6.7.2. 설정 항목</a>
<ul class="sectlevel4">
<li><a href="#_기본_설정_항목_15">기본 설정 항목</a></li>
<li><a href="#_적용시점_결정_항목_5">적용시점 결정 항목</a></li>
</ul>
</li>
<li><a href="#_task_설정_5">6.7.3. Task 설정</a>
<ul class="sectlevel4">
<li><a href="#_task정의_3">Task정의</a></li>
<li><a href="#_container_추가_5">Container 추가</a></li>
<li><a href="#_환경변수_설정_5">환경변수 설정</a></li>
</ul>
</li>
<li><a href="#_service_설정_5">6.7.4. Service 설정</a>
<ul class="sectlevel4">
<li><a href="#_서비스_정의_5">서비스 정의</a></li>
<li><a href="#_서비스_검색_service_discovery_설정_5">서비스 검색 (Service Discovery) 설정</a></li>
</ul>
</li>
<li><a href="#_service_기동_및_확인_5">6.7.5. Service 기동 및 확인</a>
<ul class="sectlevel4">
<li><a href="#_service_상태_확인_5">Service 상태 확인</a></li>
<li><a href="#_task_상태_확인_5">Task 상태 확인</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_vmhost_기반_설치">7. VM/Host 기반 설치</a>
<ul class="sectlevel2">
<li><a href="#_설치준비">7.1. 설치준비</a></li>
<li><a href="#_lena_설치">7.2. LENA 설치</a></li>
<li><a href="#_디렉토리_구성">7.3. 디렉토리 구성</a></li>
<li><a href="#_manager_설치">7.4. Manager 설치</a>
<ul class="sectlevel3">
<li><a href="#_manager_설치_2">7.4.1. Manager 설치</a></li>
<li><a href="#_manager_실행">7.4.2. Manager 실행</a></li>
</ul>
</li>
<li><a href="#_node_agent_실행">7.5. Node Agent 실행</a>
<ul class="sectlevel3">
<li><a href="#_node_agent_실행_2">7.5.1. Node Agent 실행</a></li>
<li><a href="#_node_agent_동작_여부_확인">7.5.2. Node Agent 동작 여부 확인</a></li>
<li><a href="#_node_agent_종료">7.5.3. Node Agent 종료</a></li>
</ul>
</li>
<li><a href="#_session_server_설치_web_ui_기반">7.6. Session Server 설치 (WEB UI 기반)</a>
<ul class="sectlevel3">
<li><a href="#_session_server_설치">7.6.1. Session Server 설치</a></li>
<li><a href="#_server_실행">7.6.2. Server 실행</a></li>
<li><a href="#_server_삭제">7.6.3. Server 삭제</a></li>
<li><a href="#_server_등록">7.6.4. Server 등록</a></li>
</ul>
</li>
<li><a href="#_session_server_설치_cli_기반">7.7. Session Server 설치 (CLI 기반)</a>
<ul class="sectlevel3">
<li><a href="#_session_server_설치_2">7.7.1. Session Server 설치</a></li>
<li><a href="#_session_server_실행">7.7.2. Session Server 실행</a></li>
<li><a href="#_session_server_삭제">7.7.3. Session Server 삭제</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_별첨">8. 별첨</a>
<ul class="sectlevel2">
<li><a href="#_lena_지원_spec별_버전">8.1. LENA 지원 Spec별 버전</a></li>
<li><a href="#_manager_db파일_백업">8.2. Manager DB파일 백업</a></li>
<li><a href="#_manager_의_내부이력_삭제">8.3. Manager 의 내부이력 삭제</a></li>
<li><a href="#_manager_의_admin_패스워드_초기화">8.4. Manager 의 admin 패스워드 초기화</a></li>
<li><a href="#_lena_설치_권장_os파라미터centos기준">8.5. LENA 설치 권장 OS파라미터(CentOS기준)</a></li>
<li><a href="#_lena_주기적으로_증가하는_파일">8.6. LENA 주기적으로 증가하는 파일</a></li>
<li><a href="#_was_image_os_참조자료">8.7. WAS Image OS 참조자료</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_overview"><a class="link" href="#_overview">1. OVERVIEW</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>본문서는 Container 기반 LENA Server를 운영하기 앞서 필요한
Architecture결정요소와 설치에 대해 기술한다. LENA 의 전체 기능 및 운영에
대한 내용은 별도로 제공되는 운영자 매뉴얼을 참고한다.</p>
</div>
<div class="paragraph">
<p>본 문서는 LENA 1.3.1c 버전을 기준으로 기술하고, 다음과 같은 내용을
포함한다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LENA for Container 아키텍처 결정요소</p>
<div class="ulist">
<ul>
<li>
<p>적용환경에 대한 고려사항</p>
</li>
<li>
<p>Server 유형별 고려사항</p>
</li>
</ul>
</div>
</li>
<li>
<p>LENA for Container 설치</p>
<div class="ulist">
<ul>
<li>
<p>Base Image Build</p>
</li>
<li>
<p>Kubernetes 기반 설치</p>
</li>
<li>
<p>Docker 기반 설치</p>
</li>
<li>
<p>ECS 기반 설치</p>
</li>
<li>
<p>VM / Host 기반 설치 (Manager, Session Server)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_구성요소"><a class="link" href="#_구성요소">1.1. 구성요소</a></h3>
<div class="paragraph">
<p>LENA는 Web Server, Application Server, Session Server와 Web Server의
Status를 확인하는 Node Agent, Application Server에 설치되어 Status정보를
제공하는 Advertiser와 관리자에게 제공되는 통합관리 도구인 Manager로
구성된다.</p>
</div>
<div class="sect3">
<h4 id="_server"><a class="link" href="#_server">1.1.1. Server</a></h4>
<div class="paragraph">
<p>LENA에서 제공되는 서버의 종류는 Web Server, Application Server, Session
Server 3가지가 있다. 각 서버의 용도는 아래와 같다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Web Server: 사용자 요청에 따라 Web Resource를 제공한다. Application
Server가 제공하는 응용서비스의 Front역할을 수행하면서, 선택적으로 Load
Balancing 및 보안 레이어(SSL)를 제공하는 역할을 수행한다.</p>
</li>
<li>
<p>Application Server: Java로 작성된 응용 서비스를 실행/제공 한다.</p>
</li>
<li>
<p>Session Server: Application Server간 사용자의 세션을 유지한다.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_agent_advertiser"><a class="link" href="#_agent_advertiser">1.1.2. Agent, Advertiser</a></h4>
<div class="paragraph">
<p>Node, Server에 설치되어 제어 및 모니터링 기능을 담당하는 Agent 이다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node Agent</p>
<div class="ulist">
<ul>
<li>
<p>Web Server 상태 모니터링 데이터를 취합하여 Manager에게 제공한다.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Advertiser</p>
<div class="ulist">
<ul>
<li>
<p>Application Server 상태 모니터링 데이터를 취합하여 Manager에게
제공한다.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_manager"><a class="link" href="#_manager">1.1.3. Manager</a></h4>
<div class="paragraph">
<p>Manager는 Node Agent와 Advertiser를 통하여 Node와 Server의 제어 및
모니터링 기능 등을 제공하는Web Application이다. 대표적으로 아래와 같은
기능을 제공한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">항목</th>
<th class="tableblock halign-left valign-top">설명</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dashboard</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Server, Service Cluster 현황</p>
</li>
<li>
<p>Notification 확인</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>System (논리적 Server 그룹) 등록/수정/삭제</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Cluster</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 등록/수정/삭제</p>
</li>
<li>
<p>등록된 Server 목록, 이력 조회</p>
</li>
<li>
<p>Service Cluster 템플릿, Revision 관리</p>
</li>
<li>
<p>설정 Template 다운로드를 통한 CICD 연계 기능</p>
</li>
<li>
<p>원격 Terminal 및 Standard Out/Error Log 조회 (Kubernetes에 한함)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Resource (Database, DataSource, Application,k8s config)
등록/수정/삭제/조회</p>
</li>
<li>
<p>Resource를 사용하는 Server 목록 조회 및 추가/제거</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diagnostics</p>
<p class="tableblock">(모니터링)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Server에 대한 이슈 현황 모니터링 기능</p>
</li>
<li>
<p>Server에서 발생한 Event 조회 기능</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Topology</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>System별 Server 구성현황 조회</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>사용자 및 권한 관리, 사용자/권한/메뉴 매핑</p>
</li>
<li>
<p>사용자 운영 이력 조회</p>
</li>
<li>
<p>라이선스 관리, 현황 조회 및 업로드</p>
</li>
<li>
<p>Cloud Profile 관리</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_mechanism"><a class="link" href="#_mechanism">1.2. Mechanism</a></h3>
<div class="paragraph">
<p>LENA는 Manager를 통해서 Web/Application 서버를 모니터링 및 통합 관리하는
기능을 제공한다. 다만, 기존 Host/VM방식과의 환경적 차이점은
Container에서 구동되는 Server는 Orchestration도구에 의해 실행이
제어되며, State를 가지지 않는다는 점이다.</p>
</div>
<div class="paragraph">
<p>따라서, 기존 Host/VM 환경에서 Agent를 통한 실시간 제어/설정 관리 방식
대신 개별 Server가 Container기동 시점에 Manager를 통해 설정정보 및
라이선스를 다운로드 받는 방식으로 설정정보를 제공하고, 기동된 Server의
상태를 Manager를 통해서 모니터링 하는 방식으로 관리한다.</p>
</div>
<div class="paragraph">
<p>Server외의 구성요소로는 기동 시 다운로드 및 초기설정 기능을 사용하기
위해서는 각 Server는 Container시작 Command로 활용되는
docker-entrypoint.sh가 있고, 운영되는 Server의 상태를 전송하기 위해 Web
서버에는 Node Agent가 설치되고 Application 및 Session Server는 내장된
모듈을 활용한다.</p>
</div>
<div class="paragraph">
<p>WEB-WAS 연계 부분에서도 기존 VM/Host 환경과의 차이가 존재한다.
Container의 생성/소멸에 따라 IP나 주소가 변동적인 환경에서 Back-End
Application Container와의 지속적인 연결을 유지하기 위해서는
Load-balancer가 필요하며, 이는 Kubernetes/Docker Swarm의 Service나 ECS의 Service Discovery, EKS/ECS의 ELB 형태로 제공되고 있다. 기존 VM/Host 환경에서
WEB-WAS를 직접 연결하고 WEB 서버가 직접 Load-balancing을 수행했던 방식은
Container환경에서는 제공되지 않고 플랫폼이 제공하는 Service 주소(Service Endpoint)로 Reverse Proxy 연결을 제공한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/overview_2_fully_container.png" alt="FullyContainer" width="623" height="471">
</div>
<div class="title">Figure 1. Container 기반 LENA Server간 연계 구조 (Kubernetes 환경)</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Server</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Application Server Instance</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Server</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Web Server Instance</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Session Server Instance</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>서버에 배포되는 설정파일 관리 및 Server 모니터링 기능 제공</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager Repository</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Manager 운영을 위한 파일저장 Repository, 각 종
설정정보 및 DB 정보를 포함함</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">외부저장소로 분리가능</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">docker-entrypoint.sh</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Container 기동시에 실행되는 Shell Script</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>기동시점에 설정정보 초기화</p>
</li>
<li>
<p>Manager로 부터 설정정보/라이선스 다운로드</p>
</li>
<li>
<p>서버 기동 기능을 수행함</p>
</li>
</ol>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node Agent</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Web 서버 모니터링 데이터 취합 및 Manager에게 송신,
Manager로부터 수신한 제어/설정 명령 실행</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advertiser</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>모니터링 데이터 취합 및 Manager에게 송신</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application
Server에 통합</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Container 운영환경의 특성이나 제약에 따라 Session Server 나 Manager를
VM/Host환경에서 운영할 수 도 있고, LENA Manager는 Container형 LENA
Server 뿐아니라, VM/Host 기반 LENA Server를 관리하는 기능도 포함하고
있으므로, 다음과 같은 아키텍처로 운영될 수도 있다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/overview_2_vmhost_container.png" alt="vmhost" width="623" height="471">
</div>
<div class="title">Figure 2. Container -VM/Host 혼합 환경에서의 LENA Server간 연계 구조</div>
</div>
</div>
<div class="sect2">
<h3 id="_제공_asset"><a class="link" href="#_제공_asset">1.3. 제공 Asset</a></h3>
<div class="paragraph">
<p>LENA for Container 버전에서는 다음과 같은 Asset 제공된다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker Image : Linux OS + JDK + LENA Server + 필요 Library가 포함된
Image를 Docker Hub를 통해서 제공</p>
<div class="ulist">
<ul>
<li>
<p>Web Server : <a href="https://hub.docker.com/r/lenacloud/lena-web" class="bare">https://hub.docker.com/r/lenacloud/lena-web</a></p>
</li>
<li>
<p>Application Server : <a href="https://hub.docker.com/r/lenacloud/lena-cluster" class="bare">https://hub.docker.com/r/lenacloud/lena-cluster</a></p>
</li>
<li>
<p>Session Server : <a href="https://hub.docker.com/r/lenacloud/lena-session" class="bare">https://hub.docker.com/r/lenacloud/lena-session</a></p>
</li>
<li>
<p>Manager Server : <a href="https://hub.docker.com/r/lenacloud/lena-manager" class="bare">https://hub.docker.com/r/lenacloud/lena-manager</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Kubernetes Manifest 파일 : Kubernetes에 설치 시 필요한 Workload /
Service / Config Map 이 기술된 LENA Server배포용 파일</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Docker Hub에서 제공하는 Image의 Spec은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">구분</th>
<th class="tableblock halign-left valign-top">JVM</th>
<th class="tableblock halign-left valign-top">OS (Base Image)</th>
<th class="tableblock halign-left valign-top">기본 Heap Memory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open JDK 1.8</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Cent OS 7 (centos:7)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open JDK 1.8</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Cent OS 7 (centos:7)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64MB~256MB(Agent)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open JDK 1.8</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Cent OS 7 (centos:7)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open JDK 1.8</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Cent OS 7 (centos:7)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0 GB</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_시스템_요구사항"><a class="link" href="#_시스템_요구사항">1.4. 시스템 요구사항</a></h3>
<div class="paragraph">
<p>LENA for Container의 각 서버 인스턴스 설치에 대한 최소 요구사항은 다음과
같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 16.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">구분</th>
<th class="tableblock halign-left valign-top">JVM</th>
<th class="tableblock halign-left valign-top">최소 Memory</th>
<th class="tableblock halign-left valign-top">Image Size(Base Img 제외)</th>
<th class="tableblock halign-left valign-top">기본설정 Memory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDK 1.8<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">약 900 MB (약 300MB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.25 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDK 1.8<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">약820 MB
(약 300MB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDK 1.8<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">약 900 MB
(약 300MB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.25 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDK 1.8<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">약 1,000 MB
(약 500MB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.25 GB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>각 서버 설치 시 기본 필요 Memory 기준으로 설치 되며, 최소 사양 변경 시 설정
값 변경이 필요하다. Image Size는 OS + JDK + LENA Server + 필요Library
전체를 설치한 Image 크기이다.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture_결정사항"><a class="link" href="#_architecture_결정사항">2. Architecture 결정사항</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_절차"><a class="link" href="#_절차">2.1. 절차</a></h3>
<div class="paragraph">
<p>전체 Architecture 의사결정과 설치과정은 아래 그림과 같다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_1_architecture_step.png" alt="step" width="623" height="649">
</div>
<div class="title">Figure 3. 전체 Architecture 의사결정과 설치과정</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Architecture 의사결정의 시작은 Container 플랫폼의 결정과 운영 Container의 OS와 JDK를 결정하는 것이다. 이에 따라 LENA기반 Image를 선택하고, 플랫폼에 따른 배포방식이 결정된다.</p>
</li>
<li>
<p>설치는 WEB/WAS 서버와 Manager/Session 서버 설치방식이 다르게 진행된다. 일반적으로 Manager/Session은 LENA Image를 제공되는 그대로 사용하게 되고, WEB/WAS는 LENA 이미지를 기반으로 프로젝트별로 필요로하는 Application / Library등을 추가설치하는 커스텀 Base Image를 Build하여 활용하는 방식으로 진행된다.</p>
</li>
<li>
<p>WEB/WAS/Session 서버를 통합관리하기 위해서는 해당 Container를 구성하기 전에 LENA Manager를 활용하여 각 Service별 Service Cluster를 사전에 구성하여야 한다. Service Cluster를 생성하고, Container 환경설정에 Manager 주소와 Service Cluster 정보를 추가하면 Container 기동시에 Template / License 다운로드 절차가 수행되며, 기동 후 Manager에서 기동된 Container의 Server가 자동 등록되고 모니터링 정보를 확인 할 수 있다.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_container_운영_환경에_대한_고려사항"><a class="link" href="#_container_운영_환경에_대한_고려사항">2.2. Container 운영 환경에 대한 고려사항</a></h3>
<div class="paragraph">
<p>Provider별 다양한 Container 운영환경이 제공 되고 있으나 크게
EKS/GKE/AKS등을 포함하는 Kubernetes환경과 Amazon ECS와 같은 Docker
기반환경 2가지 유형으로 나누어 볼 수 있다.</p>
</div>
<div class="paragraph">
<p>Container 환경 별 특성 중 LENA를 운영하는데 영향을 미치는 주요 특성은
다음과 같다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>구성 Server간 N/W 통신</p>
<div class="paragraph">
<p>이 고려사항은 시스템을 구성하는Server들이 Container 운영환경의 내부
N/W와 외부 N/W에 분산되어 있을 경우, 상호 통신 가능 여부에 대한
고려사항이다. 일반적으로 특별한 N/W 제약이 설정되어 있지 않으면
outbound통신이 가능하며, LENA의 경우 Server &#8594; Manager, WAS
&#8594; Session Server의 통신이 가능하여야 한다. 특히, VM + Container를 혼합하여
구성할 경우 ECS의 vpc네트워크 모드 처럼 Container와 VM 간의 통신이
가능한 N/W 구성이 필요하다.</p>
</div>
</li>
<li>
<p>Load Balancing 지원</p>
<div class="paragraph">
<p>VM/Host 와 달리 Container는 수시로 생성/소멸될 수 있으며, 이에 따라
IP주소가 변경된다. 따라서, Back-End에 위치한 Container생성/소멸 후에도
지속적인 Service를 유지하기 위해서 Back-End 서비스의 앞 단에
Load-balancer를 필요로 하게 된다. Kubernetes와 Docker Swarm은  Load-Balancing을 제공하는 Service를 제공하고, ECS 는 ELB 연결 또는 Service Discovery 설정을 통해 Load-balancing 기능을 제공하고 있다.</p>
</div>
</li>
<li>
<p>Instance 영속성 지원 (관련 요소 : Session Server, Manager)</p>
<div class="paragraph">
<p>고정된 개수의 Container를 고정된 주소로 지속적으로 운영하는 것을
의미하며, DBMS와 같이 공유되는 자원 서비스를 Container로 서비스할 때
필요한 특성으로, LENA의 구성요소 중 Manager와 Session Server의 구성에
필요하다. Kubernetes의 경우는 StatefulSet 배포 방식을 통해 이 특성을
제공하고, Docker Swarm 및 ECS의 경우에는 Replica 1인 Service를 배포하여 유사하게 운영될 수 있다.</p>
</div>
</li>
<li>
<p>외부 Volume 연결 (관련 요소 : Manager)</p>
<div class="paragraph">
<p>Container가 State 유지를 보장할 수 없기에 소멸/기동이 발생하여도
사용하는 Data를 지속적으로 유지하기 위해서는 외부 저장소 (Volume)에
정보를 저장하여야 한다. 일반적으로 DBMS의 DB데이터 저장이나 복수개의
Container에 동일 Application을 배포할 때 주로 활용된다. LENA Manager를
Container 방식으로 운영할 경우 재기동 후에도 관리 정보의 일관성을
유지하기 위해서 외부 Volume의 연결을 필요로 한다.</p>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_container_플랫폼_별_운영환경_특성"><a class="link" href="#_container_플랫폼_별_운영환경_특성">2.2.1. Container 플랫폼 별 운영환경 특성</a></h4>
<div class="paragraph">
<p>본 절에서는 앞에서 언급한 운영환경 고려사항과 관련된 Container 플랫폼의 특성을 살펴본다.</p>
</div>
<div class="sect4">
<h5 id="_kubernetes"><a class="link" href="#_kubernetes">Kubernetes</a></h5>
<div class="paragraph">
<p>Kubernetes는 Container화된 Workload와 Service를 관리하기 위한 이식성이 있고, 확장가능한 Container Orchestration 도구 이다.
Kubernetes는 물리적으로는 Container관리를 위한 Control Plane과 Worker Node로 구성되는 Cluster 단위로 설치되어 운영된다.
Worker Node에는 논리적인 작업공간인 Namespace가 분산배치된다.
Kubernetes 서비스는 Container 배포가 가능한 최소 단위인 Pod과 Pod을 그룹화하여 관리하는 단위인 Workload,
Workload를 Network 서비스로 제공하는 Service로 구성 되고, Workload 및 Service는 Namespace에 배치된다.</p>
</div>
<div class="paragraph">
<p>Kubernetes의 Network 구조는 Service 모듈을 위한 Cluster Network이 구성되어 있고, 이를 통해 Host로의 Port Open, Load Balancing을 제공한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_k8s_nw.png" alt="image">
</div>
<div class="title">Figure 4. Kubernetes Cluster N/W</div>
</div>
<div class="paragraph">
<p>Kubernetes의 Service는 Pod 집합에서 실행중인 애플리케이션을 N/W 서비스로 노출하는 추상화된 방법으로  Pod에게 고유한 IP 주소와 Pod 집합에 대한 단일 DNS 명을 부여하고 Load-Balancing을 제공한다. Kubernetes Service의 유형에는 다음과 같은 4가지가 있다.</p>
</div>
<div class="sect5">
<h6 id="_cluster_ip"><a class="link" href="#_cluster_ip">Cluster IP</a></h6>
<div class="paragraph">
<p>Kubernetes N/W에서 내부 고정 IP / Domain Name이 할당되고, 이를 통해 Cluster Load Balancing이 이루어진다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_k8s_clusterIp.png" alt="image">
</div>
<div class="title">Figure 5. Kubernetes Deployment 유형 - Cluster Ip</div>
</div>
</div>
<div class="sect5">
<h6 id="_node_port"><a class="link" href="#_node_port">Node Port</a></h6>
<div class="paragraph">
<p>Cluster를 구성하는 모든 Node의 Port를 Container Port로 연결한다. Node 외부로 30000-32767 범위의 Port가 Open되고, 기본적으로는 랜덤하게 Port가 지정되나 고정적으로도 지정할 수 있다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_k8s_nodePort.png" alt="image">
</div>
<div class="title">Figure 6. Kubernetes Deployment 유형 - Node Port</div>
</div>
</div>
<div class="sect5">
<h6 id="_load_balancer"><a class="link" href="#_load_balancer">Load Balancer</a></h6>
<div class="paragraph">
<p>Node Port를 오픈함과 동시에 Container N/W 외부에 있는 LoadBalnacer를 연계하여 Service를 노출한다. EKS와 같은 Cloud Service에서는 Cloud Service Provider에서 제공하는 Load Balancer를 생성하여 연결한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_k8s_lb.png" alt="image">
</div>
<div class="title">Figure 7. Kubernetes Deployment 유형 - Load Balancer</div>
</div>
</div>
<div class="sect5">
<h6 id="_headless"><a class="link" href="#_headless">Headless</a></h6>
<div class="paragraph">
<p>별도의 Service Cluster IP 없이 Domain Name만을 통한 Load Balancing 수행한다. Pod 별로 각각의 Domain이 지정되고, Stateful Set를 이용하는 경우 주로 사용된다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_k8s_headless.png" alt="image">
</div>
<div class="title">Figure 8. Kubernetes Deployment 유형 - Headless</div>
</div>
<div class="paragraph">
<p>Kubernetes는 다양한 유형의 Container(Pod) 배포 방식을 지원한다. 일반적으로 Deployment(Replica Set)을 사용하지만 고정된 Instance 개수를 필요로하는 LENA Manager, Session Server에는 Stateful Set 적용이 적합하다.</p>
</div>
</div>
<div class="sect5">
<h6 id="_replica_set"><a class="link" href="#_replica_set">Replica Set</a></h6>
<div class="paragraph">
<p>Node 개수와 관계없이 요청된 수만큼의 Replica를 생성한다. 모든 Pod이 동일한 Persistent Volume을 공유하는 형태로 구성할 수 있다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_k8s_replicaSet.png" alt="image">
</div>
<div class="title">Figure 9. Kubernetes Workload 유형 - Replica Set</div>
</div>
</div>
<div class="sect5">
<h6 id="_deployment"><a class="link" href="#_deployment">Deployment</a></h6>
<div class="paragraph">
<p>Replica Set을 재생성 할 수 있고, Versioning 할 수 있다. 일반적으로 WEB 서버, Application 서버를 배포할때 사용된다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_k8s_deployment.png" alt="image">
</div>
<div class="title">Figure 10. Kubernetes Workload 유형 - Deployment</div>
</div>
</div>
<div class="sect5">
<h6 id="_stateful_set"><a class="link" href="#_stateful_set">Stateful Set</a></h6>
<div class="paragraph">
<p>고정된 개수의 Pod을 유지할 수 있고, Pod  별로 Master / Slave 등의 상태 값을 가질 수 있고, Pod  별로 각각의 Persistent Volume 할당이 가능하다. 일반적으로 DBMS, Session Server 등 영속성이 필요한 서비스를 배포할때 사용한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_k8s_statefulSet.png" alt="image">
</div>
<div class="title">Figure 11. Kubernetes Workload 유형 - Stateful Set</div>
</div>
</div>
<div class="sect5">
<h6 id="_daemon_set"><a class="link" href="#_daemon_set">Daemon Set</a></h6>
<div class="paragraph">
<p>Kubernetes Cluster의 Worker Node 개수와 동일한 Pod이 Node 별로 배포되고 유지된다. 일반적으로 Standard Out으로 출력된 Log 수집, Node별 모니터링 정보 수집, Ingress를 대신하는 Web 서버를 배포할 경우 사용될 수 있다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_k8s_deamonSet.png" alt="image">
</div>
<div class="title">Figure 12. Kubernetes Workload 유형 - Daemon Set</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_docker_swarm"><a class="link" href="#_docker_swarm">Docker Swarm</a></h5>
<div class="paragraph">
<p>Docker가 기본적으로 제공하는 Instance관리 및 N/W 환경은 LENA를 운영하기 위한 필요 기능이 부족하므로, Docker의 기본 Orchestration 환경인 'Swarm&#8217;을 적용하여야 한다.</p>
</div>
<div class="paragraph">
<p>Docker Swarm 시스템은 관리 Node인 Master Node와 Worker Node로 구성되고, Kubernetes의 Namespace와 유사한 논리공간인 Stack과 Container, Container를 Network로 서비스 하기 위한 Service로 구성된다.</p>
</div>
<div class="paragraph">
<p>Docker에서 Container Network 구성하는 방식에는 단일 Host내 Container간 통신이 되는 Bridge, Host 방식과 여러 Host에 배포된 Container간 통신이 가능한 Overlay-Host, Overlay-Ingress 방식이 있다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_docker_nw.png" alt="image">
</div>
<div class="title">Figure 13. Docker Swarm Container Network 유형</div>
</div>
<div class="paragraph">
<p>Docker Container Network에서 동일한 Bridge / Overlay Network에 연결된 Container 간 Domain을 통한 통신이 가능하다. Local Scope에서는 단일 Host 내에서만 Container간 통신이 가능하고, Swarm Scope에서는 여러 Host에 걸쳐 Container간 통신이 가능하다. Overlay Ingress mode에서는 VIP가 생성되어 Container 앞 단에 위치하여 Load Balancing 기능을 제공한다.</p>
</div>
<div class="paragraph">
<p>Docker Swarm에서는 Overlay Network 기본으로 제공하고, VIP를 통한 단일 접점을 이용한 로드밸런싱을 이용해야 할 경우 Ingress 모드로 동작한다. LENA는 서버 유형별 특성에 맞게 Ingress 모드, Host 모드를 구분하여 사용한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_docker_overlayNw.png" alt="image">
</div>
<div class="title">Figure 14. Docker Swarm Overlay Network</div>
</div>
</div>
<div class="sect4">
<h5 id="_ecs"><a class="link" href="#_ecs">ECS</a></h5>
<div class="paragraph">
<p>AWS의 ECS는 Task (Kubernetes Pod와 유사)와 N/W, Replica Set등을 설정할 수 있는 Service로 구성된다. ECS의 Service를 구성하는 Task Instance에 대한 Load Balancing은 1) ELB 방식 또는 2) Service Discovery 방식으로 제공할 수 있다. ELB 방식은 Service 정의에서 ELB를 지정하여 설정할 수 있다. Service Discovery 방식은 ECS 서비스의 Task Instance가 생성되면서 Service에 설정된 DNS 이름으로 Amazon Route 53에 자동 등록하여 이를 이용한 Load Balancing을 제공하는 방식이다. 외부 트래픽에 의한 부하 및 컨테이너 상태에 따라 서비스가 확장되거나 축소되더라도 Route 53 호스팅 영역이 최신 상태로 유지되므로 VPC내부에서 각 서비스의 상태를 기준으로 DNS로 연결이 된다. Route 53은 Namespace, Task IP별 A 레코드 및 작업 IP + 포트별 SRV 레코드를 생성하여 Service에 연결된다.</p>
</div>
<div class="ulist">
<div class="title">ECS 주요 구성 요소</div>
<ul>
<li>
<p><strong>Namespace</strong> – 네임스페이스는 트래픽을 라우팅할 대상 도메인 이름(예:
internal, local, corp)을 지정한다. 네임스페이스는 서로 검색 가능하게
구현되어야 하는 서비스 간의 논리적 경계이다.</p>
</li>
<li>
<p><strong>Service</strong> – 서비스는 네임스페이스 안에 포함된 애플리케이션의 Set이다.
서비스에는 서비스 인스턴스(Task)가 포함되어 있다.</p>
</li>
<li>
<p><strong>Task</strong> – Kubernetes의 Pod과 유사한 Object로 단일 또는 복수개의 Container를 하나의 Instance로 그룹핑하여 관리하며 Container Instance의 Image / 환경설정 / Entry Point등 을 설정할 수 있다.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_ecs_serviceDiscovery.png" alt="image" width="600">
</div>
<div class="title">Figure 15. ECS Service Discovery 개념도</div>
</div>
</div>
<div class="sect4">
<h5 id="_container_플랫폼_별_특성_종합"><a class="link" href="#_container_플랫폼_별_특성_종합">Container 플랫폼 별 특성 종합</a></h5>
<div class="paragraph">
<p>LENA의 운영방식과 관련된 각 환경들의 특성을 정리하면 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Container 운영환경</th>
<th class="tableblock halign-left valign-top">외부 N/W통신</th>
<th class="tableblock halign-left valign-top">L/B지원</th>
<th class="tableblock halign-left valign-top">Instance 영속성</th>
<th class="tableblock halign-left valign-top">고정 주소</th>
<th class="tableblock halign-left valign-top">외부 Volume 연결</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Kubernetes 기반</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">일반</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">가능</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service L/B지원</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EKS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VPC내 통신</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service, ELB연결</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Docker 기반</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Swarm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">가능</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service L/B 지원(Overlay N/W-Overlay)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원(Service Replica=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원 (Overlay N/W-Host)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VPC 내 통신 (VPC N/W 모드)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ELB, Service Discovery 지원</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원(Service Replica=1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원(Service Discovery)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">지원
(EFS)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_lena_server_유형별_운영방식"><a class="link" href="#_lena_server_유형별_운영방식">2.2.2. LENA Server 유형별 운영방식</a></h4>
<div class="paragraph">
<p>위 특성에 따라 Container 환경과 LENA Server유형별 지원 가능한 운영방식은
다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Container 운영환경</th>
<th class="tableblock halign-left valign-top">WEB Server</th>
<th class="tableblock halign-left valign-top">WAS</th>
<th class="tableblock halign-left valign-top">Session Server</th>
<th class="tableblock halign-left valign-top">Manager</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes 기반</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">일반</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container (statefulset),
VM/Host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container<br>
(statefulset),
VM/Host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Docker 기반</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Swarm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container(Overlay N/W-Ingress)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container (Overlay N/W-Ingress)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container (Overlay N/W-Host), VM/Host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container (Overlay N/W-Host),VM/Host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>VM, Container</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VM, Container</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_공통_고려사항"><a class="link" href="#_공통_고려사항">2.3. 공통 고려사항</a></h3>
<div class="paragraph">
<p>다음은 Server 유형에 관계없이 공통적으로 고려해야 할 요소이다.</p>
</div>
<div class="sect3">
<h4 id="_os"><a class="link" href="#_os">2.3.1. OS</a></h4>
<div class="paragraph">
<p>LENA Image 기준으로 다음과 같은 OS를 사용한다. 이는 LENA Image빌드시
사용되는 Base Image이다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">LENA Image 제공 OS</th>
<th class="tableblock halign-left valign-top">LENA Image의 Base Image</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cent OS 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">centos:7</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Cent OS 8, Ubuntu, Debian 등 타 OS를 사용할 경우 LENA 기술지원을 통해서 Base Image를 재생성해야 한다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_jdk"><a class="link" href="#_jdk">2.3.2. JDK</a></h4>
<div class="paragraph">
<p>LENA Image를 기준으로 OS기본 JDK 1.8 (yum / apt-get으로 설치) 또는 Adopt
Open JDK 1.8을 설치 사용한다. 설치 패키지 및 환경변수는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OS</th>
<th class="tableblock halign-left valign-top">JDK 설명</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cent OS 7</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>설치 패키지 : java-1.8.0-openjdk-devel.x86_64</p>
</li>
<li>
<p>JAVA_HOME : /usr/lib/jvm/java</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>타 JDK를 사용할 경우, Project용 Base Image생성시에 설치가 가능하나
JAVA_HOME의 Path는 가급적 기존과 동일하게 설치하는 것을 권고한다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>$JAVA_HOME 환경변수 값은 각 Server의 env.sh (manager의 경우 env-manager.sh), LENA 설치 정보 (${LENA_HOME}/etc/info/java-home.info)에 기 저장되어 있으므로,  JDK 재설치시에는 $JAVA_HOME에 맞도록 기존 파일 정보 수정이 필요하다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_실행_user"><a class="link" href="#_실행_user">2.3.3. 실행 User</a></h4>
<div class="paragraph">
<p>LENA Image 기준 실행 User는 ‘root’ 이다. 이를 변경하고자 하는 경우 LENA
Image를 변경하여야 하며 LENA 기술지원을 요청하여 변경하여야 한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="_library"><a class="link" href="#_library">2.3.4. Library</a></h4>
<div class="paragraph">
<p>LENA의 Image에 설치되어 있는 Library는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Library</th>
<th class="tableblock halign-left valign-top">용도</th>
<th class="tableblock halign-left valign-top">OS별 적용여부</th>
<th class="tableblock halign-left valign-top">적용Server</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">net-tools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wget등 N/W 유틸리티</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hostname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostname 확인 용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initscript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service (Daemon) 구동 용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">procps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process 관련 유틸리티</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unzip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server 설정파일 압축해제 용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File 포맷 점검용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">curl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">파일 다운로드 용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu / Debian</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cronie-noanacron</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crontab 구동 용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logrotate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB/WAS의 File Log Rotate 처리 용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">libxml2-utils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML Validation 용 (License 파일 Validation)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debian</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Locale 설정 용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu / Debian</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">libapr1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Server 사용 Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu / Debian</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">libaprutil1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Server 사용 Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu / Debian</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tzdata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time Zone 설정</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu / Debian</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openssl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web / WAS 사용 Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">( 공통적용 )</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>awscli</p>
</div>
<div class="paragraph">
<p>pip</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager에서 EKS API 호출 용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(공통적용)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_server_유형별_고려사항_manager"><a class="link" href="#_server_유형별_고려사항_manager">2.4. Server 유형별 고려사항 – Manager</a></h3>
<div class="sect3">
<h4 id="architecture_decision-manager-deployment"><a class="link" href="#architecture_decision-manager-deployment">2.4.1. 배포</a></h4>
<div class="paragraph">
<p>Manager의 배포는 Container 또는 VM/Host 배포 모두 가능하고, 양 방식을
적용하기 위한 제약사항은 다음과 같다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>고정 Domain 또는 IP 주소 할당<br>
Container에 설치된 Server가 설정 파일/라이선스 다운로드 및 모니터링
정보를 송신하므로, 지속적인 서비스를 위해서 재부팅/재생성 후에도 고정된
주소로 서비스가 되어야 함.</p>
</li>
<li>
<p>Server &#8594; Manager 간 N/W통신<br>
Manager 다운로드 서비스 사용 및 모니터링 정보 제공을 위한 단방향 통신이
필요. 기본 설정 기준으로 TCP Port 7700, UDP / TCP Port 16100 접속이 허용되어야
함</p>
</li>
<li>
<p>Persistent Volume<br>
Container에 설치된 Manager의 경우 재기동 후에도 서비스 연속성을 제공하기
위해 DB, 설정정보, 모니터링 데이터등을 저장할 수 있는 외부 Volume이
필요. NFS, EBS Disk, Local Node Disk등을 활용한 Persistent Volume를
확보하고, Manager Container에 할당하여 사용</p>
</li>
<li>
<p>Instance 영속성 보장<br>
Manager의 Instance는 서비스 연속성 제공을 위해 Instance 영속성을
보장받아야 한다. 일반 VM /Host는 기본적으로 영속성을 보장하지만,
Container환경에서는 Kubernetes의 StatefulSet처럼 영속성을 보장하는
방식으로 배포되어야 함</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">배포방식</th>
<th class="tableblock halign-left valign-top">제약(필요) 사항</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container 배포</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Persistent Volume</p>
</li>
<li>
<p>Server &#8594; Manager 간 N/W 통신(TCP Port 7700, UDP/TCP Port 16100)</p>
</li>
<li>
<p>고정 도메인 또는 고정 IP 할당</p>
</li>
<li>
<p>Container 영속성 보장</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VM/Host 설치</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Server &#8594; Manager 간 N/W 통신(TCP Port 7700, UDP/TCP Port 16100)</p>
</li>
<li>
<p>고정 도메인 또는 고정 IP 할당</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_사양"><a class="link" href="#_사양">2.4.2. 사양</a></h4>
<div class="paragraph">
<p>Manager Server를 운영하기 위해서 필요한 사양은 다음과 같다.</p>
</div>
<div class="sect4">
<h5 id="_memory"><a class="link" href="#_memory">Memory</a></h5>
<div class="paragraph">
<p>Manager Server의 Heap Memory Size는 최소 512Mbyte를 필요로 하고
Image에는 다음과 같이 기본 설정이 되어 있다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Heap Memory : 1024 Mbyte</p>
</li>
<li>
<p>Metaspace Memory : 256 Mbyte</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>이를 변경하고자 하면 다음 환경변수를 설정하여 조정 한다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LENA_JVM_HEAP_SIZE</p>
</li>
<li>
<p>LENA_JVM_METASPACE_SIZE</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>위 환경 변수의 값은 MByte단위이며 반드시 숫자+’m’ 형태의 포맷 (예 : 1024m) 형식으로 지정되어야 한다. 포맷이 불일치 하면 적용되지 않는다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_disk"><a class="link" href="#_disk">Disk</a></h5>
<div class="paragraph">
<p>LENA Image 기준으로 사용되는 Image 크기는 약 1,000 Mbyte로 이는 OS + JDK
+ LENA + Library의 총합으로 Image의 상위 Layer 용량까지 포함한 용량이다.</p>
</div>
<div class="paragraph">
<p>여기에 추가적으로 고려해야 할 Disk용량은 1) Manager Log 파일 용량과 2)
Repository (DB 및 파일저장소) 이다. Manager에서 사용되는 Repository 의
위치는 ${LENA_HOME}/repository이고, 5GB 정도의 용량을 필요로 한다.
그리고, Container에 설치될 경우에는 이 Repository는 Persistent Volume에
연결하여 Container외부에 저장하여야 한다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Manager에서 사용되는 Repository 의 위치는 ${LENA_HOME}/repository이고, Container 재기동시에도 관리 데이터의 지속성을 위해 Container에 설치될 경우에는 Persistent Volume에 연결하여 Container외부에 저장하기를 권고한다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_설정"><a class="link" href="#_설정">2.4.3. 설정</a></h4>
<div class="sect4">
<h5 id="_네트워크"><a class="link" href="#_네트워크">네트워크</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>네트워크 주소<br>
Manager는 반드시 고정 Domain 또는 IP 주소를 할당하여야 한다. (본 문서 <a href="#architecture_decision-manager-deployment">배포</a> 참조)</p>
</li>
<li>
<p>서비스 포트<br>
Manager의 서비스 포트는 다음과 같이 고정되어 있다.<br></p>
<div class="ulist">
<ul>
<li>
<p>Http (TCP) Port 7700: 통합관리 서비스 및 Rest API 서비스 제공</p>
</li>
<li>
<p>UDP Port 16100: 모니터링 데이터 수집</p>
</li>
<li>
<p>TCP Port 16100: Thread / Service Dump 데이터 생성 / 수집</p>
<div class="literalblock">
<div class="content">
<pre> 포트는 LENA Manager Image에 고정되어 있고, 변경을 하고자 하는 경우
LENA Image 변경보다는 Container의 기본 설정 사상에 따라 Port Mapping을
변경할 것을 권고한다.</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LENA Manager의 Service 포트 변경은 타 Server와의 연동 Port 변경을 의미하며, 변경시에는 연동되어 있는 모든 Server의 설정을 변경/ 재시작을 필요로 한다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="architecture_decision_manager_env"><a class="link" href="#architecture_decision_manager_env">환경변수</a></h5>
<div class="paragraph">
<p>Manager Container에 적용 가능한 주요 환경변수는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">기본 값</th>
<th class="tableblock halign-left valign-top">변경<br>
가능</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_HEAP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Heap Memory 크기 지정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_METASPACE_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Metaspace Memory크기</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_DOMAIN_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain Name 활성화 여부</p>
</li>
<li>
<p>‘Y’ 또는 ‘N’</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>외부로 노출되는 (Server들이 인식하는) Manager 주소</p>
</li>
<li>
<p>형식 : IP / Domain주소 : 서비스 포트<br>
예) Kubernetes의 경우 : Service Domain</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain 주소 Cache 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVER_TYPE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Server 유형</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA 설치위치</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local/lena</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_OPTIONS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>사용자 정의 JVM OPTION</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_USER</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 기동에 사용할 OS 사용자계정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_USER_GROUP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 기동에 사용할 OS 사용자그룹</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JAVA_DOMAIN_CACHE_TTL 값이 설정되었을 시 ${JAVA_HOME}/jre/lib/security/java.security
파일의 networkaddress.cache.ttl 값을 변경한다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_directory_구조"><a class="link" href="#_directory_구조">Directory 구조</a></h5>
<div class="paragraph">
<p>LENA Image 기준 기본 설치 위치는 '/usr/local/lena' 이고,
그 하위 구조는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">디렉토리<br>
(${LENA_HOME} 하위)</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager의 Start/Stop scripts</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">depot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">설치를 위한 Local Repository</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">etc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">기타 메타 정보 및 설정 파일</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">license</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">License 정보를 관리하는 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs<br>
ㄴlena-manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">로그 파일 저장소 Home<br>
Manager Log파일 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules<br>
  ㄴ lena-manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA 제공 모듈의 저장소 Home<br>
lena-manager 실행에 필요한 모듈이 위치하는 경로</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">repository<br>
 ㄴbackup<br>
 ㄴconfig<br>
 ㄴcontainer<br>
 ㄴdatabase<br>
 ㄴlicense<br>
 ㄴmonitoringDB<br>
 ㄴresource<br>
 ㄴtemplate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager데이터 저장소 Home<br>
백업데이터 저장소<br>
Manager 설정정보 저장소<br>
Container 설정정보 저장소<br>
Manager 데이터베이스 저장소<br>
라이선스 파일 저장소<br>
모니터링 데이터 저장소<br>
Resource 업로드 파일 저장소<br>
Server 설정 Template 저장소</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container에서 외부 볼륨 사용 권고</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">임시디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_log_dump_출력"><a class="link" href="#_log_dump_출력">Log &amp; Dump 출력</a></h5>
<div class="paragraph">
<p>Log 및 Dump는 Standard Out / Error로 출력하는 'console' 방식과 File로
출력하는 'file' 방식이 지원되고, 환경변수 'LOG_OUTPUT_TYPE&#8217;의 값을
'console' 또는 'file&#8217;로 설정 함으로서 출력방식을 전환할 수 있다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Console 출력<br>
일반적으로 Container 환경에서 많이 활용되는 방식이다. Manager의
Application Log, Access Log, GC Log를 모두 Standard Out으로 출력한다.
Docker에 설정된 Log Driver에 의해 Node(Host)의 지정위치 (기본위치 :
/var/lib/docker/containers/[container-id]/[container-id]-json.log)에
저장되거나 FluentD와 같은 Log Aggregator에 의해 수집 / 저장하여
통합관리를 할 수 있다.</p>
</li>
<li>
<p>파일 출력<br>
파일 출력 설정 시 Log파일 및 Dump 파일은
${LENA_HOME}/logs/lena-manager하위에 Daily Rolling 방식으로 저장된다.
저장된 파일은 기본 설정에 따라 최종 기록된지30일 이상 경과된 Log파일을
매일 삭제한다.<br>
이 방식은 Manager가 VM/Host 환경에서 운영되거나 Manager Log를 별도로
수집하지 않는 환경에서 사용할 수 있다.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="architecture_decision-manager-healthcheck"><a class="link" href="#architecture_decision-manager-healthcheck">Health Check</a></h5>
<div class="paragraph">
<p>Health Check는 Kubernetes를 기준으로 설명한다.<br>
Health Check는 기동시 Container의 서비스 준비여부를 판단하는 1)
Readiness Probe와 운용중 정상적인 서비스 여부를 체크하는 2) Liveness
Probe, 그리고 Application 시작여부를 판단하는3) Startup Probe가 있다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">구분</th>
<th class="tableblock halign-left valign-top">용도</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Readiness (Probe)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">기동시점, 컨테이너가 요청을 처리할 준비가 되었는지
여부</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Liveness (Probe)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">운영시점, 컨테이너가 정상 동작 중인지 여부</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Startup (Probe)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">컨테이너 내의 애플리케이션이 시작되었는지 여부</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Check 방식(Action)에는 다음 3가지 유형이 있다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">구분 (Action)</th>
<th class="tableblock halign-left valign-top">방식</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP Socket (TCPSocketAction)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port 통신 여부로 Health Check</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Http URL Query (HTTPGetAction)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL 호출 결과 코드로 Health Check</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exec 실행 (ExecAction)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container 내부의 명령어 실행으로 Health Check</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Manager를 Health Check 하는 방식은 URL 체크 방식을 사용하며, Readiness와
Liveness Probe를 적용한다. 기본설정은 다음과 같다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Readiness Check</p>
<div class="ulist">
<ul>
<li>
<p>httpGet : path /lena, port 7700</p>
</li>
<li>
<p>initialDelaySeconds : 5</p>
</li>
<li>
<p>periodSeconds : 5</p>
</li>
</ul>
</div>
</li>
<li>
<p>Liveness Check</p>
<div class="ulist">
<ul>
<li>
<p>httpGet : path /lena, port 7700</p>
</li>
<li>
<p>initialDelaySeconds : 20</p>
</li>
<li>
<p>periodSeconds : 5</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server_유형별_고려사항_session_server"><a class="link" href="#_server_유형별_고려사항_session_server">2.5. Server 유형별 고려사항 – Session Server</a></h3>
<div class="sect3">
<h4 id="architecture_decision-session-deployment"><a class="link" href="#architecture_decision-session-deployment">2.5.1. 배포</a></h4>
<div class="paragraph">
<p>Session Server의 배포는 Container 또는 VM/Host 배포 모두 가능하고, 양 방식을
적용하기 위한 제약사항은 다음과 같다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>고정 Domain 또는 IP 주소 할당<br>
Session Server 는 2개의 Container 에 Cluster 로 구성된다. 각 Session Server는 상대편 Session Server 의 Domain / IP를
Mirror Server 정보로 인식하여 Session 정보를 동기화 하므로,
지속적인 서비스를 위해서 재부팅/재생성 후에도 고정된 주소로 서비스가 되어야 함.</p>
</li>
<li>
<p>Instance 영속성 보장<br>
Session의 Instance는 서비스 연속성 제공을 위해 Instance 영속성을
보장받아야 한다. 일반 VM /Host는 기본적으로 영속성을 보장하지만,
Container환경에서는 Kubernetes의 StatefulSet처럼 영속성을 보장하는
방식으로 배포되어야 함</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">배포방식</th>
<th class="tableblock halign-left valign-top">제약(필요) 사항</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container 배포</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>고정 도메인 또는 고정 IP 할당</p>
</li>
<li>
<p>Container 영속성 보장</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VM/Host 설치</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>고정 도메인 또는 고정 IP 할당</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_사양_2"><a class="link" href="#_사양_2">2.5.2. 사양</a></h4>
<div class="paragraph">
<p>Session Server를 운영하기 위해서 필요한 사양은 다음과 같다.</p>
</div>
<div class="sect4">
<h5 id="_memory_2"><a class="link" href="#_memory_2">Memory</a></h5>
<div class="paragraph">
<p>Session Server의 Heap Memory Size는 최소 1024Mbyte를 필요로 하고
Image에는 다음과 같이 기본 설정이 되어 있다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Heap Memory : 1024 Mbyte</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>이를 변경하고자 하면 다음 환경변수를 설정하여 조정 한다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LENA_JVM_HEAP_SIZE</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>위 환경 변수의 값은 MByte단위이며 반드시 숫자+’m’ 형태의 포맷 (예 : 1024m) 형식으로 지정되어야 한다. 포맷이 불일치 하면 적용되지 않는다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_disk_2"><a class="link" href="#_disk_2">Disk</a></h5>
<div class="paragraph">
<p>LENA Image 기준으로 사용되는 Image 크기는 약 800 Mbyte로 이는 OS + JDK<br>
LENA + Library의 총합으로 Image의 상위 Layer 용량까지 포함한 용량이다.</p>
</div>
<div class="paragraph">
<p>여기에 추가적으로 고려해야 할 Disk용량은 Session Server Log 파일 이다.</p>
</div>
</div>
<div class="sect4">
<h5 id="_설정_2"><a class="link" href="#_설정_2">설정</a></h5>

</div>
<div class="sect4">
<h5 id="_네트워크_2"><a class="link" href="#_네트워크_2">네트워크</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>네트워크 주소<br>
Session Server는 반드시 고정 Domain 또는 IP 주소를 할당하여야 한다. (본 문서 <a href="#architecture_decision-session-deployment">배포방식</a>  참조) WAS 및 Secondary Session Server에서 고정된
주소로 Session 정보가 통신된다.</p>
</li>
<li>
<p>서비스 포트<br>
Session Server의 서비스 포트는 다음과 같이 고정되어 있다.<br></p>
<div class="ulist">
<ul>
<li>
<p>Http (TCP) Port 5180* : Session 조회 및 관리 포트<br></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>위 포트는 LENA Image에 고정되어 있고, 변경을 하고자 하는 경우 LENA Image
변경보다는 Container의 기본 설정 사상에 따라 Port Mapping을 변경할 것을
권고한다.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Session Server의 Service 포트 변경은 타 Server와의 연동 Port 변경을 의미하며, 변경시에는 연동되어 있는 모든 Server의 설정 변경 / 재시작을 필요로 한다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="architecture_decision_session_env"><a class="link" href="#architecture_decision_session_env">환경변수</a></h5>
<div class="paragraph">
<p>Session Container에 적용 가능한 주요 환경변수는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">기본 값</th>
<th class="tableblock halign-left valign-top">변경<br>
가능</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_HEAP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Heap Memory 크기 지정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>외부로 노출되는 (Server들이 인식하는) Manager 주소</p>
</li>
<li>
<p>형식 : IP / Domain주소 : 서비스 포트<br>
예) Kubernetes의 경우 : Service Domain</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain 주소 Cache 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_0_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Primary Session 서버 주소, StatefulSet설정과 일치되어야 함</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_1_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Secondary Session 서버 주소, StatefulSet설정과 일치되어야 함</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SECONDARY_SESSION_NO</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA_SESSION_0_ADDRESS / LENA_SESSION_1_ADDRESS 중 mirror 서버로 사용할 정보 선택 (0, 1 만 입력 가능)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_EXPIRE_SEC</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Session 만료 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1800</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_SHARE_SESSION</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application 간 Session 공유여부</p>
</li>
<li>
<p>‘Y’ 또는 ‘N’ 값 허용</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVER_TYPE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Server 유형</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA 설치위치</p>
</li>
<li>
<p>기본 값 : /usr/local/lena</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(설명참조)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVER_HOME</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Session Server 설치 위치</p>
</li>
<li>
<p>기본 값 : /usr/local/lena/server/sessionServer</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(설명참조)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG_OUTPUT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>로그 출력 방식 (file/console)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_AGENT_RUN</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA Agent 기동여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_USER</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 기동에 사용할 OS 사용자계정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_USER_GROUP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 기동에 사용할 OS 사용자그룹</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JAVA_DOMAIN_CACHE_TTL 이 설정되었을 시 ${JAVA_HOME}/jre/lib/security/java.security
파일의 networkaddress.cache.ttl 값을 변경한다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_directory_구조_2"><a class="link" href="#_directory_구조_2">Directory 구조</a></h5>
<div class="paragraph">
<p>LENA Image 기준 기본 설치 위치는 ‘/usr/local/lena’ 이고, 그 하위
구조는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">디렉토리<br>
(${LENA_HOME} 하위)</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server의 Start/Stop scripts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">미사용</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">depot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">설치를 위한 Local Repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">미사용</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">etc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">기타 메타 정보 및 설정 파일</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">license</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">License를 관리하는 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA 제공 모듈의 저장소 Home</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">servers/sessionServer<br>
ㄴlib<br>
ㄴlogs<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server 설치 위치 (${LENA_SERVER_HOME})<br>
Session Server Library 저장소<br>
Log 파일 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">임시디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_log"><a class="link" href="#_log">Log</a></h5>
<div class="paragraph">
<p>Session Server는 File Log 출력만 제공한다. 출력위치는
${LENA_SERVER_HOME}/logs 디렉토리이며 파일명 형식은
lena-sessionServer-YYYYMMDD.log 으로 매일 Log 파일이 생성된다</p>
</div>
</div>
<div class="sect4">
<h5 id="_health_check"><a class="link" href="#_health_check">Health Check</a></h5>
<div class="paragraph">
<p>Health Check의 기본 내용은 본 문서 <a href="#architecture_decision-manager-healthcheck">Manger Health Check</a> 부분을 참조한다.</p>
</div>
<div class="paragraph">
<p>Kubernetes 기준 Session Server를 Health Check 하는 방식은 Command Exec
(ExecAction) 방식이며, ${LENA_SERVER_HOME}/ health.sh를 호출한다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Readiness Check</p>
<div class="ulist">
<ul>
<li>
<p>exec : ${LENA_SERVER_HOME}/ health.sh</p>
</li>
<li>
<p>initialDelaySeconds : 20</p>
</li>
</ul>
</div>
</li>
<li>
<p>Liveness Check</p>
<div class="ulist">
<ul>
<li>
<p>exec : ${LENA_SERVER_HOME}/ health.sh</p>
</li>
<li>
<p>initialDelaySeconds : 30</p>
</li>
<li>
<p>periodSeconds : 5</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server_유형별_고려사항_was"><a class="link" href="#_server_유형별_고려사항_was">2.6. Server 유형별 고려사항 – WAS</a></h3>
<div class="sect3">
<h4 id="architecture_decision-was-deployment"><a class="link" href="#architecture_decision-was-deployment">2.6.1. 배포</a></h4>
<div class="paragraph">
<p>WAS는 Container에 배포되며, 설정에 따라 Container 플랫폼
(Kubernetes, ECS등)에 단일 또는 복수개의 Instance가 동시에 배포된다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Service 계획<br>
WAS 는 단일/복수개의 Container로 배포되고, 이를 외부나
Front-End에 Service하기 위해서는 앞 단에 L/B역할을 수행하는 Service를
배치하는 것이 일반적인 방식이다. Kubernetes의 경우에는 설치된 Node의
특정 Port로 서비스하는 NodePort, 외부 L/B를 활용하는 LoadBalancer, 내부
고정 IP를 지정하는 ClusterIp의 서비스 유형이 제공되고 있으며, ECS의
경우에는 ALB를 지정하는 방식이 있다. 사전에 Application을 어떠한
방식으로 Service할지 사전 결정이 필요하다.</p>
</li>
<li>
<p>Instance 수 (Replica)<br>
단일 Service를 하는 복수개의 WAS의 수는 부하에 따라
가변적이나, 초기 기동해야 할 Instance 개수를 사전에 정의하여, 배포
설정에 반영하여야 한다.</p>
</li>
<li>
<p>Service Mapping<br>
ECS의 경우에는 Service에서 직접 L/B를 지정할 수 있지만, Kubernetes의
경우에는 Key-Value로 정의 된 label을 기준으로 Mapping 룰을 정의 하여
Service와 매핑한다. 전체 시스템 상에서 중복없고, 운영에 편리한 Mapping
기준을 수립하여 배포 설정에 반영하여야 한다.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_사양_3"><a class="link" href="#_사양_3">2.6.2. 사양</a></h4>
<div class="paragraph">
<p>WAS를 운영하기 위해서 필요한 사양은 다음과 같다.</p>
</div>
<div class="sect4">
<h5 id="_memory_3"><a class="link" href="#_memory_3">Memory</a></h5>
<div class="paragraph">
<p>WAS의 Heap Memory Size는 최소 512Mbyte를 필요로 하고
Image에는 다음과 같이 기본 설정이 되어 있다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Heap Memory : 1024 Mbyte</p>
</li>
<li>
<p>Metaspace Memory : 128 Mbyte</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>이를 변경하고자 하면 다음 환경변수를 설정하여 조정 한다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LENA_JVM_HEAP_SIZE</p>
</li>
<li>
<p>LENA_JVM_METASPACE_SIZE</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>위 환경 변수의 값은 MByte단위이며 반드시 숫자+’m’ 형태의 포맷 (예 : 1024m) 형식으로 지정되어야 한다. 포맷이 불일치 하면 적용되지 않는다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_disk_3"><a class="link" href="#_disk_3">Disk</a></h5>
<div class="paragraph">
<p>LENA Image 기준으로 사용되는 Image 크기는 약 900 Mbyte로 이는 OS + JDK + LENA + Library의 총합으로 Image의 상위 Layer 용량까지 포함한 용량이다.<br>
운영에 필요한 추가적인 Disk는 Log를 파일 방식으로 저장할 때 Log용량과
Application 소스 파일 (Artifact)의 용량을 고려하여 산정한다.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_설정_3"><a class="link" href="#_설정_3">2.6.3. 설정</a></h4>
<div class="sect4">
<h5 id="architecture_decision-app-network"><a class="link" href="#architecture_decision-app-network">네트워크</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>네트워크 주소<br>
WAS의 네트워크 주소는 특별한 제약이 없다. N/W상에서
Manager와 Session Server를 목적지로 하는 단방향 통신 가능하도록 배치해야
한다.</p>
</li>
<li>
<p>서비스 포트<br>
WAS의 서비스 포트는 다음과 같이 고정되어 있다.</p>
<div class="ulist">
<ul>
<li>
<p>HTTP 서비스 Port : 8180</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>위 포트는 LENA Image에 고정되어 있고, 외부 서비스 변경을 하고자 하는
경우 LENA Image 변경보다는 Container의 기본 사상에 따라 Port 바인딩
설정을 통해 변경할 것을 권고한다.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="architecture_decision_application_env"><a class="link" href="#architecture_decision_application_env">환경변수</a></h5>
<div class="paragraph">
<p>WAS Container에 적용 가능한 주요 환경변수는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">기본 값</th>
<th class="tableblock halign-left valign-top">변경<br>
가능</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVICE_PORT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>WAS 서비스 Port</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_HEAP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Heap Memory 크기 지정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_METASPACE_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Metaspace Memory크기</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_OPTIONS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>사용자 정의 JVM OPTION</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 주소</p>
</li>
<li>
<p>형식 : IP / Domain주소 : 서비스 포트</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_MONITORING_PORT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 모니터링 Port 정보</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_KEY</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager Open API 접속 토큰</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_DOWNLOAD</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager로부터 설정 파일 다운로드 여부</p>
</li>
<li>
<p>허용값 : Y 또는 N</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>설정 파일 ID</p>
</li>
<li>
<p>형식 : Service Cluster 명:Revision 번호</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LICENSE_DOWNLOAD_URL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>License 다운로드 URL</p>
</li>
<li>
<p>입력값 : manager 또는 고객사 보유License다운로드 URI</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONTRACT_CODE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>License발급과 관련된 계약 코드로 암호화된 값임.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain 주소 Cache 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG_OUTPUT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LOG 출력 유형</p>
</li>
<li>
<p>허용 값 : console 또는 file</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LOG_OUTPUT_DIR</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Log 파일 생성 위치</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local/lena/servers/appServer/logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_DUMP_OUTPUT_DIR</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Dump 파일 생성 위치</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVER_TYPE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Server 유형</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WAS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA 설치 Home</p>
</li>
<li>
<p>값 : /usr/local/lena</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(설명참조)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVER_HOME</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA 서버 설치 위치</p>
</li>
<li>
<p>값 : /usr/local/lena/servers/appServer</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(설명참조)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVICE_ENDPOINT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>WAS 가 속한 서비스의 주소</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_AGENT_RUN</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA Agent 기동여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_USER</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 기동에 사용할 OS 사용자계정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_USER_GROUP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 기동에 사용할 OS 사용자그룹</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 수행여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_WAS_URL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 용 페이지 정보</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/tie/lenaHealthCheck.jsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_INITIAL_DELAY_MILLISEC</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA Agent 기동 이후 Health Check 시작전 대기시간, Server 기동시간을 확보하기 위함</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000 (milliseconds)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_TIMEOUT_MILLISEC</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 요청 Timeout</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000 (milliseconds)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_FAILURE_THRESHOLD</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 실패 임계치</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_TERM_EXECUTION</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 실패 임계치 초과시, 후속작업 수행여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_TERM_EXECUTION_SCRIPT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 실패 임계치 초과시, 후속작업 script 정보</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stop-container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_TERM_EXECUTION_INTERVAL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 실패 임계치 초과시, 후속작업 수행 주기</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300 (seconds)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>LENA_CONFIG_TEMPLATE_ID: Revision 번호는 생략가능하며, 생략시 Default Revision 다운로드 된다.</p>
</li>
<li>
<p>LENA_CONTRACT_CODE: License 유효성 체크에 사용되고, 이 값이 유효하지 않을 경우 라이선스 다운로드가 취소된다.</p>
</li>
<li>
<p>JAVA_DOMAIN_CACHE_TTL: 이 값이 설정되었을 시 ${JAVA_HOME}/jre/lib/security/java.security
파일의 networkaddress.cache.ttl 값을 변경한다.</p>
</li>
<li>
<p>LOG_OUTPUT_TYPE:  Server 설정파일 다운로드 적용시 다운로드 한 설정 파일의 Log설정이 적용된다.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_directory_구조_3"><a class="link" href="#_directory_구조_3">Directory 구조</a></h5>
<div class="paragraph">
<p>LENA Image 기준 기본 설치 위치는 ‘/usr/local/lena’ 이고, 그 하위 구조는
다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">디렉토리<br>
(${LENA_HOME} 하위)</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node Agent의 Start/Stop scripts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">미사용</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">depot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">설치를 위한 Local Repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">미사용</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">etc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">기타 메타 정보 및 설정 파일</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">license</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">License 정보를 관리하는 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA 관리용 로그 파일 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA 제공 모듈의 저장소 Home</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ㄴ lena-agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node Agent 실행에 필요한 모듈이 위치하는 경로</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">미사용</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">servers/webServer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server 설치 Home, ${LENA_SERVER_HOME}</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ㄴbin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server Start / Stop / 관리용 실행 Script 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ㄴconf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server 설정정보 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ㄴdumps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dump 파일 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ㄴhook</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Life-Cycle Hook Shell 파일 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ㄴlib</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server 실행 Library 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ㄴlogs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log 파일 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ㄴtemp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">작업용 임시 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ㄴwebapps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">기본 Application Deployment 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ㄴwork</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSP Servlet 변환 소스 및 컴파일 결과 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA 관리용 임시 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="architecture_decision_app-logoutput"><a class="link" href="#architecture_decision_app-logoutput">Log &amp; Dump 출력</a></h5>
<div class="paragraph">
<p>Log는 Standard Out / Error로 출력하는 ‘console’ 방식과 File로 출력하는
‘file’ 방식이 지원되고, 환경변수 ‘LOG_OUTPUT_TYPE’의 값을 ‘console’ 또는
‘file’로 설정 함으로서 출력방식을 전환할 수 있다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Console 출력<br>
일반적으로 Container 환경에서 많이 활용되는 방식이다. Server의
Application Log, Access Log, GC Log를 모두 Standard Out으로 출력한다.
Docker에 설정된 Log Driver에 의해 Node(Host)의 지정위치 (Docker의 기본
Log 파일 위치 :
/var/lib/docker/containers/[container-id]/[container-id]-json.log)에
저장되거나 FluentD와 같은 Log Aggregator에 의해 수집 / 저장하여
통합관리를 할 수 있다.</p>
</li>
<li>
<p>파일 출력<br>
파일 출력 설정 시 Log파일 및 Dump 파일은
${LENA_HOME}/servers/appServer/logs 디렉토리 하위에 파일로
저장되고, 각 Log 파일은 logrotate설정에 의해 Daily rolling 된다.<br>
출력되는 Log 파일의 유형과 출력 파일명은 아래 표와 같다.</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log 유형</th>
<th class="tableblock halign-left valign-top">출력 위치</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access_appServer_${HOSTNAME}.log</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GC Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gc_appServer_${HOSTNAME}.log</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">appServer_lena-${HOSTNAME}.out.log</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>이 Log파일들은 Guest OS에 설치된 logrotate에 의해 매일 Rolling 된다.<br>
파일 기반 Log를 출력할 경우, 별도의 Log Aggregator를 통해 Log를 수집 /
조회하는 Log관리 Stack (ELK, EFK Stack등)을 구성하는 것이 일반적이다.
이를 위해서는 Fluent-Bit과 같은Side-car Container를 추가하여 Log를
수집하는 방식이 일반적이다.</p>
</div>
<div class="paragraph">
<p>Dump파일은 다음 위치에 생성된다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dump Home : ${LENA_HOME}/servers/appServer/dumps/ ${HOSTNAME}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>${HOSTNAME} 디렉토리는 외부 Volume으로 Dump파일을 저장할 때 Container별
구분을 위한 것이다.</p>
</div>
<div class="paragraph">
<p>Dump 유형별 저장 위치는 다음과 같다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Heap Dump : ${DUMP_HOME}/hdump</p>
</li>
<li>
<p>Thread Dump : ${DUMP_HOME}/tdump</p>
</li>
<li>
<p>Service Dump : ${DUMP_HOME}/sdump</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_health_check_2"><a class="link" href="#_health_check_2">Health Check</a></h5>
<div class="paragraph">
<p>Health Check의 기본 내용은 본문서 <a href="#architecture_decision-manager-healthcheck">Manager Health Check</a> 부분을 참조한다.</p>
</div>
<div class="paragraph">
<p>일반적으로 WAS는 Http Get방식으로 Health Check 하지만,
LENA WAS의 기본 Health Check방식은 TCP Port 체크방식으로
설정되어 있다. 이는 기본 LENA Image에 Business Application가 탑재되지
않았기 때문이고, Biz Application이 탑재되었을 경우에는 해당
Application의 적절한 Http Get Health Check 설정을 업데이트 하기를
권고한다. 제공 Kubernetes Manifest 파일 기준 기본설정은 다음과 같다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Readiness Check</p>
<div class="ulist">
<ul>
<li>
<p>TCPSocketAction : port 8180</p>
</li>
<li>
<p>initialDelaySeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
<li>
<p>timeoutSeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Liveness Check</p>
<div class="ulist">
<ul>
<li>
<p>TCPSocketAction : port 8180</p>
</li>
<li>
<p>initialDelaySeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
<li>
<p>periodSeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>LENA WAS의 경우 Server의 정상 기동 후에 Service Port가 Listen 상태로 변경된다.</p>
</li>
<li>
<p>Health Check를 위한 Page는 Check가 성공하면 정상적으로 서비스가 제공되는 것으로 판단하게 되므로, 서비스의 Back-end (예 : Database)까지 정상적인지를 판단할 수 있는 Page를 선정하여 적용하기를 권고한다.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="architecture_decision-app-config"><a class="link" href="#architecture_decision-app-config">Server Configuration 관리</a></h5>
<div class="paragraph">
<p>Container와 WAS가 기동되는 절차는 다음과 같다.</p>
</div>
<div class="paragraph">
<p>일반적으로Server 설정은 WAS가 기동되기 전에 적용되어야
하며, 설정을 적용하는 시점은 1) Base Image에 포함하거나 2)
Container기동시점에 반영하는 방법 3) Application Artifact에 포함하는
방식이 있다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 적용 방식</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">LENA<br>
기능지원</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base Image에 포함</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base Image 생성시에 설정정보를 COPY하여 Image에 포함</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">기동 시점에 반영</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container 기동시, 외부 Repository에서 설정 정보를
COPY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Artifact에 포함</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Spring Boot의 경우와 같이 Application Artifact에 Server설정 정보가
간소화 되어 포함되어 Application Artifact의 배포와 함께 적용</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○<br>
WAS(Embedded) 를 통해 제공</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>LENA에서는 Manager를 통해 미리 구성한 Server 설정정보를 Image
Build시점이나, Container기동 시점에 반영할 수 있고 , 이를 위해서는
Application / WEB Server Container 구성이전에 Manager를 설치하고, Server
설정정보를 구성하여야 한다. 이를 도식화 하면 다음과 같다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/achitecture_decision_6_service_cluster.png" alt="servicecluster" width="623" height="276">
</div>
<div class="title">Figure 16. Service Cluster 설정관리 및 Container 설정 적용</div>
</div>
<div class="paragraph">
<p>LENA의 Server Cluster 기능을 이용하여 Server의 설정을 미리 구성하고,
이를 Image 또는 기동시점에 반영하여야 한다.</p>
</div>
<div class="paragraph">
<p>Server 설정에 대한 상세 가이드는 별도로 제공되는 운영자매뉴얼을 참조한다.</p>
</div>
</div>
<div class="sect4">
<h5 id="architecture_decision-app-imageBuild"><a class="link" href="#architecture_decision-app-imageBuild">Container Image Build</a></h5>
<div class="paragraph">
<p>LENA가 Base Image를 제공하지만 Project / 고객사 정책 또는 Architecture
표준에 의해 Base Image를 상속 또는 신규로 Build해야 하는 경우가 발생 할
수 있다. Architecture 의사결정과정에서 LENA Image의 변경범위를
확인하고, Image 관리 정책 / 기준 수립이 필요하다.</p>
</div>
<div class="paragraph">
<p>다음은 신규로 Base Image를 Build해야 하는 원인이다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OS가 LENA 기본 제공 Image와 불일치</p>
</li>
<li>
<p>LENA 설치 위치의 변경 (기본 : /usr/local/lena)</p>
</li>
<li>
<p>기타 적용 시스템의 Architecture 표준과 LENA 제공 기본 Image의 불일치
격차가 환경설정 수정하는 것만으로는 불가능</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>위 경우에는 LENA기술지원을 통해 Base Image를 재생성 하여야 한다.</p>
</div>
<div class="paragraph">
<p>아래 예시와 같이 단순 변경이 필요한 경우, LENA Image를 상속하여 Base
Image를 생성(Build)한다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application Artifact의 배치</p>
</li>
<li>
<p>필요 Library 설치</p>
</li>
<li>
<p>JDK 변경 (기존 Image에의 영향이 환경변수 수정 수준 이하일 경우)</p>
</li>
<li>
<p>실행 Command Script 수정</p>
</li>
<li>
<p>기타 적용 시스템의 Architecture 표준과 LENA 제공 기본 Image의 불일치 격차가 환경설정 수정만으로 가능한 경우</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>상세 실행 가이드는 본문서 <a href="#installation_prerequistes-baseImage">Base Image 생성</a> 부분을 참조한다.</p>
</div>
</div>
<div class="sect4">
<h5 id="_application_배포"><a class="link" href="#_application_배포">Application 배포</a></h5>
<div class="paragraph">
<p>Container 관점과 Server 관점에서의 Application Artifact 배포에 대한
방식을 모두 고려하여야 한다. Project에서 배포 절차가 결정되면,
Kubernetes Deployment Manifest나 ECS의 Task정의를 결정된
방식에 따라 설정하여야 한다.</p>
</div>
<div class="paragraph">
<p>WAS 관점에서 Application을 Deployment하는 방식에는 다음
두 가지가 있다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Server 관점 배포 방식</th>
<th class="tableblock halign-left valign-top">설명</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">기본 Deployment 디렉토리에 배포</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>${LENA_SERVER_HOME}/webapps에 WAR 또는 Directory를 복사</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">개별 Application 설정에 따른 배포</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Manager를 통해 개별 Application 설정</p>
</div>
<div class="paragraph">
<p>Application설정 중 ‘DocBase’ 위치에 WAR 또는 Directory를 복사</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Container 관점에서의 Deployment 방식은 다음 두가지 있다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Container 배포 방식</th>
<th class="tableblock halign-left valign-top">설명</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">주 Container Image에 사전 배포 방식</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base Image에 Application
Artifact를 직접 복사 / 포함</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Init Container 활용 기동 시점 배포 방식</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Init Container에서 내부에
포함된 Artifact 또는 외부 저장소 (Volume)에 있는 Artifact를 기동 시점에
주 Container에 복사</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server_유형별_고려사항_embedded_was"><a class="link" href="#_server_유형별_고려사항_embedded_was">2.7. Server 유형별 고려사항 – Embedded WAS</a></h3>
<div class="sect3">
<h4 id="architecture_decision-was-deployment"><a class="link" href="#architecture_decision-was-deployment">2.7.1. 배포</a></h4>
<div class="paragraph">
<p>Embedded WAS는 Container에 배포되며, 설정에 따라 Container 플랫폼
(Kubernetes, ECS등)에 단일 또는 복수개의 Instance가 동시에 배포된다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Service 계획<br>
Embedded WAS 는 단일/복수개의 Container로 배포되고, 이를 외부나
Front-End에 Service하기 위해서는 앞 단에 L/B역할을 수행하는 Service를
배치하는 것이 일반적인 방식이다. Kubernetes의 경우에는 설치된 Node의
특정 Port로 서비스하는 NodePort, 외부 L/B를 활용하는 LoadBalancer, 내부
고정 IP를 지정하는 ClusterIp의 서비스 유형이 제공되고 있으며, ECS의
경우에는 ALB를 지정하는 방식이 있다. 사전에 Application을 어떠한
방식으로 Service할지 사전 결정이 필요하다.</p>
</li>
<li>
<p>Instance 수 (Replica)<br>
단일 Service를 하는 복수개의 Embedded WAS의 수는 부하에 따라
가변적이나, 초기 기동해야 할 Instance 개수를 사전에 정의하여, 배포
설정에 반영하여야 한다.</p>
</li>
<li>
<p>Service Mapping<br>
ECS의 경우에는 Service에서 직접 L/B를 지정할 수 있지만, Kubernetes의
경우에는 Key-Value로 정의 된 label을 기준으로 Mapping 룰을 정의 하여
Service와 매핑한다. 전체 시스템 상에서 중복없고, 운영에 편리한 Mapping
기준을 수립하여 배포 설정에 반영하여야 한다.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_사양_4"><a class="link" href="#_사양_4">2.7.2. 사양</a></h4>
<div class="paragraph">
<p>Embedded WAS를 운영하기 위해서 필요한 사양은 다음과 같다.</p>
</div>
<div class="sect4">
<h5 id="_memory_4"><a class="link" href="#_memory_4">Memory</a></h5>
<div class="paragraph">
<p>Embedded WAS의 Heap Memory Size는 최소 512Mbyte를 필요로 하고
Image에는 다음과 같이 기본 설정이 되어 있다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Heap Memory : 1024 Mbyte</p>
</li>
<li>
<p>Metaspace Memory : 128 Mbyte</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>이를 변경하고자 하면 다음 환경변수를 설정하여 조정 한다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LENA_JVM_HEAP_SIZE</p>
</li>
<li>
<p>LENA_JVM_METASPACE_SIZE</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>위 환경 변수의 값은 MByte단위이며 반드시 숫자+’m’ 형태의 포맷 (예 : 1024m) 형식으로 지정되어야 한다. 포맷이 불일치 하면 적용되지 않는다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_disk_4"><a class="link" href="#_disk_4">Disk</a></h5>
<div class="paragraph">
<p>LENA Image 기준으로 사용되는 Image 크기는 약 700 Mbyte로 이는 OS + JDK + LENA + Library의 총합으로 Image의 상위 Layer 용량까지 포함한 용량이다.<br>
운영에 필요한 추가적인 Disk는 Log를 파일 방식으로 저장할 때 Log용량과
Application 소스 파일 (Artifact)의 용량을 고려하여 산정한다.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_설정_4"><a class="link" href="#_설정_4">2.7.3. 설정</a></h4>
<div class="sect4">
<h5 id="architecture_decision-app-network"><a class="link" href="#architecture_decision-app-network">네트워크</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>네트워크 주소<br>
Embedded WAS의 네트워크 주소는 특별한 제약이 없다. N/W상에서
Manager와 Session Server를 목적지로 하는 단방향 통신 가능하도록 배치해야
한다.</p>
</li>
<li>
<p>서비스 포트<br>
Embedded WAS의 서비스 포트는 다음과 같이 고정되어 있다.</p>
<div class="ulist">
<ul>
<li>
<p>HTTP 서비스 Port : 8180</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>위 포트는 LENA Image에 고정되어 있고, 외부 서비스 변경을 하고자 하는
경우 LENA Image 변경보다는 Container의 기본 사상에 따라 Port 바인딩
설정을 통해 변경할 것을 권고한다.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="architecture_decision_embedded_application_env"><a class="link" href="#architecture_decision_embedded_application_env">환경변수</a></h5>
<div class="paragraph">
<p>Embedded WAS Container에 적용 가능한 주요 환경변수는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">기본 값</th>
<th class="tableblock halign-left valign-top">변경<br>
가능</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVICE_PORT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>WAS 서비스 Port</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_HEAP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Heap Memory 크기 지정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_METASPACE_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Metaspace Memory크기</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_OPTIONS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>사용자 정의 JVM OPTION</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 주소</p>
</li>
<li>
<p>형식 : IP / Domain주소 : 서비스 포트</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_MONITORING_PORT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 모니터링 Port 정보</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>설정 파일 ID</p>
</li>
<li>
<p>형식 : Service Cluster 명:Revision 번호</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG_OUTPUT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LOG 출력 유형</p>
</li>
<li>
<p>허용 값 : console 또는 file</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LOG_OUTPUT_DIR</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Log 파일 생성 위치</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local/lena/logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVER_TYPE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Server 유형</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">embedded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA 설치 Home</p>
</li>
<li>
<p>값 : /usr/local/lena</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(설명참조)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVICE_ENDPOINT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>WAS 가 속한 서비스의 주소</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 수행여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_APP_FILE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application Jar 파일 명</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_APP_DIR</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application Jar 디렉토리 명</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local/lena</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_EXCEPTION_ALERT_ENABLE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Exception 발생 시 정보 수집여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_EXCEPTION_CLASS_PATTERNS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>수집대상 Exception Class 정보 ',' 로 여러개 Class 를 연결하여 설정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_EXCEPTION_EXCLUDE_CLASS_PATTERNS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>제외대상 Exception Class 정보 ',' 로 여러개 Class 를 연결하여 설정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_FULLSTACK_HOOKED_EXCEPTION_ENABLE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Exception 발생시 Full Stack Trace 수집여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_STUCKTHREAD_ALERT_ENABLE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Thread Stuck 발생 시 정보 수집여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_OOM_ALERT_ENABLE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Out Of Memory 발생 시 정보 수집여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_FULLGC_ALERT_ENABLE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Full GC 발생 시 정보 수집여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_REVERSE_TCP_CONNECTION_ENABLE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Reverse TCP Connection 을 통한 Manager 연결 사용 여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_directory_구조_4"><a class="link" href="#_directory_구조_4">Directory 구조</a></h5>
<div class="paragraph">
<p>LENA Image 기준 기본 설치 위치는 ‘/usr/local/lena’ 이고, 그 하위 구조는
다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">디렉토리<br>
(${LENA_HOME} 하위)</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA 관리용 로그 파일 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">etc/info</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image Build 정보 파일 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="architecture_decision_embedded_app-logoutput"><a class="link" href="#architecture_decision_embedded_app-logoutput">Log &amp; Dump 출력</a></h5>
<div class="paragraph">
<p>Log는 Standard Out / Error로 출력하는 ‘console’ 방식과 File로 출력하는
‘file’ 방식이 지원되고, 환경변수 ‘LOG_OUTPUT_TYPE’의 값을 ‘console’ 또는
‘file’로 설정 함으로서 출력방식을 전환할 수 있다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Console 출력<br>
일반적으로 Container 환경에서 많이 활용되는 방식이다. Server의
Application Log, Access Log, GC Log를 모두 Standard Out으로 출력한다.
Docker에 설정된 Log Driver에 의해 Node(Host)의 지정위치 (Docker의 기본
Log 파일 위치 :
/var/lib/docker/containers/[container-id]/[container-id]-json.log)에
저장되거나 FluentD와 같은 Log Aggregator에 의해 수집 / 저장하여
통합관리를 할 수 있다.</p>
</li>
<li>
<p>파일 출력<br>
파일 출력 설정 시 Log파일 및 Dump 파일은
${LENA_HOME}/servers/appServer/logs 디렉토리 하위에 파일로
저장되고, 각 Log 파일은 logrotate설정에 의해 Daily rolling 된다.<br>
출력되는 Log 파일의 유형과 출력 파일명은 아래 표와 같다.</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log 유형</th>
<th class="tableblock halign-left valign-top">출력 위치</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access_appServer_${HOSTNAME}.log</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GC Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gc_appServer_${HOSTNAME}.log</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">appServer_lena-${HOSTNAME}.out.log</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>이 Log파일들은 Guest OS에 설치된 logrotate에 의해 매일 Rolling 된다.<br>
파일 기반 Log를 출력할 경우, 별도의 Log Aggregator를 통해 Log를 수집 /
조회하는 Log관리 Stack (ELK, EFK Stack등)을 구성하는 것이 일반적이다.
이를 위해서는 Fluent-Bit과 같은Side-car Container를 추가하여 Log를
수집하는 방식이 일반적이다.</p>
</div>
<div class="paragraph">
<p>Dump파일은 다음 위치에 생성된다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dump Home : ${LENA_HOME}/servers/appServer/dumps/ ${HOSTNAME}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>${HOSTNAME} 디렉토리는 외부 Volume으로 Dump파일을 저장할 때 Container별
구분을 위한 것이다.</p>
</div>
<div class="paragraph">
<p>Dump 유형별 저장 위치는 다음과 같다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Heap Dump : ${DUMP_HOME}/hdump</p>
</li>
<li>
<p>Thread Dump : ${DUMP_HOME}/tdump</p>
</li>
<li>
<p>Service Dump : ${DUMP_HOME}/sdump</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_health_check_3"><a class="link" href="#_health_check_3">Health Check</a></h5>
<div class="paragraph">
<p>Health Check의 기본 내용은 본문서 <a href="#architecture_decision-manager-healthcheck">Manager Health Check</a> 부분을 참조한다.</p>
</div>
<div class="paragraph">
<p>일반적으로 WAS는 Http Get방식으로 Health Check 하지만,
LENA WAS의 기본 Health Check방식은 TCP Port 체크방식으로
설정되어 있다. 이는 기본 LENA Image에 Business Application가 탑재되지
않았기 때문이고, Biz Application이 탑재되었을 경우에는 해당
Application의 적절한 Http Get Health Check 설정을 업데이트 하기를
권고한다. 제공 Kubernetes Manifest 파일 기준 기본설정은 다음과 같다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Readiness Check</p>
<div class="ulist">
<ul>
<li>
<p>TCPSocketAction : port 8180</p>
</li>
<li>
<p>initialDelaySeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
<li>
<p>timeoutSeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Liveness Check</p>
<div class="ulist">
<ul>
<li>
<p>TCPSocketAction : port 8180</p>
</li>
<li>
<p>initialDelaySeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
<li>
<p>periodSeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>LENA WAS의 경우 Server의 정상 기동 후에 Service Port가 Listen 상태로 변경된다.</p>
</li>
<li>
<p>Health Check를 위한 Page는 Check가 성공하면 정상적으로 서비스가 제공되는 것으로 판단하게 되므로, 서비스의 Back-end (예 : Database)까지 정상적인지를 판단할 수 있는 Page를 선정하여 적용하기를 권고한다.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="architecture_decision-app-imageBuild"><a class="link" href="#architecture_decision-app-imageBuild">Container Image Build</a></h5>
<div class="paragraph">
<p>LENA가 Base Image를 제공하지만 Project / 고객사 정책 또는 Architecture
표준에 의해 Base Image를 상속 또는 신규로 Build해야 하는 경우가 발생 할
수 있다. Architecture 의사결정과정에서 LENA Image의 변경범위를
확인하고, Image 관리 정책 / 기준 수립이 필요하다.</p>
</div>
<div class="paragraph">
<p>다음은 신규로 Base Image를 Build해야 하는 원인이다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OS가 LENA 기본 제공 Image와 불일치</p>
</li>
<li>
<p>LENA 설치 위치의 변경 (기본 : /usr/local/lena)</p>
</li>
<li>
<p>기타 적용 시스템의 Architecture 표준과 LENA 제공 기본 Image의 불일치
격차가 환경설정 수정하는 것만으로는 불가능</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>위 경우에는 LENA기술지원을 통해 Base Image를 재생성 하여야 한다.</p>
</div>
<div class="paragraph">
<p>아래 예시와 같이 단순 변경이 필요한 경우, LENA Image를 상속하여 Base
Image를 생성(Build)한다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application Artifact의 배치</p>
</li>
<li>
<p>필요 Library 설치</p>
</li>
<li>
<p>JDK 변경 (기존 Image에의 영향이 환경변수 수정 수준 이하일 경우)</p>
</li>
<li>
<p>실행 Command Script 수정</p>
</li>
<li>
<p>기타 적용 시스템의 Architecture 표준과 LENA 제공 기본 Image의 불일치 격차가 환경설정 수정만으로 가능한 경우</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>상세 실행 가이드는 본문서 <a href="#installation_prerequistes-baseImage">Base Image 생성</a> 부분을 참조한다.</p>
</div>
</div>
<div class="sect4">
<h5 id="_application_배포_2"><a class="link" href="#_application_배포_2">Application 배포</a></h5>
<div class="paragraph">
<p>Container 관점과 Server 관점에서의 Application Artifact 배포에 대한
방식을 모두 고려하여야 한다. Project에서 배포 절차가 결정되면,
Kubernetes Deployment Manifest나 ECS의 Task정의를 결정된
방식에 따라 설정하여야 한다.</p>
</div>
<div class="paragraph">
<p>WAS 관점에서 Application을 Deployment하는 방식에는 다음
두 가지가 있다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Server 관점 배포 방식</th>
<th class="tableblock halign-left valign-top">설명</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">기본 Deployment 디렉토리에 배포</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>${LENA_APP_FILE} 설정<br>
${LENA_HOME}에 Jar 를 복사</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">개별 Application 설정에 따른 배포</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>${LENA_APP_FILE} 과 ${LENA_APP_DIR} 설정
${LENA_APP_DIR}에 Jar 를 복사</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Container 관점에서의 Deployment 방식은 다음 두가지 있다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Container 배포 방식</th>
<th class="tableblock halign-left valign-top">설명</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">주 Container Image에 사전 배포 방식</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base Image에 Application
Artifact를 직접 복사 / 포함</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Init Container 활용 기동 시점 배포 방식</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Init Container에서 내부에
포함된 Artifact 또는 외부 저장소 (Volume)에 있는 Artifact를 기동 시점에
주 Container에 복사</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server_유형별_고려사항_web_server"><a class="link" href="#_server_유형별_고려사항_web_server">2.8. Server 유형별 고려사항 – Web Server</a></h3>
<div class="sect3">
<h4 id="_배포"><a class="link" href="#_배포">2.8.1. 배포</a></h4>
<div class="paragraph">
<p>본 문서 “<a href="#architecture_decision-was-deployment">WAS 배포</a>” 부분의 설명을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="_사양_5"><a class="link" href="#_사양_5">2.8.2. 사양</a></h4>
<div class="paragraph">
<p>Web Server를 운영하기 위해서 필요한 사양은 다음과 같다.</p>
</div>
<div class="sect4">
<h5 id="_memory_5"><a class="link" href="#_memory_5">Memory</a></h5>
<div class="paragraph">
<p>Web Server의 Heap Memory Size는 최소 512Mbyte를 필요로 하고, Agent의 Heap Memory Size는 64~256MB를 필요로 한다.</p>
</div>
</div>
<div class="sect4">
<h5 id="_disk_5"><a class="link" href="#_disk_5">Disk</a></h5>
<div class="paragraph">
<p>LENA Image 기준으로 사용되는 Image 크기는 약 900 Mbyte로 이는 OS + JDK<br>
LENA + Library의 총합으로 Image의 상위 Layer 용량까지 포함한 용량이다.</p>
</div>
<div class="paragraph">
<p>운영에 필요한 추가적인 Disk는 Log를 파일 방식으로 저장할 때 Log용량과
Web 리소스 파일 (Artifact)의 용량을 고려하여 산정한다.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_설정_5"><a class="link" href="#_설정_5">2.8.3. 설정</a></h4>
<div class="sect4">
<h5 id="_네트워크_3"><a class="link" href="#_네트워크_3">네트워크</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>네트워크 주소<br>
Web Server의 네트워크 주소는 특별한 제약이 없다. N/W상에서
Manager와 WAS 또는 WAS의 Service Endpoint를 목적지로 하는 단방향 통신 가능하도록 설정해야 한다.</p>
</li>
<li>
<p>서비스 포트<br>
Web Server의 서비스 포트는 다음과 같이 고정되어 있다.</p>
<div class="ulist">
<ul>
<li>
<p>HTTP 서비스 Port : 7180</p>
</li>
<li>
<p>HTTPS 서비스 Port : 7543</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>위 포트는 LENA Image에 고정되어 있고, 외부 서비스 변경을 하고자 하는
경우 LENA Image 변경보다는 Container의 기본 사상에 따라 Port 바인딩
설정을 통해 변경할 것을 권고한다.</p>
</div>
</div>
<div class="sect4">
<h5 id="architecture_decision_web_env"><a class="link" href="#architecture_decision_web_env">환경변수</a></h5>
<div class="paragraph">
<p>WEB Server Container에 적용 가능한 주요 환경변수는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">기본 값</th>
<th class="tableblock halign-left valign-top">변경<br>
가능</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 주소</p>
</li>
<li>
<p>형식 : IP / Domain주소 : 서비스 포트</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_KEY</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager Open API 접속 토큰</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVICE_PORT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>WAS 서비스 Port</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_DOWNLOAD</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager로부터 설정 파일 다운로드 여부</p>
</li>
<li>
<p>허용값 : Y 또는 N</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>설정 파일 ID</p>
</li>
<li>
<p>형식 : Service Cluster 명:Revision 번호</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LICENSE_DOWNLOAD_URL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>License 다운로드 URL</p>
</li>
<li>
<p>입력값 : manager 또는 고객사 보유License다운로드 URI</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONTRACT_CODE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>License발급과 관련된 계약 코드로 암호화된 값임.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOG_OUTPUT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LOG 출력 유형</p>
</li>
<li>
<p>허용 값 : console 또는 file</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LOG_OUTPUT_DIR</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Log 파일 생성 위치</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local/lenaw/servers/webServer/logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_AGENT_RUN</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Node Agent 기동 여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVER_TYPE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Server 유형</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA 설치 Home</p>
</li>
<li>
<p>값 : /usr/local/lena</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(설명참조)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SERVER_HOME</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA 서버 설치 위치</p>
<div class="ulist">
<ul>
<li>
<p>값 : /usr/local/lenaw/servers/webServer</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(설명참조)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Χ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_USER</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 기동에 사용할 OS 사용자계정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_USER_GROUP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 기동에 사용할 OS 사용자그룹</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 수행여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_FAILURE_THRESHOLD</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 실패 임계치</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_TERM_EXECUTION</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 실패 임계치 초과시, 후속작업 수행여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_TERM_EXECUTION_SCRIPT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 실패 임계치 초과시, 후속작업 script 정보</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stop-container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HEALTH_CHECK_TERM_EXECUTION_INTERVAL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Health Check 실패 임계치 초과시, 후속작업 수행 주기</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300 (seconds)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">○</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>LENA_CONFIG_TEMPLATE_ID: Revision 번호는 생략가능하며, 생략시 Default Revision 다운로드 된다.</p>
</li>
<li>
<p>LENA_CONTRACT_CODE: License 유효성 체크에 사용되고, 이 값이 유효하지 않을 경우 라이선스 다운로드가 취소된다.</p>
</li>
<li>
<p>LOG_OUTPUT_TYPE: Server 설정파일 다운로드 적용시 다운로드 한 설정 파일의 Log설정이 적용된다.</p>
</li>
<li>
<p>LENA_AGENT_RUN: Web Server는 Agent가 기동되어야 Manager에 등록 및 모니터링이 가능하다.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_directory_구조_5"><a class="link" href="#_directory_구조_5">Directory 구조</a></h5>
<div class="paragraph">
<p>LENA Image 기준 기본 설치 위치는 ‘/usr/local/lenaw’ 이고, 그 하위 구조는
다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">디렉토리<br>
(${LENA_HOME} 하위)</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node Agent의 Start/Stop scripts</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">depot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">설치를 위한 Local Repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">미사용</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">etc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">기타 메타 정보 및 설정 파일</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">license</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">License 정보를 관리하는 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA 관리용 로그 파일 저장소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules<br>
ㄴ lena-agent<br>
ㄴ lena-web-pe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA 제공 모듈의 저장소 Home<br>
Node Agent 실행에 필요한 모듈이 위치하는 경로<br>
WEB Server Library</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">servers/webServer<br>
ㄴbin<br>
ㄴcache<br>
ㄴconf<br>
ㄴhook<br>
ㄴhtdocs<br>
ㄴlogs<br>
ㄴtemp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server 설치 Home, ${LENA_SERVER_HOME} <br>
Server Start / Stop / 관리용 실행 Script 저장소<br>
Cache 정보 저장소<br>
Server 설정정보 저장소<br>
Life-Cycle Hook Shell 파일 저장소<br>
기본 Web 리소스 저장 디렉토리<br>
Log 파일 저장소<br>
작업용 임시 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA 관리용 임시 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_log_2"><a class="link" href="#_log_2">Log</a></h5>
<div class="paragraph">
<p>Log는 Standard Out / Error로 출력하는 ‘console’ 방식과 File로 출력하는
‘file’ 방식이 지원되고, 환경변수 ‘LOG_OUTPUT_TYPE’의 값을 ‘console’ 또는
‘file’로 설정 함으로서 출력방식을 전환할 수 있다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Console 출력<br>
본 문서 “<a href="#architecture_decision_app-logoutput">Log &amp; Dump 출력</a>”을 참조한다.</p>
</li>
<li>
<p>파일 출력<br>
파일 출력 설정 시 Log파일 및 Dump 파일은
${LENA_HOME}/servers/webServer/logs 디렉토리 하위에 파일로
저장되고, 각 Log 파일은 logrotate설정에 의해 Daily rolling 된다.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>출력되는 Log 파일의 유형과 출력 파일명은 아래 표와 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log 유형</th>
<th class="tableblock halign-left valign-top">출력 파일명</th>
<th class="tableblock halign-left valign-top">설명</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">error_webServer.log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web 서버 오류 로그</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access_webServer.log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access 로그</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trace Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trace_webServer.log</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">서비스 추적용 로그,
Container형 서버에는 사용하지 않음</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTrace Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ntrace_webServer.log</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LSC Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lsc_webServer.log</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_health_check_4"><a class="link" href="#_health_check_4">Health Check</a></h5>
<div class="paragraph">
<p>일반적으로 WAS는 Http Get방식으로 Health Check 하지만,
LENA Web Server의 기본 Health Check방식은 TCP Port 체크방식으로 설정되어
있다. 이는 기본 LENA Image에 Business Application가 탑재되지 않았기
때문이고, Biz Application이 탑재되었을 경우에는 해당 Application의
적절한 Http Get Health Check 설정을 업데이트 하기를 권고한다.
제공 Kubernetes Manifest 파일 기준 기본설정은 다음과 같다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Readiness Check</p>
<div class="ulist">
<ul>
<li>
<p>TCPSocketAction : port 7180</p>
</li>
<li>
<p>initialDelaySeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
<li>
<p>timeoutSeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Liveness Check</p>
<div class="ulist">
<ul>
<li>
<p>TCPSocketAction : port 7180</p>
</li>
<li>
<p>initialDelaySeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
<li>
<p>periodSeconds : xx (Application 특성에 따른 보정 필요)</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_server_configuration_관리"><a class="link" href="#_server_configuration_관리">Server Configuration 관리</a></h5>
<div class="paragraph">
<p>본 문서 “<a href="#architecture_decision-app-config">Server Configuration 관리</a>” 를 참조한다.</p>
</div>
</div>
<div class="sect4">
<h5 id="_container_image_build"><a class="link" href="#_container_image_build">Container Image Build</a></h5>
<div class="paragraph">
<p>본 문서 “<a href="#architecture_decision-app-imageBuild">Container Image Build</a>” 를 참조한다.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_설치_공통_사항"><a class="link" href="#_설치_공통_사항">3. 설치 공통 사항</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_설치_준비"><a class="link" href="#_설치_준비">3.1. 설치 준비</a></h3>
<div class="ulist">
<ul>
<li>
<p>&lt;Container 운영환경 점검&gt;<br>
설치를 위해서는 Kubernetes, ECS등 Container가 운용될 수 있는 환경이 우선
구성되어 있어야 한다. 그리고, CLI환경에서 해당 환경에 접근할 수 있는
적절한 권한과 Profile (예 : Kubernetes Config) 설정이 필요하며, Manager
또는 Session Server를 VM에 설치할 경우 설치 대상 VM이 준비되어 있어야
한다.</p>
</li>
<li>
<p>&lt;Network 환경 점검&gt;<br>
시스템 구성 Server간 통신이 가능한지 점검하여야 한다. Container N/W
내부에 모두 설치되는 경우는 일반적으로 통신 제약이 없지만, VM 혼합
방식으로 구성되는 경우 Manager Server, Web Server, WAS, Session
Server간 통신이 가능한지 사전 확인이 필요하다. 다음은 LENA Image
기준으로 Service 또는 상호 통신을 위해 필요한 N/W Port 이다.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">용도</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB/WAS/Session Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>TCP 7700<br>
TCP 16100<br>
UDP 16100</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Manager 서비스 제공</p>
</div>
<div class="paragraph">
<p>모니터링, 등록</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bastion, 관리자 PC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP 7700</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager 서비스 제공</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">L/B , Front End</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP 7180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">서비스 제공</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">L/B , Front End</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WAS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP 8180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">서비스 제공</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WAS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP 5180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">서비스 제공</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>&lt;Image 접근 환경 점검&gt;<br>
LENA 공개 Image를 활용하기 위해서는 Container 플랫폼에서 Docker Hub에
접속이 가능해야 한다. 만약 접근이 불가능 하다면, 접근 가능한 환경에서
LENA Image를 Pull 받고 (docker pull), 이를 파일로 저장하여 (docker save)
해당 플랫폼에서 접근 가능한 환경에 적재 (docker load) 하여야 한다.
아래는 이를 처리하는 예시 이다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ sudo docker pull lenacloud/lena-cluster: 1.3.1.0_3-jdk8-openjdk
... &lt;출력 생략&gt;
$ sudo docker save -o lena-cluster.tar lenacloud/lena-cluster:1.3.1n.0_3-jdk8-openjdk
... &lt;출력 생략&gt;
$ sudo docker load -i lena-cluster.tar
... &lt;출력 생략&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installation_prerequistes-baseImage"><a class="link" href="#installation_prerequistes-baseImage">3.2. Base Image 생성</a></h3>
<div class="paragraph">
<p>WAS 나 WEB Server의 경우 Base Image를 재생성해야 필요가
발생할 수 있다. 다음에서는 LENA Image를 상속하여 Base Image를
생성(Build) 에 대해 설명한다. Base Image생성은 LENA Image를 활용하는
Dockerfile을 작성하고, 이 파일로 Docker Image를 생성하고 공유
Repository에 등록하는 전체 과정이다.</p>
</div>
<div class="paragraph">
<p>예상되는 Base Image의 주요 변경 사항은 다음과 같은 Case가 있다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>필수 Library 추가<br>
OS별 설치 명령어 (yum, apt-get 등)를 이용하거나, 직접 설치한다.</p>
</li>
<li>
<p>JDK의 변경<br>
LENA Base Image의 JDK를 변경하고자 할 때, 설치 명령어 또는 직접 압축해제
방식으로 설치한다.</p>
</li>
<li>
<p>Application Deployment<br>
Application Deployment기본 위치는
‘/usr/local/lena/server/appServer/webapps’ 이다.<br>
여기에 직접 WAR 파일 또는 Exploded된 Directory를 복사하여 Deployment 할
수 있다. 이 경우에는 WAR 파일명 또는 Directory명이 Context Path로
지정된다.<br>
다른 방식으로는 개별 Application 설정을 통해 지정된 위치(DocBase)에
WAR 또는 Directory를 복사하는 방식으로도 Deploy 할 수 있다. 이 경우에는
설정에서 지정한 Context Path로 Application이 서비스 된다.<br>
상세 설정은 별도로 제공되는 ‘운영자매뉴얼’의 Application 설정 부분을
참조한다.</p>
</li>
<li>
<p>실행 Command Script의 수정<br>
LENA의 기본 Container 실행 Command는 ${LENA_HOME}/docker-entrypoint.sh
이다. 초기 환경변수에 따른 환경설정 및 Server 설정파일 다운로드, License
다운로드, Server의 실행 등이 실행되는 Shell Script로서, Project 환경에
맞도록 변경이 필요한 경우 이를 수정하여 적용한다.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_base_image_생성_절차"><a class="link" href="#_base_image_생성_절차">3.2.1. Base Image 생성 절차</a></h4>
<div class="paragraph">
<p>Base Image의 생성 절차는 다음과 같다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dockerfile 작성</p>
</li>
<li>
<p>Docker Image 빌드</p>
</li>
<li>
<p>Docker Image 등록</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_dockerfile_작성"><a class="link" href="#_dockerfile_작성">Dockerfile 작성</a></h5>
<div class="paragraph">
<p>다음 코드는 Base Image를 생성하기 위한 Dockerfile 예시이며, CentOS
기반의 Application Serve 를 기준으로 작성하였다.</p>
</div>
<div class="listingblock">
<div class="title">Dockerfile 샘플</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="dockerfile"># Before building it, you need to check the proper LENA image repository
&amp; tag.

FROM lenacloud/lena-cluster:1.3.1.0_3-jdk8-openjdk

# Change or add JDK &amp; packages as your own policy.

# RUN yum install -y new-lib-01 new-lib-02
java-1.8.0-openjdk-devel.x86_64

# RUN yum update -y

# The service address of LENA manager.

ENV LENA_MANAGER_ADDRESS lena-manager.default.svc.cluster.local:7700

# The key to access LENA manager.

ENV LENA_MANAGER_KEY you_manager_key_from_manager_user_admin_menu

# Id of template. Format is &lt;Service Container Name&gt;:&lt;Version&gt;.

ENV LENA_CONFIG_TEMPLATE_ID WAS-001:3

# To download and validate your license, LENA_CONTRACT_CODE is required.

# You can acquired it via LENA supplier.

ENV LENA_CONTRACT_CODE your_own_lena_contract_code

# Download &amp; change template files from manager.

RUN ${LENA_HOME}/docker-entrypoint.sh download_template

# If you have your own license file, copy it.

#COPY license.xml ${LENA_HOME}/license/

# If you uploaded container license file to manager, you can download it
from manager

# RUN ${LENA_HOME}/docker-entrypoint.sh download_license

# COPY license.xml ${LENA_HOME}/license/

# Copy your application source to deployment path.

#COPY application.war ${LENA_SERVER_HOME}/webapps/</code></pre>
</div>
</div>
<div class="paragraph">
<p>위 샘플 Dockerfile의 구조는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. 샘플 Dockerfile의 항목별 설명</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">구성 순서</th>
<th class="tableblock halign-left valign-top">설명</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">상위 Layer Image 지정</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt;구문&gt;FROM ${상위 Image}<br>
상위 Image로 LENA Image 또는 LENA Image를 상속받은 Image<br>
※ Project에서 선택한Base Image의 Repository/Tag를 입력한다.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Library 추가 설치</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt;구문&gt; RUN yum install ${추가 Library}<br>
OS 별로 패키지 설치 명령어를 활용하여 필요 Library를 추가하고, 패키지 별
별도의 설치 방법이 필요할 경우 해당 패키지의 가이드에 따라 Library를
추가 설치한다.</p>
</div>
<div class="paragraph">
<p>&lt;JDK 재설치&gt;<br>
JDK도 Library 추가와 동일한 방식으로 설치할 수 있다. 다만, LENA의
Server들이 JDK를 참조하고 있으므로, 다음의 설정정보도 변경하여야 한다.<br>
* Symbolic Link ‘/usr/lib/jvm/java‘을 설치된 JDK 위치에 맞도록 재설정
하여야 한다.<br>
위 정보는 다음 부분에서 사용하고 있다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>환경변수 ${JAVA_HOME}</p>
</li>
<li>
<p>JDK 설치위치 : ${LENA_HOME}/etc/info/ java-home.info 값</p>
</li>
<li>
<p>Server 환경설정 : ${LENA_HOME}/env.sh의 JAVA_HOME 값</p>
</li>
<li>
<p>docker-entrypoint.sh에서 domain cache값 TTL 설정</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">환경변수 설정</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt;구문&gt; ENV ${key} ${value}<br>
하위의 설정정보 또는 라이선스를 다운로드 받기 위한 환경변수를 설정한다.
여기에 설정된 값은 Container 기동시점에도 사용될 수 있다.<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>LENA_MANAGER_ADDRESS : 설치된 Manager의 Service 주소</p>
</li>
<li>
<p>LENA_MANAGER_KEY : Open API로 Manager 접근시 필요한 인증토큰<br>
(Manager의 Admin &gt; Users 메뉴에서 확인가능)</p>
</li>
<li>
<p>LENA_CONFIG_TEMPLATE_ID : 다운로드 할 설정정보 식별자, (Service Cluster
이름 + “:” + Revision 번호)</p>
</li>
<li>
<p>ENV LENA_CONTRACT_CODE : 라이선스 다운로드를 위한 계약 코드</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">설정정보 다운로드</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt;구문&gt; RUN ${LENA_HOME}/docker-entrypoint.sh download_template</p>
</div>
<div class="paragraph">
<p>Manager로 부터 설정정보를 Download 한다. curl / wget 등의 명령으로 Open
API를 호출한다.</p>
</div>
<div class="paragraph">
<p>Manager다운로드시 후, 압축파일 해제, Mod/Owner/Group 수정을 실행한다.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">라이선스 복사 또는 다운로드</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt;구문&gt; RUN curl -o \${LENA_HOME}/license/license.xml &#8230;&#8203;&lt;이하생략&gt;</p>
</div>
<div class="paragraph">
<p>Manager로부터 License를 다운로드 받는다. 다운로드 후 XML Validation 및
Owner/Group 수정을 한다.</p>
</div>
<div class="paragraph">
<p>COPY license.xml ${LENA_HOME}/license/</p>
</div>
<div class="paragraph">
<p>별도로 발급받은 License가 있을 경우 Container 내부로 복사한다.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Artifact 복사</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt;구문&gt; COPY application.war ${LENA_SERVER_HOME}/webapps/</p>
</div>
<div class="paragraph">
<p>Application Artifact (예제에서는 application.war) 파일을 Deploy위치에
복사한다. 기본 위치는 아래와 같다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WAS : ${LENA_SERVER_HOME}/webapps/</p>
</li>
<li>
<p>WEB Server : ${LENA_SERVER_HOME}/webapps/htdocs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>위 위치는 개별 Server 및 Application 설정에 의해 변경가능하다.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>완성된 Dockerfile을 기반으로 Image를 Build할 수 있으며 (docker build),
Build 후 Docker Hub 나 ECR과 같은 Registry에 등록 (docker register)하여
Container Platform에서 활용할 수 있도록 한다.</p>
</div>
</div>
<div class="sect4">
<h5 id="_docker_image_빌드"><a class="link" href="#_docker_image_빌드">Docker Image 빌드</a></h5>
<div class="paragraph">
<p>다음은 Dockerfile로 Image를 Build하는 명령어이다. 사전에 Image의
Repository 및 Tag Rule을 정의하여야 하며, 마지막 인자값에 Dockerfile의
위치를 지정하는 것에 유의한다. (하기 예시는 Current Path에 Dockerfile이
있을 경우에 유효하다.)</p>
</div>
<div class="listingblock">
<div class="title">Docker Image 빌드 실행 명령어 (예시)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker build --no-cache --rm --tag [REPOSITORY[:TAG]] .</code></pre>
</div>
</div>
<div class="paragraph">
<p>상기된 명령어에 사용된 옵션은 다음과 같다. 옵션은 Project환경에 맞도록
선별하여 사용한다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>--no-cache : 이전 빌드에서 생성된 캐시를 사용하지 않음</p>
</li>
<li>
<p>--rm : 이미지 생성에 성공했을 때 임시 컨테이너를 삭제</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_docker_image_등록"><a class="link" href="#_docker_image_등록">Docker Image 등록</a></h5>
<div class="paragraph">
<p>다음은 Image Registry에 Image를 등록하는 명령어이다. 사전에 Registry에
등록 가능한 권한을 가진 사용자와 암호 등 환경설정을 필요로 한다.</p>
</div>
<div class="listingblock">
<div class="title">Docker Image 등록 실행 명령어 (예시)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker push [OPTIONS] [REPOSITORY[:TAG]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>기타 상세 Docker 관리 명령어는 다음 공식 Site를 참조한다.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.docker.com/engine/reference/commandline/docker/" class="bare">https://docs.docker.com/engine/reference/commandline/docker/</a></p>
</div>
<div class="paragraph">
<p>docker commit은 현재 운영중인 Docker Container를 Image로 등록하는 명령어이다.</p>
</div>
<div class="listingblock">
<div class="title">운영중인 Container를 Image로 등록 (예시)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kubernetes_기반_배포"><a class="link" href="#_kubernetes_기반_배포">4. Kubernetes 기반 배포</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_배포_공통사항"><a class="link" href="#_배포_공통사항">4.1. 배포 공통사항</a></h3>
<div class="sect3">
<h4 id="_배포_준비"><a class="link" href="#_배포_준비">4.1.1. 배포 준비</a></h4>
<div class="paragraph">
<p>LENA 설치 사전에 Kubernetes 실행환경이 구성되어 있어야 한다. 다음 각
항목들이 준비되어야 할 사항이다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>LENA를 구동할 Kubernetes Cluster와 Namespace의 구성</p>
</li>
<li>
<p>kubectl이 설치되고 CLI가 가능한 환경 마련</p>
</li>
<li>
<p>Kubernetes Cluster에 접근이 가능하도록 Kubernetes 설정
(~/.kube/config)의 구성</p>
</li>
<li>
<p>접근 가능한 Docker Repository (예 : ECR, Docker Hub, 내부 Docker
Repository 등)</p>
</li>
<li>
<p>(옵션) Kubernetes Config 파일 : LENA Manager에서 Log 및 Terminal 접속을
위해 Manager에 업로드 필요</p>
</li>
<li>
<p>LENA Container License 및 계약코드</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_배포_실행"><a class="link" href="#_배포_실행">4.1.2. 배포 실행</a></h4>
<div class="paragraph">
<p>Kubernetes는 오케스트레이션 도구별로 다양한 배포 방식이 존재하지만, 본
문서에서는 기본 도구인 kubectl을 활용하는 것을 기준으로 설명한다.</p>
</div>
<div class="paragraph">
<p>Kubernetes는 Resource의 배포 방식, 환경설정정보, 스펙 등을 기술한
YAML형식의 명세 파일을 활용하여 배포/삭제/업데이트를 수행한다. 하기에
설명되는 ${manifest-file.yaml}은 이 명세서를 지칭한다. 본 문서에서는
배포에 필요한 최소한의 명령어 및 옵션만을 기술하므로, 상세한 내용은
공개된 Kubernetes 설명서를 참조한다.</p>
</div>
<div class="sect4">
<h5 id="_작업_namespace의_설정"><a class="link" href="#_작업_namespace의_설정">작업 namespace의 설정</a></h5>
<div class="paragraph">
<p>하기의 모든 배포관련 작업은 namespace 단위로 이루어지므로, 배포를 하기
앞서 작업 대상이 되는 namespace를 설정하여야 한다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl config set-context --current --namespace=${namespace}</code></pre>
</div>
</div>
<div class="paragraph">
<p>위의 방식으로 설정하지 않을 시 하기의 모든 실행 명령어 뒤에
‘--namespace=${namespace}’ 구문을 추가하여야 한다. 다음은 그 예시이다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f ${manifest-file.yaml} --namespace=${namespace}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kubernetes_resource배포_및_업데이트"><a class="link" href="#_kubernetes_resource배포_및_업데이트">Kubernetes Resource배포 및 업데이트</a></h5>
<div class="paragraph">
<p>‘kubectl apply’ 명령어를 통해 배포를 실행하고, 그 형식은 다음과 같다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f ${manifest-file.yaml}</code></pre>
</div>
</div>
<div class="paragraph">
<p>위 명령어는 배포 뿐아니라, 동일 namespace의 동일 name을 가진 Object가
존재할 경우 해당 Resource의 명세를 업데이트 한다.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kubernetes_resource의_삭제"><a class="link" href="#_kubernetes_resource의_삭제">Kubernetes Resource의 삭제</a></h5>
<div class="paragraph">
<p>‘kubectl delete’ 명령어로 배포된 Resource를 삭제한다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl delete –f ${manifest-file.yaml}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_workload_업데이트_및_롤백"><a class="link" href="#_workload_업데이트_및_롤백">Workload 업데이트 및 롤백</a></h5>
<div class="paragraph">
<p>Application, Web Server의 경우 Application Artifact의 변경 등에 의해
배포된 Workload 업데이트가 필요할 수 있다. Kubernetes에서는 이를 Rolling
방식으로 업데이트하는 방법을 제공한다.</p>
</div>
<div class="paragraph">
<p>다음은 배포된 Workload를 Rolling방식으로 업데이트 하는 명령어이다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl rollout restart ${workloadType}/${workloadName}</code></pre>
</div>
</div>
<div class="paragraph">
<p>위 명령어를 통해 Workload가 갱신되며 순차적인 개정(Revision)이 생성된다.
Revision 목록을 조회하는 명령어는 다음과 같다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl rollout history ${workloadType}/${workloadName}</code></pre>
</div>
</div>
<div class="paragraph">
<p>다음은 직전 상태로 롤백하는 명령어 이다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl rollout undo ${workloadType}/${workloadName}</code></pre>
</div>
</div>
<div class="paragraph">
<p>다음은 입력된 Revision으로 롤백하는 명령어 이다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl rollout undo ${workloadType}/${workloadName}
--to-revision=${revisionNo}</code></pre>
</div>
</div>
<div class="paragraph">
<p>위 명령어에서 인자값 ${workloadType}은 Workload의 유형으로 그 값은
‘statefulset’, ‘deployment’, ‘daemonset’ 중 하나이다.
${workloadName}은 Workload의 이름이고, ${revisionNo}는 개정(Revision)
값이다.</p>
</div>
</div>
<div class="sect4">
<h5 id="_배포된_resource의_확인"><a class="link" href="#_배포된_resource의_확인">배포된 Resource의 확인</a></h5>
<div class="paragraph">
<p>베포된 Workload, Service등의 Kubernetes Object를 확인하는 명령어 kubectl
get이다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get ${resourceType}</code></pre>
</div>
</div>
<div class="paragraph">
<p>위 명령어에서 ${resourceType}은 ‘statefulsets’, ‘deployments’,
‘daemonsets’, ‘services’, ‘configMaps’와 같은 Kubernetes Resource 유형 중
하나이다.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manager_배포"><a class="link" href="#_manager_배포">4.2. Manager 배포</a></h3>
<div class="sect3">
<h4 id="_설정_항목"><a class="link" href="#_설정_항목">4.2.1. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목"><a class="link" href="#_기본_설정_항목">기본 설정 항목</a></h5>
<div class="paragraph">
<p>Manager Container는 다음과 같은 권고 설정을 기준으로 배포되어야 한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workload 종류</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">StatefulSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 7700<br>
UDP : 16100<br>
TCP : 16100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Volume Mount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">디렉토리 /usr/local/lena/repository를 외부 Volume에 매핑
(아래 예제에서는 persistentVolumeClaim 방식으로 매핑)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe (Health Check)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpGetAction, ‘/lena’ 페이지 호출</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_workload_관련"><a class="link" href="#_적용시점_결정_항목_workload_관련">적용시점 결정 항목 – Workload 관련</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Manifest 파일에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-manager:1.5.0.1-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workload의 이름, 이 값은 Pod 이름 / Hostname의 Prefix로 사용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service와의 연결, 검색에 사용되는 Label로 Key: Value쌍으로
정의된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type: sample-lena-manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagePullPolicy</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>이미지 Pull 정책으로 다음 중 하나를 선택한다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always : Repository로부터 항상 Pull받음</p>
</li>
<li>
<p>IfNotPresent : Local에 Image가 없을 경우 에만 Pull 받음</p>
</li>
<li>
<p>Never : Pull 받지 않음</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">기타 환경변수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">환경변수의 설정은 ENV 또는 Config Map으로 설정 가능</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(configMap 방식)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.
각 환경변수에 대한 상세한 설명은 본문서 <a href="./020.architecture_decision.html#architecture_decision_manager_env">Manager 환경변수</a> 부분을 참조한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_HEAP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heap Memory 크기 지정</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024m (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_METASPACE_SIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metaspace Memory크기</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256m (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_DOMAIN_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain Name 활성화 여부</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service의 Domain 주소 : 포트</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.default.svc.cluster.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain 주소 Cache 시간 (초)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 (기본)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_service관련"><a class="link" href="#_적용시점_결정_항목_service관련">적용시점 결정 항목 – Service관련</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service를 식별하는 이름으로, namespace내에서 유일한 값이 어야
한다. 이 값은 Service Domain주소에 적용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>외부로 Service를 노출하는 방식으로, 다음 중 하나 이다.<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>NodePort : k8s가 설치된 모든 Node의 지정 Port로 서비스</p>
</li>
<li>
<p>LoadBalancer : 외부 Loadbalancer를 통한 서비스</p>
</li>
<li>
<p>ClusterIp : k8s Cluster내 전용으로, 고정된 IP로 서비스</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NodePort</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_manifest_기반_배포"><a class="link" href="#_manifest_기반_배포">4.2.2. Manifest 기반 배포</a></h4>
<div class="sect4">
<h5 id="_workload"><a class="link" href="#_workload">Workload</a></h5>
<div class="paragraph">
<p>Kubernetes에서의 Container는 Pod 단위로 설치되며, Kubernetes Object를
기술한 YAML 파일형식의 Manifest 파일을 작성하여 설치하는 것이 일반적인
방식이다.</p>
</div>
<div class="paragraph">
<p>다음은 Manager를 설치하기 위한 Manifest 파일 샘플이고, 상세 내용은 앞서
설명된 설정 항목의 결정에 따라 Project 환경에 맞도록 변경하여 사용할 수
있다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Manager Workload명세 (Manifest) 파일</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">StatefulSet</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">lena-manager</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">type</span>: <span class="string"><span class="content">lena-manager</span></span>
  <span class="key">serviceName</span>: <span class="string"><span class="content">lena-manager</span></span>
  <span class="key">replicas</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">type</span>: <span class="string"><span class="content">lena-manager</span></span>
    <span class="key">spec</span>:
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: lena-manager</span></span>
        <span class="key">image</span>: <span class="string"><span class="content">docker.io/lenasupport/lena-manager:1.5.0.1-jdk8-openjdk</span></span>
        <span class="key">imagePullPolicy</span>: <span class="string"><span class="content">Always</span></span>
        <span class="key">ports</span>:
        - <span class="string"><span class="content">containerPort: 7700</span></span>
        <span class="key">envFrom</span>:
        - <span class="string"><span class="content">configMapRef:</span><span class="content">
            name: configmap-lena-manager</span></span>
        <span class="key">volumeMounts</span>:
        - <span class="string"><span class="content">name: wsy-lena-manager-repository</span></span>
          <span class="key">mountPath</span>: <span class="string"><span class="content">/usr/local/lena/repository</span></span>
        <span class="key">readinessProbe</span>:
          <span class="key">httpGet</span>:
            <span class="key">path</span>: <span class="string"><span class="content">/lena</span></span>
            <span class="key">port</span>: <span class="string"><span class="content">7700</span></span>
          <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">20</span></span>
          <span class="key">timeoutSeconds</span>: <span class="string"><span class="content">1</span></span>
        <span class="key">livenessProbe</span>:
          <span class="key">httpGet</span>:
            <span class="key">path</span>: <span class="string"><span class="content">/lena</span></span>
            <span class="key">port</span>: <span class="string"><span class="content">7700</span></span>
          <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">30</span></span>
          <span class="key">periodSeconds</span>: <span class="string"><span class="content">5</span></span>
      <span class="key">volumes</span>:
        - <span class="string"><span class="content">name: wsy-lena-manager-repository</span></span>
          <span class="key">persistentVolumeClaim</span>:
            <span class="key">claimName</span>: <span class="string"><span class="content">lena-manager-repository</span></span>
      <span class="key">terminationGracePeriodSeconds</span>: <span class="string"><span class="content">0</span></span>

<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ConfigMap</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">configmap-lena-manager</span></span>
<span class="key">data</span>:
  <span class="key">LENA_MANAGER_DOMAIN_ENABLED</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.default.svc.cluster.local:7700</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 kubectl apply 명령으로 실행한다. 파일명이
lena-manager-deployment-sample.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f lena-manager-deployment-sample.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 kubectl get 명령어 실행을 통해 확인할 수 있다.<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl get statefulsets

NAME            READY   AGE
lena-manager    1/1     10s</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_service"><a class="link" href="#_service">Service</a></h5>
<div class="paragraph">
<p>다음은 Manager Service를 배포하기 위한 Manifest 파일은 다음과 같다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Manager Service명세 (Manifest) 파일</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">lena-manager</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">type</span>: <span class="string"><span class="content">lena-manager</span></span>
  <span class="key">ports</span>:
  - <span class="string"><span class="content">name: manager-tcp</span></span>
    <span class="key">port</span>: <span class="string"><span class="content">7700</span></span>
    <span class="key">targetPort</span>: <span class="string"><span class="content">7700</span></span>
    <span class="key">nodePort</span>: <span class="string"><span class="content">31848</span></span>
    <span class="key">protocol</span>: <span class="string"><span class="content">TCP</span></span>
  - <span class="string"><span class="content">name: monitoring-tcp</span></span>
    <span class="key">port</span>: <span class="string"><span class="content">16100</span></span>
    <span class="key">targetPort</span>: <span class="string"><span class="content">16100</span></span>
    <span class="key">protocol</span>: <span class="string"><span class="content">TCP</span></span>
  - <span class="string"><span class="content">name: monitoring-udp</span></span>
    <span class="key">port</span>: <span class="string"><span class="content">16100</span></span>
    <span class="key">targetPort</span>: <span class="string"><span class="content">16100</span></span>
    <span class="key">protocol</span>: <span class="string"><span class="content">UDP</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">NodePort</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 kubectl apply 명령으로 실행한다. 파일명이
lena-manager-service-sample.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f lena-manager-service-sample.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 kubectl get 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get services
NNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
...
lena-manager NodePort 10.43.xx.xx &lt;none&gt; 7700:30770/TCP,16100:31610/UDP
10s</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manager_접속"><a class="link" href="#_manager_접속">4.2.3. Manager 접속</a></h4>
<div class="paragraph">
<p>Service 유형을 NodePort로 설정하였다면 http://[Node IP]: [Node Port] / 에 접속하여 Manager에 접속한다.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_session_server_배포"><a class="link" href="#_session_server_배포">4.3. Session Server 배포</a></h3>
<div class="sect3">
<h4 id="kubernetes_based_deployment-session-prepare"><a class="link" href="#kubernetes_based_deployment-session-prepare">4.3.1. 배포 준비</a></h4>
<div class="paragraph">
<p>배포 전에 Manager에 Session Server를 등록하기 위해서는 Manager에서
‘Service Cluster’를 등록하여야 한다. Manager의 ‘Cluster &gt; Session
Cluster’ 메뉴 위치에서 Session Server 유형의 신규 Service Cluster를
생성한다.</p>
</div>
<div class="paragraph">
<p>Service Cluster생성 및 관리 관련 상세한 내용은 별도제공 문서인 ‘운영자
매뉴얼’을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="_설정_항목_2"><a class="link" href="#_설정_항목_2">4.3.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_2"><a class="link" href="#_기본_설정_항목_2">기본 설정 항목</a></h5>
<div class="paragraph">
<p>Session Server Container는 다음과 같은 권고 설정을 기준으로 배포되어야
한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workload 종류</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">StatefulSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 (Primary, Secondary Server 2개)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 5180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ExecAction, ${LENA_SERVER_HOME}/health.sh 호출</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_workload_관련_2"><a class="link" href="#_적용시점_결정_항목_workload_관련_2">적용시점 결정 항목 – Workload 관련</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Manifest 파일에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-session:1.5.0.1-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workload의 이름, 이 값은 Pod 이름 / Hostname의 Prefix로 사용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena- session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service와의 연결, 검색에 사용되는 Label로 Key: Value쌍으로
정의된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type: lena-session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagePullPolicy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">이미지 Pull 정책</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">기타 환경변수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">환경변수의 설정은 ENV 또는 Config Map으로 설정 가능</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(configMap 방식)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.
각 환경변수에 대한 상세한 설명은 본문서 <a href="./020.architecture_decision.html#architecture_decision_session_env">Session 환경변수</a> 부분을 참조한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_HEAP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Heap Memory 크기 지정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024m (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SESSION-001</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sample-lena-manager.default.svc.cluster.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain 주소 Cache 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_0_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Primary Session 서버 주소, StatefulSet설정과 일치되어야 함</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-session-0<br>
.default.svc.cluster.local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_1_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Secondary Session 서버 주소, StatefulSet설정과 일치되어야 함</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-session-1<br>
.default.svc.cluster.local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_EXPIRE_SEC</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Session 만료 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1800 (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_SHARE_SESSION</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application 간 Session 공유여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_service관련_2"><a class="link" href="#_적용시점_결정_항목_service관련_2">적용시점 결정 항목 – Service관련</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service를 식별하는 이름으로, namespace내에서 유일한 값이 어야
한다. 이 값은 Service Domain주소에 적용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">외부로 Service를 노출하는 방식으로, Session Server에는 지정하지
않는다.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_manifest_기반_배포_2"><a class="link" href="#_manifest_기반_배포_2">4.3.3. Manifest 기반 배포</a></h4>
<div class="sect4">
<h5 id="_workload_2"><a class="link" href="#_workload_2">Workload</a></h5>
<div class="paragraph">
<p>Kubernetes에서의 Container는 Pod 단위로 설치되며, Kubernetes Object를
기술한 YAML 파일형식의 Manifest 파일을 작성하여 설치하는 것이 일반적인
방식이다.</p>
</div>
<div class="paragraph">
<p>다음은 Manager를 설치하기 위한 Manifest 파일 샘플이고, 상세 내용은 앞서
설명된 설정 항목의 결정에 따라 Project 환경에 맞도록 변경하여 사용할 수
있다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Session Workload명세 (Manifest) 파일 예시</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">StatefulSet</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">lena-session</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">type</span>: <span class="string"><span class="content">lena-session</span></span>
  <span class="key">serviceName</span>: <span class="string"><span class="content">lena-session</span></span>
  <span class="key">replicas</span>: <span class="string"><span class="content">2</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">type</span>: <span class="string"><span class="content">lena-session</span></span>
    <span class="key">spec</span>:
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: lena-session</span></span>
        <span class="key">image</span>: <span class="string"><span class="content">docker.io/lenasupport/lena-session:1.5.0.1-jdk8-openjdk</span></span>
        <span class="key">imagePullPolicy</span>: <span class="string"><span class="content">Always</span></span>
        <span class="key">ports</span>:
        - <span class="string"><span class="content">containerPort: 5180</span></span>
        <span class="key">envFrom</span>:
        - <span class="string"><span class="content">configMapRef:</span><span class="content">
            name: configmap-lena-session</span></span>
        <span class="key">tty</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">readinessProbe</span>:
          <span class="key">exec</span>:
            <span class="key">command</span>:
            - <span class="string"><span class="content">/usr/local/lena/servers/sessionServer/health.sh</span></span>
          <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">20</span></span>
          <span class="key">periodSeconds</span>: <span class="string"><span class="content">5</span></span>
        <span class="key">livenessProbe</span>:
          <span class="key">exec</span>:
            <span class="key">command</span>:
            - <span class="string"><span class="content">/usr/local/lena/servers/sessionServer/health.sh</span></span>
          <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">30</span></span>
          <span class="key">periodSeconds</span>: <span class="string"><span class="content">5</span></span>
      <span class="key">terminationGracePeriodSeconds</span>: <span class="string"><span class="content">0</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ConfigMap</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">configmap-lena-session</span></span>
<span class="key">data</span>:
  <span class="key">LENA_SESSION_0_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-session-0.lena-session.default.svc.cluster.local:5180</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_SESSION_1_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-session-1.lena-session.default.svc.cluster.local:5180</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.default.svc.cluster.local:7700</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_SESSION_EXPIRE_SEC</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1800</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_CONFIG_TEMPLATE_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">SESSION-001</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_CONFIG_SHARE_SESSION</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">N</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 kubectl apply 명령으로 실행한다. 파일명이
lena-session-deployment-sample.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f lena-session-deployment-sample.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인&gt;<br>
배포된 Workload는 kubectl get 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get statefulsets
NAME READY AGE
lena-manager 1/1 30m
lena-session 2/2 10s</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_service_2"><a class="link" href="#_service_2">Service</a></h5>
<div class="paragraph">
<p>다음은 Session Service를 배포하기 위한 Manifest 파일은 다음과 같다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Session Service명세 (Manifest) 파일 예시*</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">lena-session</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">type</span>: <span class="string"><span class="content">lena-session</span></span>
  <span class="key">clusterIP</span>: <span class="string"><span class="content">None</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 kubectl apply 명령으로 실행한다. 파일명이
lena-session-service-sample.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl apply –f lena-session-service-sample.yaml</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 kubectl get 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl get services
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
...
lena-session ClusterIP None &lt;none&gt; &lt;none&gt; 10s
...</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_등록_확인"><a class="link" href="#_server_등록_확인">4.3.4. Server 등록 확인</a></h4>
<div class="paragraph">
<p>Manager에 접속하여 ‘Cluster &gt; Service Cluster’ 메뉴에서 해당 Service
Cluster를 선택하여 정상 등록여부를 확인한다.
<span class="button">ServerList버튼</span>
을 클릭하면 하단에 2개의 Session Server가 조회되는 것을 확인한다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server는 Manager의 Scheduler에 의해 등록되므로, 최대 15초 후 자동 등록된다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_was_배포"><a class="link" href="#_was_배포">4.4. WAS 배포</a></h3>
<div class="sect3">
<h4 id="kubernetes_based_deployment-application-prepare"><a class="link" href="#kubernetes_based_deployment-application-prepare">4.4.1. 배포 준비</a></h4>
<div class="paragraph">
<p>배포 전에 Manager에 WAS Server를 등록하기 위해서는 Manager에서
‘Service Cluster’를 등록하여야 한다. Manager의 ‘Cluster &gt; Server
Cluster’ 메뉴 위치에서 WAS(Enterprise/SE) 유형의 신규 Service
Cluster를 생성한다.</p>
</div>
<div class="paragraph">
<p>Service Cluster를 생성한 후 Overview 탭에서 Service Endpoint를 설정한다.
Kubernetes의 경우
“http://${Service명}.${namespace명}.svc.cluster.localhost:${Service
포트}” 형식이 된다. 이 값은 Web Server의 VirtualHost의 Proxy설정에서 활용된다.</p>
</div>
<div class="paragraph">
<p>생성된 Service Cluster의 Template 탭에서 WAS의 설정을
수행한다. 설정정보 저장 후 Template에 대한 Revision을 생성한다.
Service Cluster생성 및 관리 관련 상세한 내용은 별도제공 문서인 ‘운영자
매뉴얼’을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="_설정_항목_3"><a class="link" href="#_설정_항목_3">4.4.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_3"><a class="link" href="#_기본_설정_항목_3">기본 설정 항목</a></h5>
<div class="paragraph">
<p>WAS Container는 다음과 같은 권고 설정을 기준으로 배포
된다..</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workload 종류</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 8180</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_workload_관련_3"><a class="link" href="#_적용시점_결정_항목_workload_관련_3">적용시점 결정 항목 – Workload 관련</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Manifest 파일에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-cluster:1.5.0.1-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workload의 이름, 이 값은 Pod 이름 / Hostname의 Prefix로 사용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service와의 연결, 검색에 사용되는 Label로 Key: Value쌍으로
정의된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type: lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">strategy:type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment Update 정책, RollingUpdate, Recreate중 선택한
Update정책명을 기술</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RollingUpdate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagePullPolicy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">이미지 Pull 정책</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replica 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container (Pod) 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpGetAction, 체크 Page, 시작 Delay 시간, 주기는 Application
특성에 맞도록 설정 필요</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">‘/’ 호출</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">기타 환경변수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">환경변수의 설정은 ENV 또는 Config Map으로 설정 가능</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(configMap 방식)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.
각 환경변수에 대한 상세한 설명은 본문서 <a href="./020.architecture_decision.html#architecture_decision_application_env">WAS 환경변수</a> 부분을 참조한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WAS-001:1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트<br>
(앞서 설치된 Manager의 Service 주소)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.default.svc.cluster.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_KEY</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA_MANAGER_KEY : Open API로 Manager 접근시 필요한 인증토큰</p>
</li>
<li>
<p>Manager의 Admin &gt; Users 메뉴에서 확인 가능</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 Manager에서 확인 입력 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_DOWNLOAD</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>설정 정보 다운로드 여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONTRACT_CODE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>라이선스 다운로드를 위한 계약 코드</p>
</li>
<li>
<p>라이선스 발급 시 제공된 코드 값</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 코드 확인 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LICENSE_DOWNLOAD_URL</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain 주소 Cache 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 (기본)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_service관련_3"><a class="link" href="#_적용시점_결정_항목_service관련_3">적용시점 결정 항목 – Service관련</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service를 식별하는 이름으로, namespace내에서 유일한 값이 어야
한다. 이 값은 Service Domain주소에 적용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">외부로 Service를 노출하는 방식, 외부로 노출할 요건이 없으면 별도
설정이 불필요</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_manifest_기반_배포_3"><a class="link" href="#_manifest_기반_배포_3">4.4.3. Manifest 기반 배포</a></h4>
<div class="sect4">
<h5 id="_workload_3"><a class="link" href="#_workload_3">Workload</a></h5>
<div class="paragraph">
<p>Kubernetes에서의 Container는 Pod 단위로 설치되며, Kubernetes Object를
기술한 YAML 파일형식의 Manifest 파일을 작성하여 설치하는 것이 일반적인
방식이다.</p>
</div>
<div class="paragraph">
<p>다음은 Manager를 설치하기 위한 Manifest 파일 샘플이고, 상세 내용은 앞서
설명된 설정 항목의 결정에 따라 Project 환경에 맞도록 변경하여 사용할 수
있다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Session Workload명세 (Manifest) 파일 예시*</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">lena-was</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">type</span>: <span class="string"><span class="content">lena-was</span></span>
  <span class="key">replicas</span>: <span class="string"><span class="content">2</span></span>
  <span class="key">strategy</span>:
    <span class="key">type</span>: <span class="string"><span class="content">RollingUpdate</span></span>
  <span class="key">minReadySeconds</span>: <span class="string"><span class="content">10</span></span>
  <span class="key">revisionHistoryLimit</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">type</span>: <span class="string"><span class="content">lena-was</span></span>
    <span class="key">spec</span>:
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: lena-was</span></span>
        <span class="key">image</span>: <span class="string"><span class="content">docker.io/lenasupport/lena-cluster:1.5.0.1-jdk8-openjdk</span></span>
        <span class="key">imagePullPolicy</span>: <span class="string"><span class="content">Always</span></span>
        <span class="key">ports</span>:
        - <span class="string"><span class="content">containerPort: 8180</span></span>
        <span class="key">envFrom</span>:
        - <span class="string"><span class="content">configMapRef:</span><span class="content">
            name: configmap-lena-was</span></span>
        <span class="key">readinessProbe</span>:
          <span class="key">httpGet</span>:
            <span class="key">path</span>: <span class="string"><span class="content">/</span></span>
            <span class="key">port</span>: <span class="string"><span class="content">8180</span></span>
          <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">10</span></span>
          <span class="key">periodSeconds</span>: <span class="string"><span class="content">5</span></span>
        <span class="key">livenessProbe</span>:
          <span class="key">httpGet</span>:
            <span class="key">path</span>: <span class="string"><span class="content">/</span></span>
            <span class="key">port</span>: <span class="string"><span class="content">8180</span></span>
          <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">15</span></span>
          <span class="key">periodSeconds</span>: <span class="string"><span class="content">5</span></span>
      <span class="key">volumes</span>:
      <span class="key">terminationGracePeriodSeconds</span>: <span class="string"><span class="content">0</span></span>

<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ConfigMap</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">configmap-lena-was</span></span>
<span class="key">data</span>:
  <span class="key">LENA_CONFIG_TEMPLATE_DOWNLOAD</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_CONFIG_TEMPLATE_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">WAS-001</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.default.svc.cluster.local:7700</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_MANAGER_KEY</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">aSw7RMPSw15LeN%2FMZnrxzjgV0BzZe18iVHZbJ8CkdLlea2Ecd8AleK9oPCLXuw%3D%3D</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_LICENSE_DOWNLOAD_URL</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_CONTRACT_CODE</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">pghzJJqTdzaGtTuASr8yfw==</span><span class="delimiter">&quot;</span></span>
<span class="key">JAVA_DOMAIN_CACHE_TTL</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행&gt;<br>
배포는 kubectl apply 명령으로 실행한다. 파일명이
lena-was-deployment-sample.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f lena-was-deployment-sample.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인&gt;<br>
배포된 Workload는 kubectl get 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get deployments
NAME READY AGE
lena-was 2/2 10s</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_service_3"><a class="link" href="#_service_3">Service</a></h5>
<div class="paragraph">
<p>다음은 Application Service를 배포하기 위한 Manifest 파일은 다음과 같다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Session Service명세 (Manifest) 파일 예시</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">lena-was</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">type</span>: <span class="string"><span class="content">lena-was</span></span>
<span class="key">ports</span>:
  - <span class="string"><span class="content">port: 8180</span></span>
    <span class="key">targetPort</span>: <span class="string"><span class="content">8180</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 kubectl apply 명령으로 실행한다. 파일명이
lena-was-service-sample.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f lena-was-service-sample.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 kubectl get 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get services
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
...
lena-was ClusterIP 10.43.xx.xx &lt;none&gt; 8180/TCP 20s</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_등록_확인_2"><a class="link" href="#_server_등록_확인_2">4.4.4. Server 등록 확인</a></h4>
<div class="paragraph">
<p>Manager에 접속하여 ‘Cluster &gt; Service Cluster’ 메뉴에서 해당 Service
Cluster를 선택하여 정상 등록여부를 확인한다.
<span class="button">Server List 버튼</span>
을 클릭하면 하단에 2개의 WAS가 조회되는 것을 확인한다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server는 Manager의 Scheduler에 의해 등록되므로, 최대 15초 후 자동 등록된다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_embedded_was_배포"><a class="link" href="#_embedded_was_배포">4.5. Embedded WAS 배포</a></h3>
<div class="sect3">
<h4 id="kubernetes_based_deployment-embedded-application-prepare"><a class="link" href="#kubernetes_based_deployment-embedded-application-prepare">4.5.1. 배포 준비</a></h4>
<div class="paragraph">
<p>배포 전에 Manager에 Embedded WAS Server를 등록하기 위해서는 Manager에서
‘Service Cluster’를 등록하여야 한다. Manager의 ‘Cluster &gt; Server
Cluster’ 메뉴 위치에서 WAS(Embedded) 유형의 신규 Service
Cluster를 생성한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="_설정_항목_4"><a class="link" href="#_설정_항목_4">4.5.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_4"><a class="link" href="#_기본_설정_항목_4">기본 설정 항목</a></h5>
<div class="paragraph">
<p>WAS Container는 다음과 같은 권고 설정을 기준으로 배포
된다..</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workload 종류</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 8180</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_workload_관련_4"><a class="link" href="#_적용시점_결정_항목_workload_관련_4">적용시점 결정 항목 – Workload 관련</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Manifest 파일에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-embedded:1.5.0.1-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workload의 이름, 이 값은 Pod 이름 / Hostname의 Prefix로 사용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service와의 연결, 검색에 사용되는 Label로 Key: Value쌍으로
정의된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type: lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">strategy:type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment Update 정책, RollingUpdate, Recreate중 선택한
Update정책명을 기술</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RollingUpdate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagePullPolicy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">이미지 Pull 정책</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replica 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container (Pod) 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpGetAction, 체크 Page, 시작 Delay 시간, 주기는 Application
특성에 맞도록 설정 필요</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">‘/’ 호출</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">기타 환경변수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">환경변수의 설정은 ENV 또는 Config Map으로 설정 가능</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(configMap 방식)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.
각 환경변수에 대한 상세한 설명은 본문서 <a href="./020.architecture_decision.html#architecture_decision_embedded_application_env">Embedded WAS 환경변수</a> 부분을 참조한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WAS-001:1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트<br>
(앞서 설치된 Manager의 Service 주소)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.default.svc.cluster.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_MONITORING_PORT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 모니터링 Port 정보</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_APP_FILE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application Jar 파일 명</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sample-app.jar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_APP_DIR</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application Jar 디렉토리 명</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local/lena</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_service관련_4"><a class="link" href="#_적용시점_결정_항목_service관련_4">적용시점 결정 항목 – Service관련</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service를 식별하는 이름으로, namespace내에서 유일한 값이 어야
한다. 이 값은 Service Domain주소에 적용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">외부로 Service를 노출하는 방식, 외부로 노출할 요건이 없으면 별도
설정이 불필요</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_manifest_기반_배포_4"><a class="link" href="#_manifest_기반_배포_4">4.5.3. Manifest 기반 배포</a></h4>
<div class="sect4">
<h5 id="_workload_4"><a class="link" href="#_workload_4">Workload</a></h5>
<div class="paragraph">
<p>Kubernetes에서의 Container는 Pod 단위로 설치되며, Kubernetes Object를
기술한 YAML 파일형식의 Manifest 파일을 작성하여 설치하는 것이 일반적인
방식이다.</p>
</div>
<div class="paragraph">
<p>다음은 Manager를 설치하기 위한 Manifest 파일 샘플이고, 상세 내용은 앞서
설명된 설정 항목의 결정에 따라 Project 환경에 맞도록 변경하여 사용할 수
있다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Embedded WAS Workload명세 (Manifest) 파일 예시*</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">lena-was</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">type</span>: <span class="string"><span class="content">lena-was</span></span>
  <span class="key">replicas</span>: <span class="string"><span class="content">2</span></span>
  <span class="key">strategy</span>:
    <span class="key">type</span>: <span class="string"><span class="content">RollingUpdate</span></span>
  <span class="key">minReadySeconds</span>: <span class="string"><span class="content">10</span></span>
  <span class="key">revisionHistoryLimit</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">type</span>: <span class="string"><span class="content">lena-was</span></span>
    <span class="key">spec</span>:
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: lena-was</span></span>
        <span class="key">image</span>: <span class="string"><span class="content">docker.io/lenasupport/lena-embedded:1.5.0.1-jdk8-openjdk</span></span>
        <span class="key">imagePullPolicy</span>: <span class="string"><span class="content">Always</span></span>
        <span class="key">ports</span>:
        - <span class="string"><span class="content">containerPort: 8180</span></span>
        <span class="key">envFrom</span>:
        - <span class="string"><span class="content">configMapRef:</span><span class="content">
            name: configmap-lena-was</span></span>
        <span class="key">readinessProbe</span>:
          <span class="key">httpGet</span>:
            <span class="key">path</span>: <span class="string"><span class="content">/</span></span>
            <span class="key">port</span>: <span class="string"><span class="content">8180</span></span>
          <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">10</span></span>
          <span class="key">periodSeconds</span>: <span class="string"><span class="content">5</span></span>
        <span class="key">livenessProbe</span>:
          <span class="key">httpGet</span>:
            <span class="key">path</span>: <span class="string"><span class="content">/</span></span>
            <span class="key">port</span>: <span class="string"><span class="content">8180</span></span>
          <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">15</span></span>
          <span class="key">periodSeconds</span>: <span class="string"><span class="content">5</span></span>
      <span class="key">volumes</span>:
      <span class="key">terminationGracePeriodSeconds</span>: <span class="string"><span class="content">0</span></span>

<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ConfigMap</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">configmap-lena-was</span></span>
<span class="key">data</span>:
  <span class="key">LENA_CONFIG_TEMPLATE_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">WAS-001</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.default.svc.cluster.local:7700</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_APP_FILE</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">sample-app.jar</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행&gt;<br>
배포는 kubectl apply 명령으로 실행한다. 파일명이
lena-was-deployment-sample.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f lena-was-deployment-sample.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인&gt;<br>
배포된 Workload는 kubectl get 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get deployments
NAME READY AGE
lena-was 2/2 10s</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_service_4"><a class="link" href="#_service_4">Service</a></h5>
<div class="paragraph">
<p>다음은 Application Service를 배포하기 위한 Manifest 파일은 다음과 같다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Session Service명세 (Manifest) 파일 예시</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">lena-was</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">type</span>: <span class="string"><span class="content">lena-was</span></span>
<span class="key">ports</span>:
  - <span class="string"><span class="content">port: 8180</span></span>
    <span class="key">targetPort</span>: <span class="string"><span class="content">8180</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 kubectl apply 명령으로 실행한다. 파일명이
lena-was-service-sample.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f lena-was-service-sample.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 kubectl get 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get services
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
...
lena-was ClusterIP 10.43.xx.xx &lt;none&gt; 8180/TCP 20s</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_등록_확인_3"><a class="link" href="#_server_등록_확인_3">4.5.4. Server 등록 확인</a></h4>
<div class="paragraph">
<p>Manager에 접속하여 ‘Cluster &gt; Service Cluster’ 메뉴에서 해당 Service
Cluster를 선택하여 정상 등록여부를 확인한다.
<span class="button">Server List 버튼</span>
을 클릭하면 하단에 2개의 WAS가 조회되는 것을 확인한다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server는 Manager의 Scheduler에 의해 등록되므로, 최대 15초 후 자동 등록된다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_server_배포"><a class="link" href="#_web_server_배포">4.6. Web Server 배포</a></h3>
<div class="sect3">
<h4 id="kubernetes_based_deployment-web-prepare"><a class="link" href="#kubernetes_based_deployment-web-prepare">4.6.1. 배포 준비</a></h4>
<div class="paragraph">
<p>배포 전에 Manager에 Web Server를 등록하기 위해서는 Manager에서
‘Service Cluster’를 등록하여야 한다. Manager의 ‘Cluster &gt; Server
Cluster’ 메뉴 위치에서 WEB server 유형의 신규 Service
Cluster를 생성한다.</p>
</div>
<div class="paragraph">
<p>생성된 Service Cluster의 Template 탭에서 Web Server설정을 한다. 설정
내용 중 앞서 생성된 WAS와 Web Server 연계를 위해서는
Virtual Host 탭에서 Proxy 설정이 필요하다.</p>
</div>
<div class="paragraph">
<p>설정을 저장 후Template에 대한 Revision을 생성한다. Revision이 생성되어야
저장된 설정의 Download가 가능해진다.</p>
</div>
<div class="paragraph">
<p>Service Cluster생성 및 관리 관련 상세한 내용은 별도제공 문서인 ‘운영자
매뉴얼’을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="_설정_항목_5"><a class="link" href="#_설정_항목_5">4.6.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_5"><a class="link" href="#_기본_설정_항목_5">기본 설정 항목</a></h5>
<div class="paragraph">
<p>Web Server Container는 다음과 같은 권고 설정을 기준으로 배포되어야 한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workload 종류</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 5180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">변경불가</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_workload_관련_5"><a class="link" href="#_적용시점_결정_항목_workload_관련_5">적용시점 결정 항목 – Workload 관련</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Manifest 파일에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-web:1.5.0.1-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workload의 이름, 이 값은 Pod 이름 / Hostname의 Prefix로 사용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-web</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service와의 연결, 검색에 사용되는 Label로 Key: Value쌍으로
정의된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type: lena-web</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">strategy:type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment Update 정책</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RollingUpdate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagePullPolicy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">이미지 Pull 정책</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replica 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container (Pod) 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe (Health Check)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpGetAction 방식, 체크 Page, 시작 Delay시간,
주기는 Application 특성에 맞게 설정 필요</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">‘/’ 호출, 5초 주기, 15초/20초
Delay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">기타 환경변수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">환경변수의 설정은 ENV 또는 Config Map으로 설정 가능</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(configMap 방식)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.
각 환경변수에 대한 상세한 설명은 본문서 <a href="./020.architecture_decision.html#architecture_decision_web_env">Web Server 환경변수</a> 부분을 참조한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB-001:1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트<br>
(앞서 설치된 Manager의 Service 주소)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.default.svc.cluster.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_KEY</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA_MANAGER_KEY : Open API로 Manager 접근시 필요한 인증토큰</p>
</li>
<li>
<p>Manager의 Admin &gt; Users 메뉴에서 확인가능</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 Manager에서 확인 입력 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_DOWNLOAD</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>설정 정보 다운로드 여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONTRACT_CODE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>라이선스 다운로드를 위한 계약 코드</p>
</li>
<li>
<p>라이선스 발급 시 제공된 코드 값</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 코드 확인 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LICENSE_DOWNLOAD_URL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>라이선스 다운로드 위치</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_RUN_AGENT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Agent 실행여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_service관련_5"><a class="link" href="#_적용시점_결정_항목_service관련_5">적용시점 결정 항목 – Service관련</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service를 식별하는 이름으로, namespace내에서 유일한 값이 어야
한다. 이 값은 Service Domain주소에 적용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-web</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">외부로 Service를 노출하는 방식, 외부로 노출할 요건이 없으면 별도
설정이 불필요</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>NodePort<br>
(port 31180)</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_manifest_기반_배포_5"><a class="link" href="#_manifest_기반_배포_5">4.6.3. Manifest 기반 배포</a></h4>
<div class="sect4">
<h5 id="_workload_5"><a class="link" href="#_workload_5">Workload</a></h5>
<div class="paragraph">
<p>Kubernetes에서의 Container는 Pod 단위로 설치되며, Kubernetes Object를
기술한 YAML 파일형식의 Manifest 파일을 작성하여 설치하는 것이 일반적인
방식이다.</p>
</div>
<div class="paragraph">
<p>다음은 Manager를 설치하기 위한 Manifest 파일 샘플이고, 상세 내용은 앞서
설명된 설정 항목의 결정에 따라 Project 환경에 맞도록 변경하여 사용할 수
있다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Web Workload명세 (Manifest) 파일 예시</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">apps/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Deployment</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">lena-web</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">matchLabels</span>:
      <span class="key">type</span>: <span class="string"><span class="content">lena-web</span></span>
  <span class="key">replicas</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">strategy</span>:
    <span class="key">type</span>: <span class="string"><span class="content">RollingUpdate</span></span>
  <span class="key">minReadySeconds</span>: <span class="string"><span class="content">10</span></span>
  <span class="key">revisionHistoryLimit</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">template</span>:
    <span class="key">metadata</span>:
      <span class="key">labels</span>:
        <span class="key">type</span>: <span class="string"><span class="content">lena-web</span></span>
    <span class="key">spec</span>:
      <span class="key">containers</span>:
      - <span class="string"><span class="content">name: lena-web</span></span>
        <span class="key">image</span>: <span class="string"><span class="content">docker.io/lenasupport/lena-web:1.5.0.1-jdk8-openjdk</span></span>
        <span class="key">imagePullPolicy</span>: <span class="string"><span class="content">Always</span></span>
        <span class="key">ports</span>:
        - <span class="string"><span class="content">containerPort: 7180</span></span>
        <span class="key">readinessProbe</span>:
          <span class="key">httpGet</span>:
            <span class="key">path</span>: <span class="string"><span class="content">/</span></span>
            <span class="key">port</span>: <span class="string"><span class="content">7180</span></span>
          <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">5</span></span>
          <span class="key">periodSeconds</span>: <span class="string"><span class="content">5</span></span>
        <span class="key">livenessProbe</span>:
          <span class="key">httpGet</span>:
            <span class="key">path</span>: <span class="string"><span class="content">/</span></span>
            <span class="key">port</span>: <span class="string"><span class="content">7180</span></span>
          <span class="key">initialDelaySeconds</span>: <span class="string"><span class="content">10</span></span>
          <span class="key">periodSeconds</span>: <span class="string"><span class="content">10</span></span>
        <span class="key">envFrom</span>:
        - <span class="string"><span class="content">configMapRef:</span><span class="content">
            name: configmap-lena-web</span></span>
      <span class="key">terminationGracePeriodSeconds</span>: <span class="string"><span class="content">0</span></span>

<span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ConfigMap</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">configmap-lena-web</span></span>
<span class="key">data</span>:
  <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.default.svc.cluster.local:7700</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_AGENT_RUN</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_CONFIG_TEMPLATE_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">WEB-001:1</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_CONFIG_TEMPLATE_DOWNLOAD</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_MANAGER_KEY</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">aSw7RMPSw15LeN%2FMZnrxzjgV0BzZe18iVHZbJ8CkdLlea2Ecd8AleK9oPCLXuw%3D%3D</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_LICENSE_DOWNLOAD_URL</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span>
  <span class="key">LENA_CONTRACT_CODE</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dX89RRxPk6/PBPqbUuYm7w==</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 kubectl apply 명령으로 실행한다. 파일명이
lena-web-deployment-sample.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f lena-web-deployment-sample.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 kubectl get 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get deployments
NAME READY AGE
lena-web 2/2 10m
lena-was 2/2 10s</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_service_5"><a class="link" href="#_service_5">Service</a></h5>
<div class="paragraph">
<p>다음은 Application Service를 배포하기 위한 Manifest 파일은 다음과 같다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Session Service명세 (Manifest) 파일 예시</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="head"><span class="head">---</span></span>
<span class="key">apiVersion</span>: <span class="string"><span class="content">v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">Service</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">lena-web</span></span>
<span class="key">spec</span>:
  <span class="key">selector</span>:
    <span class="key">type</span>: <span class="string"><span class="content">lena-web</span></span>
  <span class="key">ports</span>:
  - <span class="string"><span class="content">nodePort: 31180</span></span>
    <span class="key">port</span>: <span class="string"><span class="content">7180</span></span>
    <span class="key">targetPort</span>: <span class="string"><span class="content">7180</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">NodePort</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 kubectl apply 명령으로 실행한다. 파일명이
lena-web-service-sample.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl apply –f lena-web-service-sample.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 kubectl get 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl get services
NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
...
lena-web NodePort 10.43.xx.xx &lt;none&gt; 7180:31180/TCP 13h
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_등록_확인_4"><a class="link" href="#_server_등록_확인_4">4.6.4. Server 등록 확인</a></h4>
<div class="paragraph">
<p>Manager에 접속하여 ‘Cluster &gt; Service Cluster’ 메뉴에서 해당 Service
Cluster를 선택하여 정상 등록여부를 확인한다.
<span class="button">Server List 버튼</span>
을 클릭하면 하단에 2개의 Web Server가 조회되는 것을 확인한다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server는 Manager의 Scheduler에 의해 등록되므로, 최대 15초 후 자동 등록된다</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker_swarm_기반_배포"><a class="link" href="#_docker_swarm_기반_배포">5. Docker Swarm 기반 배포</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_배포_공통사항_2"><a class="link" href="#_배포_공통사항_2">5.1. 배포 공통사항</a></h3>
<div class="sect3">
<h4 id="_배포_준비_2"><a class="link" href="#_배포_준비_2">5.1.1. 배포 준비</a></h4>
<div class="paragraph">
<p>LENA 설치 사전에 Docker Swarm 실행환경이 구성되어 있어야 한다. 다음 각
항목들이 준비되어야 할 사항이다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Docker가 설치되고 구동 가능한 환경 마련</p>
</li>
<li>
<p>LENA를 구동할 Docker Swarm Overlay Network 구성</p>
</li>
<li>
<p>접근 가능한 Docker Repository (예 : ECR, Docker Hub, 내부 Docker
Repository 등)</p>
</li>
<li>
<p>LENA Container License 및 계약코드</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_swarm_cluster의_구성"><a class="link" href="#_swarm_cluster의_구성">Swarm Cluster의 구성</a></h5>
<div class="paragraph">
<p>Swarm Cluster는 복수개의 물리적 서버(Node)에 Container를 배포할수 있는 Orchestration Runtime환경으로, Manager Node와 Worker Node로 구성된다. Manager Node를 생성하는 명령어는 docker swarm init 으로 --advertise-addr 옵션에 Manager Node의 주소 (최초 Manager의 경우에는 자신의 주소)를 입력하여 실행한다.</p>
</div>
<div class="listingblock">
<div class="title">Docker Swarm Init (Manager Node 생성)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker swarm init --advertise-addr $(hostname -i)

Swarm initialized: current node (y8ul9r3jq0rgt9k3vbvrayeyg) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-... 192.168.0.10:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions</code></pre>
</div>
</div>
<div class="paragraph">
<p>Manager Node 생성시에 출력되는 docker swarm join 명령구문을 실행하여, Worker Node를 등록한다.</p>
</div>
<div class="listingblock">
<div class="title">Docker Swarm Worker Node 생성</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker swarm join --token SWMTKN-1-... 192.168.0.10:2377</code></pre>
</div>
</div>
<div class="paragraph">
<p>Manager Node에서 docker node ls 명령을 실행하면, Cluster에 속한 Node를 확인할 수 있다.</p>
</div>
<div class="listingblock">
<div class="title">Docker Swarm Cluster Node 조회</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker node ls
ID                         HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS  ENGINE VERSION
887c4dglmszt1afbgnucnokg   SERVER02  Ready   Active                        19.03.6-ce
qp9zh3zj5jlzpqhglf11v69y * SERVER01  Ready   Active        Leader          19.03.6-ce</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_overlay_network_구성"><a class="link" href="#_overlay_network_구성">Overlay Network 구성</a></h5>
<div class="paragraph">
<p>Docker Service들이 운영될 수 있는 Container Network를 생성한다. Docker Swarm의 Overlay Network를 구성은 이후 Service 구성과 통합될 수 있도록 Stack을 구성하고, Stack에 Overlay Network을 생성한다.</p>
</div>
<div class="listingblock">
<div class="title">Docker Swarm Network 명세 파일 Example (lena-net.yaml)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">version</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3.8</span><span class="delimiter">&quot;</span></span>

<span class="key">networks</span>:
  <span class="key">lena-net</span>:
    <span class="key">driver</span>: <span class="string"><span class="content">overlay</span></span>
    <span class="key">attachable</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Stack내에 Network을 생성하는 명령어는 명세파일이 lena-net.yaml이고 Stack 명이 'example&#8217;이라면 다음과 같다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker stack deploy -c lena-net.yaml exmaple</code></pre>
</div>
</div>
<div class="paragraph">
<p>구성된 Docker Network을 조회하기 위해서는 docker network ls [OPTIONS] 명령어를 사용한다.</p>
</div>
<div class="listingblock">
<div class="title">Docker Network 조회</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker network ls

NETWORK ID          NAME                DRIVER              SCOPE
x9loi84l78zu        example_lena-net    overlay             swarm
jhdd0mz8gtrh        ingress             overlay             swarm
.... (출력 생략)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_배포_실행_2"><a class="link" href="#_배포_실행_2">5.1.2. 배포 실행</a></h4>
<div class="paragraph">
<p>배포실행은 Docker의 기본 CLI 도구인 docker 명령어를 활용하는 것을 기준으로 설명한다.</p>
</div>
<div class="paragraph">
<p>Docker는 Service의 배포 방식, 환경설정정보 등을 기술한
YAML형식의 명세 파일인 Docker Compose 파일을 활용하여 배포/삭제/업데이트를 수행한다. 하기에
설명되는 ${docker-compose.yaml}은 이 명세서를 지칭한다. 본 문서에서는
배포에 필요한 최소한의 명령어 및 옵션만을 기술하므로, 상세한 내용은
공개된 <a href="https://docs.docker.com/">Docker</a> 설명서를 참조한다.</p>
</div>
<div class="sect4">
<h5 id="_docker_service_배포"><a class="link" href="#_docker_service_배포">Docker Service 배포</a></h5>
<div class="paragraph">
<p>Docker는 Load-balancing를 포함하는 Network 속성과 환경변수, Deployment 속성을 모두 포함한 Container군을 'Service' 단위로 관리한다.
‘docker create service’ 명령어를 통해 최초 배포를 실행하고, 서비스를 생성할 때 --replicas 옵션을 사용해서 생성할 컨테이너 개수를 지정하고, --publish 옵션을 사용하여 서비스 Port를 지정할 수 있다.</p>
</div>
<div class="listingblock">
<div class="title">CLI기반 Docker Service 배포</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker service create --name lena-sample \
    --publish published=8180:8180/tcp \
    --replicas 2 \
    lenacloud/lena-cluster:1.5.0.1-centos7-jdk8-openjdk</code></pre>
</div>
</div>
<div class="paragraph">
<p>위 명령어는 배포 뿐아니라, 동일 namespace의 동일 name을 가진 Object가
존재할 경우 해당 Resource의 명세를 업데이트 한다.</p>
</div>
</div>
<div class="sect4">
<h5 id="_docker_service_갱신"><a class="link" href="#_docker_service_갱신">Docker Service 갱신</a></h5>
<div class="paragraph">
<p>‘docker service scale’ 명령어로 운영 중에 리플리케이션 개수를 변경할 수 있다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker service scale lena-sample=3</pre>
</div>
</div>
<div class="paragraph">
<p>‘docker service update’ 명령어로 배포된 Service를 갱신할 수 있다.</p>
</div>
<div class="listingblock">
<div class="title">Docker Update 명령어 예시</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker service update \
--update-parallelism 1 \
--update-delay 10s \
--update-order start-first \
--image lenacloud/lena-cluster:1.5.0.1-centos7-jdk8-openjdk \
lena-sample</code></pre>
</div>
</div>
<div class="paragraph">
<p>Service 갱신 관련 주요 옵션은 옵션은 다음과 같다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>--update-parallelism : 동시에 업데이트할 컨테이너 개수를 지정한다.</p>
</li>
<li>
<p>--update-delay : 업데이트 간 간격을 지정한다.</p>
</li>
<li>
<p>--update-order : start-first면 새 컨테이너를 먼저 생성한 뒤에 기존 컨테이너를 삭제한다. stop-first면 기존 컨테이너를 먼저 삭제하고 그 다음에 새 컨테이너를 생성한다.</p>
</li>
<li>
<p>--update-failure-action : 업데이트에 실패할 경우 이 값이 pause면 업데이트를 멈추고, continue면 업데이트를 계속하고, rollback이면 업데이트를 롤백한다.</p>
</li>
<li>
<p>--update-max-failure-ratio : 실패 비율이 지정한 값 이상이면 업데이트 실패로 간주한다.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_docker_service_rollback"><a class="link" href="#_docker_service_rollback">Docker Service Rollback</a></h5>
<div class="paragraph">
<p>Docker Service 갱신(Update) 후 이전 상태로 복구(Rollback)하기 위해서는 'docker service rollback 명령어&#8217;를 사용할 수 있다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker service rollback [OPTIONS] SERVICE명</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_docker_service_삭제"><a class="link" href="#_docker_service_삭제">Docker Service 삭제</a></h5>
<div class="paragraph">
<p>‘docker service rm’ 명령어로 배포된 Service를 삭제한다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker service rm [Service명...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_docker_service_조회"><a class="link" href="#_docker_service_조회">Docker Service 조회</a></h5>
<div class="paragraph">
<p>‘docker service ls’ 명령어로 배포된 Service들의 목록을 조회할 수 있다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker service ls</code></pre>
</div>
</div>
<div class="paragraph">
<p>‘docker service ps 서비스명’ 명령어로 배포된 Service의 Container 상태를 조회할 수 있다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker service ps [OPTIONS] [Service명...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_compose_파일_service_명세서_의_활용"><a class="link" href="#_compose_파일_service_명세서_의_활용">Compose 파일 (Service 명세서) 의 활용</a></h5>
<div class="paragraph">
<p>실제 운영시에는 개별적인 Command로 배포를 수행하는 것보다, Service구성에 대한 명세서 (Compose파일) 를 활용하는 것이 효율적이다. 다음에서는 샘플 Compose 파일을 통해 구조를 살펴본다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">version</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3.8</span><span class="delimiter">&quot;</span></span>

<span class="key">services</span>:
  <span class="key">lena-was-cluster</span>:
    <span class="key">image</span>: <span class="string"><span class="content">lenacloud/lena-cluster:1.5.0.1-centos7-jdk8-openjdk</span></span>
    <span class="key">networks</span>:
      <span class="key">lena-net</span>:
        <span class="key">aliases</span>:
        - <span class="string"><span class="content">was-cluster.example.local</span></span>
    <span class="key">ports</span>:
    - <span class="string"><span class="content">target: 8180</span></span>
      <span class="key">published</span>: <span class="string"><span class="content">8180</span></span>
      <span class="key">protocol</span>: <span class="string"><span class="content">tcp</span></span>
      <span class="key">mode</span>: <span class="string"><span class="content">ingress</span></span>
    <span class="key">environment</span>:
      <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.example.local:7700</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_MONITORING_PORT</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">16100</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_KEY</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">C9PYwcu%3D%3D</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONFIG_TEMPLATE_DOWNLOAD</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONFIG_TEMPLATE_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">was-cluster</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_LICENSE_DOWNLOAD_URL</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONTRACT_CODE</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vvW7ebNFVjDdtasuvF1utQ==</span><span class="delimiter">&quot;</span></span>
      <span class="key">JAVA_DOMAIN_CACHE_TTL</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
    <span class="key">deploy</span>:
      <span class="key">mode</span>: <span class="string"><span class="content">replicated</span></span>
      <span class="key">replicas</span>: <span class="string"><span class="content">3</span></span>
    <span class="key">healthcheck</span>:
      <span class="key">test</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">curl -f http://localhost:8180/index.jsp</span><span class="delimiter">&quot;</span></span>
      <span class="key">interval</span>: <span class="string"><span class="content">10s</span></span>
      <span class="key">timeout</span>: <span class="string"><span class="content">5s</span></span>
      <span class="key">retries</span>: <span class="string"><span class="content">3</span></span>
      <span class="key">start_period</span>: <span class="string"><span class="content">20s</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>위 파일의 각 Field가 표현하는 내용은 다음과 같다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>services : Service명으로 구분되는 Service 정의를 포함</p>
</li>
<li>
<p>networks : Service가 운영되는 Container Network를 지정</p>
</li>
<li>
<p>networks &gt; ${network명} &gt; aliases : Service의 대표 Network 주소</p>
</li>
<li>
<p>ports : Service 노출 Port 및 해당 Port와 Container간의 Mapping 정보, L/B 방식 정의</p>
</li>
<li>
<p>environments : Container 기동에 필요한 환경변수 정보</p>
</li>
<li>
<p>deploy : Container 배포 방식 정의</p>
</li>
<li>
<p>healthcheck : Healthcheck 방식 정의</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_stack의_구성"><a class="link" href="#_stack의_구성">Stack의 구성</a></h5>
<div class="paragraph">
<p>Stack은 Kubernetes의 namespace와 유사한 개념으로, 분산된 Application을 통합배포/관리하기 위한 논리적 공간이다. 하기의 모든 배포관련 작업은 Stack 단위로 수행된다. Stack은 별도로 생성하는 과정을 거치지 않으며, 관련 ${docker-compose.yaml} 파일을 묶어서 하나의 Stack을 구성한다. 명렁어 구분은 docker stack deploy [-c Compose파일 Path&#8230;&#8203;] [OPTIONS] 이고, 아래는  Service를 구성하는 복수개의 compose 파일을 단일 Stack으로 구성한 샘플이다.</p>
</div>
<div class="listingblock">
<div class="title">Docker stack 생성</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker stack deploy \
       -c lena-net.yaml \
       -c lena-manager.yaml \
       -c lena-session-cluster.yaml \
       -c lena-was-cluster.yaml \
       -c lena-web-cluster.yaml \
       example</code></pre>
</div>
</div>
<div class="paragraph">
<p>Docker는 Stack에 포함된 모든 Service, Network를 일괄삭제하는 기능을 제공한다. 명령어 구문은 docker stack rm [OPTIONS] [Stack명&#8230;&#8203;]' 이다.</p>
</div>
<div class="listingblock">
<div class="title">Docker stack 삭제</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker stack rm example</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manager_배포_2"><a class="link" href="#_manager_배포_2">5.2. Manager 배포</a></h3>
<div class="sect3">
<h4 id="_설정_항목_6"><a class="link" href="#_설정_항목_6">5.2.1. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_6"><a class="link" href="#_기본_설정_항목_6">기본 설정 항목</a></h5>
<div class="paragraph">
<p>Manager Service는 다음과 같은 권고 설정을 기준으로 배포되어야 한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/W 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overlay Network - Host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">End Point 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsrr (DNS Round Robin)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 7700, 16100 및 UDP : 16100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Volume Mount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">디렉토리 /usr/local/lena/repository를 외부 Volume에 매핑
(아래 예제에서는 nfs 방식으로 매핑)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe (Health Check)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpGetAction, ‘/lena’ 페이지 호출</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_service관련_6"><a class="link" href="#_적용시점_결정_항목_service관련_6">적용시점 결정 항목 – Service관련</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-manager:1.5.0.1-centos7-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stack 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">복수개의 응용 서비스를 통합관리하기 위한 Swarm Cluster의 논리적 그룹인 stack의 이름</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">example</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service를 식별하는 이름으로, Stack내에서 유일한 값이 어야
한다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">network alias</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker N/W내에서의 식별자(주소)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.example.local</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_HEAP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heap Memory 크기 지정 (Template 다운로드시 Template 값으로 교체됨)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024m (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_METASPACE_SIZE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metaspace Memory크기 (Template 다운로드시 Template 값으로 교체됨)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256m (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_DOMAIN_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain Name 활성화 여부</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service의 Domain 주소 : 포트</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.example.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain 주소 Cache 시간 (초)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 (기본)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_명세서_compose_파일_기반_배포"><a class="link" href="#_명세서_compose_파일_기반_배포">5.2.2. 명세서 (Compose 파일) 기반 배포</a></h4>
<div class="paragraph">
<p>Docker Swarm에서 Container는 Service 단위로 배포되며, Compose 파일에 Service 명세를 작성하여 배포하는 것이 일반적이다.</p>
</div>
<div class="paragraph">
<p>다음은 Manager를 설치하기 위한 Compose 파일 샘플이다. 상세 내용은 앞서
설명된 설정 항목의 결정에 따라 Project 환경에 맞도록 변경하여 사용할 수
있다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Manager Service 명세 (lena-manager.yaml) 파일 샘플</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">version</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3.8</span><span class="delimiter">&quot;</span></span>
<span class="key">services</span>:
  <span class="key">lena-manager</span>:
    <span class="key">image</span>: <span class="string"><span class="content">lenacloud/lena-manager:1.5.0.1-centos7-jdk8-openjdk</span></span>
    <span class="key">networks</span>:
      <span class="key">lena-net</span>:
        <span class="key">aliases</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.example.local</span><span class="delimiter">&quot;</span></span>
    <span class="key">ports</span>:
    - <span class="string"><span class="content">target: 7700</span></span>
      <span class="key">published</span>: <span class="string"><span class="content">7700</span></span>
      <span class="key">protocol</span>: <span class="string"><span class="content">tcp</span></span>
      <span class="key">mode</span>: <span class="string"><span class="content">host</span></span>
    <span class="key">environment</span>:
      <span class="key">LENA_MANAGER_DOMAIN_ENABLED</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.example.local:7700</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_MONITORING_PORT</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">16100</span><span class="delimiter">&quot;</span></span>
    <span class="key">deploy</span>:
      <span class="key">mode</span>: <span class="string"><span class="content">replicated</span></span>
      <span class="key">replicas</span>: <span class="string"><span class="content">1</span></span>
      <span class="key">endpoint_mode</span>: <span class="string"><span class="content">dnsrr</span></span>
    <span class="key">volumes</span>:
    - <span class="string"><span class="content">lena-manager-repository:/usr/local/lena/repository</span></span>
    <span class="key">healthcheck</span>:
      <span class="key">test</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">curl -f http://localhost:7700/lena</span><span class="delimiter">&quot;</span></span>
      <span class="key">interval</span>: <span class="string"><span class="content">10s</span></span>
      <span class="key">timeout</span>: <span class="string"><span class="content">3s</span></span>
      <span class="key">retries</span>: <span class="string"><span class="content">3</span></span>
      <span class="key">start_period</span>: <span class="string"><span class="content">30s</span></span>
<span class="key">volumes</span>:
  <span class="key">lena-manager-repository</span>:
    <span class="key">driver</span>: <span class="string"><span class="content">local</span></span>
    <span class="key">driver_opts</span>:
      <span class="key">type</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">nfs</span><span class="delimiter">&quot;</span></span>
      <span class="key">o</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">nfsvers=4.1,addr=${FILE_STORAGE_ADDRESS}</span><span class="delimiter">&quot;</span></span>
      <span class="key">device</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${FILE_STORAGE_ADDRESS}:/example/lena-manager-repository</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
docker-compose를 활용하여 개별 명세파일별로 배포를 실행 할 수 있으나, 본 문서에서는 Service를 Stack으로 관리하는 방식으로 배포방법을 설명한다.   'docker stack deploy' 명령으로</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker stack deploy -c lena-manager.yaml example</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Service는 docker service ls 명령어 실행을 통해 확인할 수 있다.<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker service ls
ID                  NAME                   MODE                REPLICAS            IMAGE                                                   PORTS
grhr01h2bgqc        example_lena-manager   replicated          0/1                 lenacloud/lena-manager:1.5.0.1-centos7-jdk8-openjdk</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manager_접속_2"><a class="link" href="#_manager_접속_2">5.2.3. Manager 접속</a></h4>
<div class="paragraph">
<p>Service가 정상기동 되면 Browser에서 http://[Node IP]: [Service Port] /lena 주소로 Manager에 접속한다.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_session_server_배포_2"><a class="link" href="#_session_server_배포_2">5.3. Session Server 배포</a></h3>
<div class="sect3">
<h4 id="_배포_준비_3"><a class="link" href="#_배포_준비_3">5.3.1. 배포 준비</a></h4>
<div class="paragraph">
<p>본문서 <a href="./040.kubernetes_based_deployment.html#kubernetes_based_deployment-session-prepare">Session Server 배포 준비</a> 부분 설명을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="_설정_항목_7"><a class="link" href="#_설정_항목_7">5.3.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_7"><a class="link" href="#_기본_설정_항목_7">기본 설정 항목</a></h5>
<div class="paragraph">
<p>Session Server Container는 다음과 같은 권고 설정을 기준으로 배포되어야
한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/W 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overlay Network - Host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">End Point 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsrr (DNS Round Robin)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica 1 * 2 Set (Primary, Secondary 개별 배포)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 5180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Health Check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">${LENA_SERVER_HOME}/health.sh 호출</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_service_관련"><a class="link" href="#_적용시점_결정_항목_service_관련">적용시점 결정 항목 – Service 관련</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Docker Compose 파일에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stack 명</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>복수개의 응용 서비스를 통합관리하기 위한 Swarm Cluster의 논리적 그룹인 stack의 이름</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>example</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 명</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Service를 식별하는 이름으로, Stack내에서 유일한 값이 어야
한다.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>lena-session-0 (Primary 서버)</p>
</li>
<li>
<p>lena-session-1 (Secondary 서버)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Session Server Image</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>lenacloud/lena-session:1.5.0.1-centos7-jdk8-openjdk</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network alias</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Docker N/W내에서의 식별자(주소)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>session-0.example.local (Primary 서버)</p>
</li>
<li>
<p>session-1.example.local (Secondary 서버)</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_HEAP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Heap Memory 크기 지정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024m (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SESSION-001</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sample-lena-manager.example.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain 주소 Cache 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_0_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Primary Session 서버 주소, StatefulSet설정과 일치되어야 함</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">session-0.example.local:5180</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SECONDARY_SESSION_NO</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Session Server가 상호 연결하는 Session 서버 번호</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Primary Session Server는 1</p>
</li>
<li>
<p>Secondary Session Server는 0</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_1_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Secondary Session 서버 주소, StatefulSet설정과 일치되어야 함</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">session-1.example.local:5180</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_EXPIRE_SEC</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Session 만료 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1800 (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_SHARE_SESSION</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application 간 Session 공유여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_docker_compose_기반_배포"><a class="link" href="#_docker_compose_기반_배포">5.3.3. Docker Compose 기반 배포</a></h4>
<div class="paragraph">
<p>Docker Swarm에서 Container는 Service 단위로 설치되며, Service를
기술한 YAML 파일형식의 Docker Compose 파일을 작성하여 설치하는 것이 일반적인 방식이다.</p>
</div>
<div class="paragraph">
<p>다음은 Manager를 설치하기 위한 Docker Compose 파일 샘플이고, 상세 내용은 앞서 설명된 설정 항목의 결정에 따라 Project 환경에 맞도록 변경하여 사용할 수
있다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Session Cluster Service명세(lena-session-cluster.yaml) 파일 예시</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">version</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3.8</span><span class="delimiter">&quot;</span></span>

<span class="key">services</span>:
  <span class="key">lena-session-0</span>:
    <span class="key">image</span>: <span class="string"><span class="content">lenacloud/lena-session:1.5.0.1-centos7-jdk8-openjdk</span></span>
    <span class="key">networks</span>:
      <span class="key">lena-net</span>:
        <span class="key">aliases</span>:
        - <span class="string"><span class="content">session-0.example.local</span></span>
    <span class="key">environment</span>:
      <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.example.local:7700</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_MONITORING_PORT</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">16100</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONFIG_TEMPLATE_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">session-cluster</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_SESSION_0_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">session-0.example.local:5180</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_SESSION_1_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">session-1.example.local:5180</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_SECONDARY_SESSION_NO</span>: <span class="string"><span class="content">1</span></span>
    <span class="key">deploy</span>:
      <span class="key">mode</span>: <span class="string"><span class="content">replicated</span></span>
      <span class="key">replicas</span>: <span class="string"><span class="content">1</span></span>
      <span class="key">endpoint_mode</span>: <span class="string"><span class="content">dnsrr</span></span>
    <span class="key">healthcheck</span>:
      <span class="key">test</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">sh /usr/local/lena/servers/sessionServer/health.sh</span><span class="delimiter">&quot;</span></span>
      <span class="key">interval</span>: <span class="string"><span class="content">5s</span></span>
      <span class="key">timeout</span>: <span class="string"><span class="content">3s</span></span>
      <span class="key">retries</span>: <span class="string"><span class="content">3</span></span>
      <span class="key">start_period</span>: <span class="string"><span class="content">5s</span></span>

  <span class="key">lena-session-1</span>:
    <span class="key">image</span>: <span class="string"><span class="content">lenacloud/lena-session:1.5.0.1-centos7-jdk8-openjdk</span></span>
    <span class="key">networks</span>:
      <span class="key">lena-net</span>:
        <span class="key">aliases</span>:
        - <span class="string"><span class="content">session-1.example.local</span></span>
    <span class="key">environment</span>:
      <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.example.local:7700</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_MONITORING_PORT</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">16100</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONFIG_TEMPLATE_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">session-cluster</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_SESSION_0_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">session-0.example.local:5180</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_SESSION_1_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">session-1.example.local:5180</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_SECONDARY_SESSION_NO</span>: <span class="string"><span class="content">0</span></span>
    <span class="key">deploy</span>:
      <span class="key">mode</span>: <span class="string"><span class="content">replicated</span></span>
      <span class="key">replicas</span>: <span class="string"><span class="content">1</span></span>
      <span class="key">endpoint_mode</span>: <span class="string"><span class="content">dnsrr</span></span>
    <span class="key">healthcheck</span>:
      <span class="key">test</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">sh /usr/local/lena/servers/sessionServer/health.sh</span><span class="delimiter">&quot;</span></span>
      <span class="key">interval</span>: <span class="string"><span class="content">5s</span></span>
      <span class="key">timeout</span>: <span class="string"><span class="content">3s</span></span>
      <span class="key">retries</span>: <span class="string"><span class="content">3</span></span>
      <span class="key">start_period</span>: <span class="string"><span class="content">5s</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 docker stack deploy 명령으로 실행한다. 파일명이
lena-session-cluster.yaml이고 Stack명이 example이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker stack deploy \
    -c lena-net.yaml \
    -c lena-manager.yaml \
    -c lena-session-cluster.yaml \
    example</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>docker stack 명령은 구성요소를 일괄적으로 등록/삭제하므로 앞서 설명한 Network 및 Manager Service 명세를 모두 포함하여 실행하여야 한다.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 docker stack services 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker stack services example
ID                  NAME                     MODE                REPLICAS            IMAGE                                                   PORTS
............        example_lena-session-1   replicated          1/1                 lenacloud/lena-session:1.5.0.1-centos7-jdk8-openjdk
............        example_lena-session-0   replicated          1/1                 lenacloud/lena-session:1.5.0.1-centos7-jdk8-openjdk
... (출력 일부 생략)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_등록_확인_5"><a class="link" href="#_server_등록_확인_5">5.3.4. Server 등록 확인</a></h4>
<div class="paragraph">
<p>Manager에 접속하여 ‘Cluster &gt; Service Cluster’ 메뉴에서 해당 Service
Cluster를 선택하여 정상 등록여부를 확인한다.
<span class="button">ServerList버튼</span>
을 클릭하면 하단에 2개의 Session Server가 조회되는 것을 확인한다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server는 Manager의 Scheduler에 의해 등록되므로, 최대 15초 후 자동 등록된다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_was_배포_2"><a class="link" href="#_was_배포_2">5.4. WAS 배포</a></h3>
<div class="sect3">
<h4 id="_배포_준비_4"><a class="link" href="#_배포_준비_4">5.4.1. 배포 준비</a></h4>
<div class="paragraph">
<p>본문서 <a href="./040.kubernetes_based_deployment.html#kubernetes_based_deployment-application-prepare">WAS 배포준비</a> 부분 설명을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="_설정_항목_8"><a class="link" href="#_설정_항목_8">5.4.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_8"><a class="link" href="#_기본_설정_항목_8">기본 설정 항목</a></h5>
<div class="paragraph">
<p>WAS Container는 다음과 같은 권고 설정을 기준으로 배포
된다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/W 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overlay Network - Ingress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">End Point 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 8180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_service_관련_2"><a class="link" href="#_적용시점_결정_항목_service_관련_2">적용시점 결정 항목 – Service 관련</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Docker Compose 파일에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-cluster:1.5.0.1-centos7-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stack명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Swarm Cluster내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">example</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service를 식별하는 이름으로, Stack내에서 유일한 값이 어야
한다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-was-cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replica 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Health Check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpGetAction, 체크 Page, 시작 Delay 시간, 주기는 Application
특성에 맞도록 설정 필요</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">‘/index.jsp’ 호출</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WAS-001:1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트<br>
(앞서 설치된 Manager의 Service 주소)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.example.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_KEY</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA_MANAGER_KEY : Open API로 Manager 접근시 필요한 인증토큰</p>
</li>
<li>
<p>Manager의 Admin &gt; Users 메뉴에서 확인 가능</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 Manager에서 확인 입력 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_DOWNLOAD</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>설정 정보 다운로드 여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONTRACT_CODE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>라이선스 다운로드를 위한 계약 코드</p>
</li>
<li>
<p>라이선스 발급 시 제공된 암호화된 코드 값</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 코드 확인 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LICENSE_DOWNLOAD_URL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>License 다운로드 주소</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager(기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain 주소 Cache 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 (기본)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_명세서_compose_파일_기반_배포_2"><a class="link" href="#_명세서_compose_파일_기반_배포_2">5.4.3. 명세서 (Compose 파일) 기반 배포</a></h4>
<div class="paragraph">
<p>다음은 LENA WAS를 구동하기 위한 Docker Compose 파일 샘플이고, 상세 내용은 앞서 설명된 설정 항목의 결정에 따라 Project 환경에 맞도록 변경하여 사용할 수
있다.</p>
</div>
<div class="listingblock">
<div class="title">LENA WAS Service 명세(lena-was-cluster.yaml) 파일 Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">version</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3.8</span><span class="delimiter">&quot;</span></span>

<span class="key">services</span>:
  <span class="key">lena-was-cluster</span>:
    <span class="key">image</span>: <span class="string"><span class="content">lenacloud/lena-cluster:1.5.0.1-centos7-jdk8-openjdk</span></span>
    <span class="key">networks</span>:
      <span class="key">lena-net</span>:
        <span class="key">aliases</span>:
        - <span class="string"><span class="content">was-cluster.example.local</span></span>
    <span class="key">ports</span>:
    - <span class="string"><span class="content">target: 8180</span></span>
      <span class="key">published</span>: <span class="string"><span class="content">8180</span></span>
      <span class="key">protocol</span>: <span class="string"><span class="content">tcp</span></span>
      <span class="key">mode</span>: <span class="string"><span class="content">ingress</span></span>
    <span class="key">environment</span>:
      <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.example.local:7700</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_MONITORING_PORT</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">16100</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_KEY</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">C9PYwcu%2FDcB12IyhTrD63o2mXtnCWqV0dvnhunznedBnpRUgjVr6QeLA9zvReQqWMzbgyIHNVajoSvSuE0jANQ%3D%3D</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONFIG_TEMPLATE_DOWNLOAD</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONFIG_TEMPLATE_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">was-cluster</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_LICENSE_DOWNLOAD_URL</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONTRACT_CODE</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vvW7ebNFVjDdtasuvF1utQ==</span><span class="delimiter">&quot;</span></span>
      <span class="key">JAVA_DOMAIN_CACHE_TTL</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
    <span class="key">deploy</span>:
      <span class="key">mode</span>: <span class="string"><span class="content">replicated</span></span>
      <span class="key">replicas</span>: <span class="string"><span class="content">2</span></span>
    <span class="key">healthcheck</span>:
      <span class="key">test</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">curl -f http://localhost:8180/index.jsp</span><span class="delimiter">&quot;</span></span>
      <span class="key">interval</span>: <span class="string"><span class="content">10s</span></span>
      <span class="key">timeout</span>: <span class="string"><span class="content">5s</span></span>
      <span class="key">retries</span>: <span class="string"><span class="content">3</span></span>
      <span class="key">start_period</span>: <span class="string"><span class="content">20s</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 docker stack deploy 명령으로 실행한다. 파일명이
lena-was-cluster.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker stack deploy \
    -c lena-net.yaml \
    -c lena-manager.yaml \
    -c lena-session-cluster.yaml \
    -c lena-was-cluster.yaml \
    example</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 docker stack services 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker stack services example
ID                  NAME                       MODE                REPLICAS            IMAGE                                                   PORTS
............        example_lena-was-cluster   replicated          2/2                 lenacloud/lena-cluster:1.5.0.1-centos7-jdk8-openjdk   *:8180-&gt;8180/tcp
... (출력 일부 생략)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_등록_확인_6"><a class="link" href="#_server_등록_확인_6">5.4.4. Server 등록 확인</a></h4>
<div class="paragraph">
<p>Manager에 접속하여 ‘Cluster &gt; Service Cluster’ 메뉴에서 해당 Service
Cluster를 선택하여 정상 등록여부를 확인한다.
<span class="button">Server List 버튼</span>
을 클릭하면 하단에 2개의 WAS가 조회되는 것을 확인한다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server는 Manager의 Scheduler에 의해 등록되므로, 최대 15초 후 자동 등록된다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_embedded_was_배포_2"><a class="link" href="#_embedded_was_배포_2">5.5. Embedded WAS 배포</a></h3>
<div class="sect3">
<h4 id="_배포_준비_5"><a class="link" href="#_배포_준비_5">5.5.1. 배포 준비</a></h4>
<div class="paragraph">
<p>본문서 <a href="./040.kubernetes_based_deployment.html#kubernetes_based_deployment-embedded-application-prepare">Embedded WAS 배포준비</a> 부분 설명을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="_설정_항목_9"><a class="link" href="#_설정_항목_9">5.5.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_9"><a class="link" href="#_기본_설정_항목_9">기본 설정 항목</a></h5>
<div class="paragraph">
<p>WAS Container는 다음과 같은 권고 설정을 기준으로 배포
된다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/W 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overlay Network - Ingress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">End Point 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 8180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_service_관련_3"><a class="link" href="#_적용시점_결정_항목_service_관련_3">적용시점 결정 항목 – Service 관련</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Docker Compose 파일에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-embedded:1.5.0.1-centos7-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stack명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Swarm Cluster내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">example</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service를 식별하는 이름으로, Stack내에서 유일한 값이 어야
한다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-was-cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replica 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Health Check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpGetAction, 체크 Page, 시작 Delay 시간, 주기는 Application
특성에 맞도록 설정 필요</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">‘/index.jsp’ 호출</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.
각 환경변수에 대한 상세한 설명은 본문서 <a href="./020.architecture_decision.html#architecture_decision_embedded_application_env">Embedded WAS 환경변수</a> 부분을 참조한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WAS-001:1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트<br>
(앞서 설치된 Manager의 Service 주소)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.default.svc.cluster.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_MONITORING_PORT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 모니터링 Port 정보</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_APP_FILE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application Jar 파일 명</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sample-app.jar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_APP_DIR</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application Jar 디렉토리 명</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local/lena</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_명세서_compose_파일_기반_배포_3"><a class="link" href="#_명세서_compose_파일_기반_배포_3">5.5.3. 명세서 (Compose 파일) 기반 배포</a></h4>
<div class="paragraph">
<p>다음은 LENA Embedded WAS를 구동하기 위한 Docker Compose 파일 샘플이고, 상세 내용은 앞서 설명된 설정 항목의 결정에 따라 Project 환경에 맞도록 변경하여 사용할 수
있다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Embedded WAS Service 명세(lena-was-embedded.yaml) 파일 Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">version</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3.8</span><span class="delimiter">&quot;</span></span>

<span class="key">services</span>:
  <span class="key">lena-was-cluster</span>:
    <span class="key">image</span>: <span class="string"><span class="content">lenacloud/lena-embedded:1.5.0.1-centos7-jdk8-openjdk</span></span>
    <span class="key">networks</span>:
      <span class="key">lena-net</span>:
        <span class="key">aliases</span>:
        - <span class="string"><span class="content">was-cluster.example.local</span></span>
    <span class="key">ports</span>:
    - <span class="string"><span class="content">target: 8180</span></span>
      <span class="key">published</span>: <span class="string"><span class="content">8180</span></span>
      <span class="key">protocol</span>: <span class="string"><span class="content">tcp</span></span>
      <span class="key">mode</span>: <span class="string"><span class="content">ingress</span></span>
    <span class="key">environment</span>:
      <span class="key">LENA_CONFIG_TEMPLATE_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">WAS-001</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.example.local:7700</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_APP_FILE</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">sample-app.jar</span><span class="delimiter">&quot;</span></span>
    <span class="key">deploy</span>:
      <span class="key">mode</span>: <span class="string"><span class="content">replicated</span></span>
      <span class="key">replicas</span>: <span class="string"><span class="content">2</span></span>
    <span class="key">healthcheck</span>:
      <span class="key">test</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">curl -f http://localhost:8180/index.jsp</span><span class="delimiter">&quot;</span></span>
      <span class="key">interval</span>: <span class="string"><span class="content">10s</span></span>
      <span class="key">timeout</span>: <span class="string"><span class="content">5s</span></span>
      <span class="key">retries</span>: <span class="string"><span class="content">3</span></span>
      <span class="key">start_period</span>: <span class="string"><span class="content">20s</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 docker stack deploy 명령으로 실행한다. 파일명이
lena-was-embedded.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker stack deploy \
    -c lena-net.yaml \
    -c lena-manager.yaml \
    -c lena-session-cluster.yaml \
    -c lena-was-embedded.yaml \
    example</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 docker stack services 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker stack services example
ID                  NAME                       MODE                REPLICAS            IMAGE                                                   PORTS
............        example_lena-was-embedded   replicated          2/2                 lenacloud/lena-embedded:1.5.0.1-centos7-jdk8-openjdk   *:8180-&gt;8180/tcp
... (출력 일부 생략)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_등록_확인_7"><a class="link" href="#_server_등록_확인_7">5.5.4. Server 등록 확인</a></h4>
<div class="paragraph">
<p>Manager에 접속하여 ‘Cluster &gt; Service Cluster’ 메뉴에서 해당 Service
Cluster를 선택하여 정상 등록여부를 확인한다.
<span class="button">Server List 버튼</span>
을 클릭하면 하단에 2개의 WAS가 조회되는 것을 확인한다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server는 Manager의 Scheduler에 의해 등록되므로, 최대 15초 후 자동 등록된다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_server_배포_2"><a class="link" href="#_web_server_배포_2">5.6. Web Server 배포</a></h3>
<div class="sect3">
<h4 id="_배포_준비_6"><a class="link" href="#_배포_준비_6">5.6.1. 배포 준비</a></h4>
<div class="paragraph">
<p>본 문서 <a href="./040.kubernetes_based_deployment.html#kubernetes_based_deployment-web-prepare">Web Server 배포 준비</a> 부분의 설명을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="_설정_항목_10"><a class="link" href="#_설정_항목_10">5.6.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_10"><a class="link" href="#_기본_설정_항목_10">기본 설정 항목</a></h5>
<div class="paragraph">
<p>Web Server Container는 다음과 같은 권고 설정을 기준으로 배포되어야 한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 57.1428%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/W 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overlay Network - Ingress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">End Point 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 7180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_service_관련_4"><a class="link" href="#_적용시점_결정_항목_service_관련_4">적용시점 결정 항목 – Service 관련</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Docker Compose 파일에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-web:1.5.0.1-centos7-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stack명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Swarm Cluster내 논리적 그룹 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">example</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service를 식별하는 이름으로, Stack내에서 유일한 값이 어야
한다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-web-cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Alias</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Swarm Cluster내 N/W식별자 (Domain 주소)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-cluster.example.local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replica 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Health Check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpGetAction, 체크 Page, 시작 Delay 시간, 주기는 Application
특성에 맞도록 설정 필요</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">‘/index.html’ 호출</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB-001:1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트<br>
(앞서 설치된 Manager의 Service 주소)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.example.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_KEY</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA_MANAGER_KEY : Open API로 Manager 접근시 필요한 인증토큰</p>
</li>
<li>
<p>Manager의 Admin &gt; Users 메뉴에서 확인가능</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 Manager에서 확인 입력 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_DOWNLOAD</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>설정 정보 다운로드 여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONTRACT_CODE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>라이선스 다운로드를 위한 계약 코드</p>
</li>
<li>
<p>라이선스 발급 시 제공된 코드 값</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 코드 확인 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LICENSE_DOWNLOAD_URL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>라이선스 다운로드 위치</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_RUN_AGENT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Agent 실행여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_명세서_compose_파일_기반_배포_4"><a class="link" href="#_명세서_compose_파일_기반_배포_4">5.6.3. 명세서 (Compose 파일) 기반 배포</a></h4>
<div class="paragraph">
<p>다음은 LENA WEB Server를 기동하기 위한 Docker Compose 파일 샘플이고, 상세 내용은 앞서 설명된 설정 항목의 결정에 따라 Project 환경에 맞도록 변경하여 사용할 수 있다.</p>
</div>
<div class="listingblock">
<div class="title">LENA Web Service 명세(lena-web-cluster.yaml) 파일 Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">version</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3.8</span><span class="delimiter">&quot;</span></span>

<span class="key">services</span>:
  <span class="key">lena-web-cluster</span>:
    <span class="key">image</span>: <span class="string"><span class="content">lenacloud/lena-web:1.5.0.1-centos7-jdk8-openjdk</span></span>
    <span class="key">networks</span>:
      <span class="key">lena-net</span>:
        <span class="key">aliases</span>:
        - <span class="string"><span class="content">web-cluster.example.local</span></span>
    <span class="key">ports</span>:
    - <span class="string"><span class="content">target: 7180</span></span>
      <span class="key">published</span>: <span class="string"><span class="content">7180</span></span>
      <span class="key">protocol</span>: <span class="string"><span class="content">tcp</span></span>
      <span class="key">mode</span>: <span class="string"><span class="content">ingress</span></span>
    <span class="key">environment</span>:
      <span class="key">LENA_MANAGER_ADDRESS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lena-manager.example.local:7700</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_MONITORING_PORT</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">16100</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_MANAGER_KEY</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">C9PYwcu%2FDcB12IyhTrD63o2mXtnCWqV0dvnhunznedBnpRUgjVr6QeLA9zvReQqWMzbgyIHNVajoSvSuE0jANQ%3D%3D</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONFIG_TEMPLATE_DOWNLOAD</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONFIG_TEMPLATE_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">web-cluster</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_LICENSE_DOWNLOAD_URL</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_CONTRACT_CODE</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">vvW7ebNFVjDdtasuvF1utQ==</span><span class="delimiter">&quot;</span></span>
      <span class="key">LENA_AGENT_RUN</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>
    <span class="key">deploy</span>:
      <span class="key">mode</span>: <span class="string"><span class="content">replicated</span></span>
      <span class="key">replicas</span>: <span class="string"><span class="content">2</span></span>
    <span class="key">healthcheck</span>:
      <span class="key">test</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">curl -f http://localhost:7180/index.html</span><span class="delimiter">&quot;</span></span>
      <span class="key">interval</span>: <span class="string"><span class="content">10s</span></span>
      <span class="key">timeout</span>: <span class="string"><span class="content">5s</span></span>
      <span class="key">retries</span>: <span class="string"><span class="content">3</span></span>
      <span class="key">start_period</span>: <span class="string"><span class="content">20s</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포실행<br>
배포는 docker stack deploy 명령으로 실행한다. 파일명이
lena-web-cluster.yaml이라면 배포 명령은 다음과 같다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker stack deploy \
    -c lena-net.yaml \
    -c lena-manager.yaml \
    -c lena-session-cluster.yaml \
    -c lena-was-cluster.yaml \
    -c lena-web-cluster.yaml \
    example</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>배포결과 확인<br>
배포된 Workload는 docker stack services 명령어 실행을 통해 확인할 수 있다.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ docker stack services example
ID                  NAME                       MODE                REPLICAS            IMAGE                                                   PORTS
............        example_lena-web-cluster   replicated          2/2                 lenacloud/lena-web:1.5.0.1-centos7-jdk8-openjdk   *:7180-&gt;7180/tcp
... (출력 일부 생략)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_등록_확인_8"><a class="link" href="#_server_등록_확인_8">5.6.4. Server 등록 확인</a></h4>
<div class="paragraph">
<p>Manager에 접속하여 ‘Cluster &gt; Service Cluster’ 메뉴에서 해당 Service
Cluster를 선택하여 정상 등록여부를 확인한다.
<span class="button">Server List 버튼</span>
을 클릭하면 하단에 2개의 Web Server가 조회되는 것을 확인한다.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server는 Manager의 Scheduler에 의해 등록되므로, 최대 15초 후 자동 등록된다</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ecs_기반_설치"><a class="link" href="#_ecs_기반_설치">6. ECS 기반 설치</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>본 장에서는 ECS환경에서 LENA 서버 또는 LENA 이미지 기반의 애플리케이션을 Container로 배포하는 방법을 설명한다. AWS
Console을 통해서 설치하는 방법을 설명한다. 또한, 일반적인 ECS 설정에
대한 부분은 제외하고, ECS환경에서 LENA를 구동하기 위해 필요한 내용만 다룬다.</p>
</div>
<div class="sect2">
<h3 id="_ecs_개요"><a class="link" href="#_ecs_개요">6.1. ECS 개요</a></h3>
<div class="paragraph">
<p>ECS는 AWS에서 제공하는 Container 서비스 플랫폼으로, Docker를 이용하여
EC2 인스턴스 상에서 Container를 배포/운영하고, 동일 Service를 제공하는 Container를 Task 단위로 묶어서
Replica, Service Discovery, L/B, Auto-scale 정책 등을 관리할 수 있는 기능을 제공한다.</p>
</div>
</div>
<div class="sect2">
<h3 id="_설치_준비_2"><a class="link" href="#_설치_준비_2">6.2. 설치 준비</a></h3>
<div class="paragraph">
<p>다음과 같은 ECS 환경이 미리 준비되어 있어야 한다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ECS Cluster 및 ECS 작업권한</p>
</li>
<li>
<p>ECS 환경에서 접근 가능한 Docker Registry (예 : ECR, Docker Hub)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>추가적으로 Container 기반 Manager를 설치하기 위해서는 외부 저장소가 필요하고, 이것은 Manager Container의 생성/소멸 시에도 기존 데이터 및 파일을 지속적으로 유지하기 위해 사용된다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EFS 등 외부 저장소 가능 환경 확인</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Container 기반 Manager 및 Session Server를 설치하기 위해서는 Service Discovery 기능이 적용되는 환경 (awsvpc 기반 EC2, Fargate 및 지원
Region)인지 사전 확인이 필요하다.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ECS Service Discovery 적용 가능 환경</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_manager_배포_3"><a class="link" href="#_manager_배포_3">6.3. Manager 배포</a></h3>
<div class="paragraph">
<p>ECS환경에서도 Manager Instance의 영속성 보장을 하기 위해서 1) 고정주소 2) 외부 Volume 두 가지가 필요하다. 고정 주소는 ECS의 Service Discovery나 ELB 연결을
통해서 가능하며, 외부 Volume은 EFS 연결를 통해 제공 가능하다. 하기에서는
Service Discovery와 EFS를 활용한 Manager 배포에 대해 설명한다.</p>
</div>
<div class="sect3">
<h4 id="ecs_based_deployment-mgr_config"><a class="link" href="#ecs_based_deployment-mgr_config">6.3.1. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_11"><a class="link" href="#_기본_설정_항목_11">기본 설정 항목</a></h5>
<div class="paragraph">
<p>Manager Container는 다음과 같은 권고 설정을 기준으로 배포되어야 한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. ECS기반 Manager 설치 - 배포 기준</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 유형</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Discovery 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Volume Mount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">디렉토리 /usr/local/lena/repository를 EFS에 연결</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목"><a class="link" href="#_적용시점_결정_항목">적용시점 결정 항목</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후 설명되는 설치과정에서 사용되는 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. ECS기반 Manager 설치 - 적용시점 결정 항목</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-manager:1.3.1.0_3-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe (Health Check)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpGetAction, ‘/lena’ 페이지 호출</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task 및 Service name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task 및 Service 의 이름</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service검색시 Domain 주소의 Suffix로 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Discovery Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service검색시 Domain 주소의 Prefix로 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다. 각 환경변수에 대한 상세한 설명은 본 문서의 <a href="./020.architecture_decision.html#architecture_decision_manager_env">Manager 환경변수</a> 부분 참조한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. ECS기반 Manager 설치 - 환경변수</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_HEAP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Heap Memory 크기 지정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024m (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_METASPACE_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Metaspace Memory크기</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256m (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_DOMAIN_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain Name 활성화 여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain 주소 Cache 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 (기본)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_task_설정"><a class="link" href="#_task_설정">6.3.2. Task 설정</a></h4>
<div class="paragraph">
<p>Task의 이름, 권한등은 Project의 표준에 따라 입력하길 권고하며,
하기에서는 Container 정의 중 LENA 운영을 위해 필요한 부분만 설명한다.
하기에 설명되는 설정의 기준은 <a href="#ecs_based_deployment-mgr_config">설정 항목</a> 부분의 설명을 참조한다.</p>
</div>
<div class="sect4">
<h5 id="_task_정의"><a class="link" href="#_task_정의">Task 정의</a></h5>
<div class="paragraph">
<p>Container 정보를 포함하는 Task를 정의한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_mgr_task_definition.png" alt="image" width="264" height="186">
</div>
<div class="title">Figure 17. ECS기반 Manager 설치 - Task 정의</div>
</div>
</div>
<div class="sect4">
<h5 id="_volume_추가"><a class="link" href="#_volume_추가">Volume 추가</a></h5>
<div class="paragraph">
<p>Task 정의에서 Manager Repository를 저장할 EFS와 저장위치를 정보를 추가한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_mgr_task_repository.png" alt="image" width="264" height="260">
</div>
<div class="title">Figure 18. ECS기반 Manager 설치 - Volume 추가</div>
</div>
</div>
<div class="sect4">
<h5 id="_container_추가"><a class="link" href="#_container_추가">Container 추가</a></h5>
<div class="paragraph">
<p>이름, 이미지등의 기본 Container정보를 입력한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_mgr_task_add_container.png" alt="image" width="529" height="103">
</div>
<div class="title">Figure 19. ECS기반 Manager 설치 - Container 추가</div>
</div>
</div>
<div class="sect4">
<h5 id="_환경변수_설정"><a class="link" href="#_환경변수_설정">환경변수 설정</a></h5>
<div class="paragraph">
<p>Container 설정중 환경변수를 추가한다. Manager 내부에서 Manager의 Service
Discovery 주소를 인식하지 못하므로 이를 환경변수 LENA_MANAGER_ADDRESS로
입력을 한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_mgr_task_env.png" alt="image" width="529" height="116">
</div>
<div class="title">Figure 20. ECS기반 Manager 설치 - 환경변수 설정</div>
</div>
</div>
<div class="sect4">
<h5 id="_health_check_설정"><a class="link" href="#_health_check_설정">Health Check 설정</a></h5>
<div class="paragraph">
<p><a href="http://localhost:7700/lena/" class="bare">http://localhost:7700/lena/</a> 페이지를 호출하는 Health Check 정보를 입력한다.</p>
</div>
</div>
<div class="sect4">
<h5 id="_volume_매핑"><a class="link" href="#_volume_매핑">Volume 매핑</a></h5>
<div class="paragraph">
<p>앞서 추가한 Volume을 Container내부 Directory와 매핑한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_task_volume_mapping.png" alt="image" width="463" height="160">
</div>
<div class="title">Figure 21. ECS기반 Manager 설치 - Volume 매핑</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_설정"><a class="link" href="#_service_설정">6.3.3. Service 설정</a></h4>
<div class="sect4">
<h5 id="_서비스_정의"><a class="link" href="#_서비스_정의">서비스 정의</a></h5>
<div class="paragraph">
<p>앞서 정의한 Task를 실제 기동/운영하기 위한 Service를 정의한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_svc_def.png" alt="image" width="401" height="333">
</div>
<div class="title">Figure 22. ECS기반 Manager 설치 - Service 정의</div>
</div>
</div>
<div class="sect4">
<h5 id="_서비스_검색_service_discovery_설정"><a class="link" href="#_서비스_검색_service_discovery_설정">서비스 검색 (Service Discovery) 설정</a></h5>
<div class="paragraph">
<p>AWS는 ECS간 서비스들을 연결하여 사용할 수 있도록 서비스 검색 (Service
Discovery) 기능을 지원한다. Manager는 Service Discovery 기능을 이용하여
고정된 주소를 확보하여, 타 Server의 설정 관리 및 모니터링 기능을 제공한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_svc_disc_def.png" alt="image" width="453" height="182">
</div>
<div class="title">Figure 23. ECS기반 Manager 설치 - Service Discovery 설정</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_기동_및_확인"><a class="link" href="#_service_기동_및_확인">6.3.4. Service 기동 및 확인</a></h4>
<div class="paragraph">
<p>Service 기동은 Service 정의를 저장하면 기동이 시작된다. ECS Cluster의
화면에서 서비스 및 작업 탭에서 운영중인 Service와 Task의 상태를
확인한다.</p>
</div>
<div class="sect4">
<h5 id="_service_상태_확인"><a class="link" href="#_service_상태_확인">Service 상태 확인</a></h5>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_svc_status.png" alt="image" width="529" height="178">
</div>
<div class="title">Figure 24. ECS기반 Manager 설치 - Service 상태 확인</div>
</div>
</div>
<div class="sect4">
<h5 id="_task_상태_확인"><a class="link" href="#_task_상태_확인">Task 상태 확인</a></h5>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_task_status.png" alt="image" width="529" height="224">
</div>
<div class="title">Figure 25. ECS기반 Manager 설치 - Task 상태 확인</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_session_server_배포_3"><a class="link" href="#_session_server_배포_3">6.4. Session Server 배포</a></h3>
<div class="paragraph">
<p>ECS에서 환경에서도 Session Server의 서비스를 위해 고정주소가 필요하다. 고정 주소는 ECS의 Service Discovery나 ELB 연결을 통해서 가능하다. 다음에서는 Service Discovery 를 활용한 Session Server 배포에 대해 설명한다.</p>
</div>
<div class="sect3">
<h4 id="_배포_준비_7"><a class="link" href="#_배포_준비_7">6.4.1. 배포 준비</a></h4>
<div class="paragraph">
<p>본문서 <a href="./040.kubernetes_based_deployment.html#kubernetes_based_deployment-session-prepare">Session Server 배포 준비</a> 부분 설명을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="ecs_based_deployment-ses_config"><a class="link" href="#ecs_based_deployment-ses_config">6.4.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_12"><a class="link" href="#_기본_설정_항목_12">기본 설정 항목</a></h5>
<div class="paragraph">
<p>Session Server Container는 다음과 같은 권고 설정을 기준으로 배포되어야
한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. ECS 기반 Session Server 배포 기준</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 종류</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service / Replica개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 2개, 각 Service 별 Replica 1개</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 5180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">${LENA_SERVER_HOME}/health.sh 호출</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_2"><a class="link" href="#_적용시점_결정_항목_2">적용시점 결정 항목</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Task 및 Service 설정에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. ECS기반 Session Server 설치 - 적용시점 결정 항목</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-session:1.3.1.0-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task 및 Service name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task 및 Service 의 이름</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-session</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service검색시 Domain 주소의 Suffix로 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Discovery Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service검색시 Domain 주소의 Prefix로 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-session</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다. 각 환경변수에 대한 상세한 설명은
문서 <a href="./020.architecture_decision.html#architecture_decision_session_env">Session Server 환경변수</a> 부분 참조</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. ECS기반 Session Server 설치 - 환경변수</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_JVM_HEAP_SIZE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Heap Memory 크기 지정</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024m (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SESSION-001</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain 주소 Cache 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_0_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Primary Session 서버의 서비스 주소, Service 명 및 Service Discovery 설정에 따른 도메인 주소와 일치되어야 함</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-session-0.local:5180</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_1_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Secondary Session 서버의 서비스 주소, Service 명 및 Service Discovery 설정에 따른 도메인 주소와 일치되어야 함</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-session-1.local:5180</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_SESSION_EXPIRE_SEC</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Session 만료 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1800 (기본)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_SHARE_SESSION</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application 간 Session 공유여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_task_설정_2"><a class="link" href="#_task_설정_2">6.4.3. Task 설정</a></h4>
<div class="paragraph">
<p>Task의 이름, 권한등은 Project의 표준에 따라 입력하기를 권고하며,
다음에서는 Container 정의 중 LENA 운영을 위해 필요한 부분만 설명한다.
하기에 설명되는 설정의 기준은 <a href="#ecs_based_deployment-ses_config">설정항목</a> 부분의 설명을 참조한다.</p>
</div>
<div class="sect4">
<h5 id="_task_정의_2"><a class="link" href="#_task_정의_2">Task 정의</a></h5>
<div class="paragraph">
<p>Container 정보를 포함하는 Task를 정의한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_ses_task_def.png" alt="image" width="349" height="252">
</div>
<div class="title">Figure 26. ECS기반 Session Server 설치 - Task 정의</div>
</div>
</div>
<div class="sect4">
<h5 id="_container_추가_2"><a class="link" href="#_container_추가_2">Container 추가</a></h5>
<div class="paragraph">
<p>이름, 이미지등의 기본 Container정보를 입력한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_ses_task_con.png" alt="image" width="623" height="100">
</div>
<div class="title">Figure 27. ECS기반 Session Server 설치 - Container 추가</div>
</div>
</div>
<div class="sect4">
<h5 id="_환경변수_설정_2"><a class="link" href="#_환경변수_설정_2">환경변수 설정</a></h5>
<div class="paragraph">
<p>Container 설정 중 환경변수를 추가한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_ses_task_env.png" alt="image" width="623" height="280">
</div>
<div class="title">Figure 28. ECS기반 Session Server 설치 - 환경변수 설정</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LENA_SESSION_1_ADDRESS 환경변수에 반드시 Secondary Session Service의 Service Discovery 주소를 입력한다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_설정_2"><a class="link" href="#_service_설정_2">6.4.4. Service 설정</a></h4>
<div class="sect4">
<h5 id="_서비스_정의_2"><a class="link" href="#_서비스_정의_2">서비스 정의</a></h5>
<div class="paragraph">
<p>앞서 정의한 Task를 실제 기동/운영하기 위한 Service를 정의한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_ses_svc_def.png" alt="image" width="396" height="341">
</div>
<div class="title">Figure 29. ECS기반 Session Server 설치 - Service 정의</div>
</div>
</div>
<div class="sect4">
<h5 id="_서비스_검색_service_discovery_설정_2"><a class="link" href="#_서비스_검색_service_discovery_설정_2">서비스 검색 (Service Discovery) 설정</a></h5>
<div class="paragraph">
<p>AWS는 ECS간 서비스들을 연결하여 사용할 수 있도록 서비스 검색 (Service
Discovery) 기능을 지원한다. Manager는 Service Discovery 기능을 이용하여
고정된 주소를 확보하여, 타 Server의 설정 관리 및 모니터링 기능을 제공한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_ses_svc_disc.png" alt="image" width="473" height="249">
</div>
<div class="title">Figure 30. ECS기반 Session Server 설치 - Service Discovery 설정</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_기동_및_확인_2"><a class="link" href="#_service_기동_및_확인_2">6.4.5. Service 기동 및 확인</a></h4>
<div class="paragraph">
<p>Service 기동은 Service 정의를 저장하면 기동이 시작된다. ECS Cluster의
화면에서 서비스 및 작업 탭에서 운영중인 Service와 Task의 상태를 확인한다</p>
</div>
<div class="sect4">
<h5 id="_service_상태_확인_2"><a class="link" href="#_service_상태_확인_2">Service 상태 확인</a></h5>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_ses_svc_status.png" alt="image" width="529" height="172">
</div>
<div class="title">Figure 31. ECS기반 Session Server 설치 - Service 상태 확인</div>
</div>
</div>
<div class="sect4">
<h5 id="_task_상태_확인_2"><a class="link" href="#_task_상태_확인_2">Task 상태 확인</a></h5>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_ses_task_status.png" alt="image" width="527" height="245">
</div>
<div class="title">Figure 32. ECS기반 Session Server 설치 - Task 상태확인</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_was_배포_3"><a class="link" href="#_was_배포_3">6.5. WAS 배포</a></h3>
<div class="sect3">
<h4 id="_배포_준비_8"><a class="link" href="#_배포_준비_8">6.5.1. 배포 준비</a></h4>
<div class="paragraph">
<p>본문서 <a href="./040.kubernetes_based_deployment.html#kubernetes_based_deployment-application-prepare">WAS 배포준비</a> 부분 설명을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="ecs_based_deployment_app_config"><a class="link" href="#ecs_based_deployment_app_config">6.5.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_13"><a class="link" href="#_기본_설정_항목_13">기본 설정 항목</a></h5>
<div class="paragraph">
<p>WAS Container는 다음과 같은 권고 설정을 기준으로 배포
된다..</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. ECS기반 WAS 설치 - 배포 기준</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 종류</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 8180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_3"><a class="link" href="#_적용시점_결정_항목_3">적용시점 결정 항목</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Task 및 Service 설정에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. ECS기반 WAS 설치 - 적용시점 결정 항목</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-cluster:1.5.0.1-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task 및 Service name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task 및 Service 의 이름</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service와의 연결, 검색에 사용되는 Label로 Key: Value쌍으로
정의된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type: lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service검색시 Domain 주소의 Suffix로 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Discovery Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service검색시 Domain 주소의 Prefix로 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe (Health Check)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">체크 Page, 시작 Delay 시간, 주기는 Application
특성에 맞도록 설정 필요</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">‘/’ 호출</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.
각 환경변수에 대한 상세한 설명은 본 문서 <a href="./020.architecture_decision.html#architecture_decision_application_env">WAS 환경변수</a>  부분을 참조한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. ECS기반 WAS 설치 - 환경변수</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WAS-001:1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트
(앞서 설치된 Manager의 Service 주소)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_KEY</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA_MANAGER_KEY : Open API로 Manager 접근시 필요한 인증토큰</p>
</li>
<li>
<p>Manager의 Admin &gt; Users 메뉴에서 확인 가능</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 Manager의 Administration &gt; IAM &gt; Users 메뉴에서 확인 및 입력 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_DOWNLOAD</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>설정 정보 다운로드 여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONTRACT_CODE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>라이선스 다운로드를 위한 계약 코드</p>
</li>
<li>
<p>라이선스 발급 시 제공된 코드 값</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 코드 확인 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LICENSE_DOWNLOAD_URL</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAVA_DOMAIN_CACHE_TTL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Domain 주소 Cache 시간 (초)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 (기본)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_task_설정_3"><a class="link" href="#_task_설정_3">6.5.3. Task 설정</a></h4>
<div class="paragraph">
<p>Task의 이름, 권한등은 Project의 표준에 따라 입력하기를 권고하며, 하기에서는 Container 정의 중 LENA 운영을 위해 필요한 부분만 설명한다. 하기에 설명되는 설정의 기준은 본문서 <a href="#ecs_based_deployment_app_config">설정 항목</a> 부분의 설명을 참조한다.</p>
</div>
<div class="sect4">
<h5 id="_task정의"><a class="link" href="#_task정의">Task정의</a></h5>
<div class="paragraph">
<div class="title">ECS기반 WAS 설치 - Task정의</div>
<p>Container 정보를 포함하는 Task를 정의한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_task_def.png" alt="image" width="340" height="252">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_container_추가_3"><a class="link" href="#_container_추가_3">Container 추가</a></h5>
<div class="paragraph">
<p>이름, 이미지등의 기본 Container정보를 입력한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_task_con.png" alt="image" width="455" height="93">
</div>
<div class="title">Figure 33. ECS기반 WAS 설치 - Container 추가</div>
</div>
</div>
<div class="sect4">
<h5 id="_환경변수_설정_3"><a class="link" href="#_환경변수_설정_3">환경변수 설정</a></h5>
<div class="paragraph">
<p>Container 설정중 환경변수를 추가한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_task_env.png" alt="image" width="553" height="238">
</div>
<div class="title">Figure 34. ECS기반 WAS 설치 - 환경변수 설정</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_설정_3"><a class="link" href="#_service_설정_3">6.5.4. Service 설정</a></h4>
<div class="sect4">
<h5 id="_서비스_정의_3"><a class="link" href="#_서비스_정의_3">서비스 정의</a></h5>
<div class="paragraph">
<p>앞서 정의한 Task를 실제 기동/운영하기 위한 Service를 정의한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_svc_def.png" alt="image" width="343" height="288">
</div>
<div class="title">Figure 35. ECS기반 WAS 설치 - Service 정의</div>
</div>
</div>
<div class="sect4">
<h5 id="_서비스_검색_service_discovery_설정_3"><a class="link" href="#_서비스_검색_service_discovery_설정_3">서비스 검색 (Service Discovery) 설정</a></h5>
<div class="paragraph">
<p>AWS는 ECS간 서비스들을 연결하여 사용할 수 있도록 서비스 검색 (Service
Discovery) 기능을 지원한다. Manager는 Service Discovery 기능을 이용하여
고정된 주소를 확보하여, 타 Server의 설정 관리 및 모니터링 기능을 제공한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_svc_disc.png" alt="image" width="456" height="241">
</div>
<div class="title">Figure 36. ECS기반 WAS 설치 - Service Discovery 설정</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_기동_및_확인_3"><a class="link" href="#_service_기동_및_확인_3">6.5.5. Service 기동 및 확인</a></h4>
<div class="paragraph">
<p>Service 기동은 Service 정의를 저장하면 기동이 시작된다. ECS Cluster의
화면에서 서비스 및 작업 탭에서 운영중인 Service와 Task의 상태를
확인한다.</p>
</div>
<div class="sect4">
<h5 id="_service_상태_확인_3"><a class="link" href="#_service_상태_확인_3">Service 상태 확인</a></h5>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_svc_status.png" alt="image" width="504" height="159">
</div>
<div class="title">Figure 37. ECS기반 WAS 설치 - Service 상태 확인</div>
</div>
</div>
<div class="sect4">
<h5 id="_task_상태_확인_3"><a class="link" href="#_task_상태_확인_3">Task 상태 확인</a></h5>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_task_status.png" alt="image" width="501" height="207">
</div>
<div class="title">Figure 38. ECS기반 WAS 설치 - Task 상태 확인</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_embedded_was_배포_3"><a class="link" href="#_embedded_was_배포_3">6.6. Embedded WAS 배포</a></h3>
<div class="sect3">
<h4 id="_배포_준비_9"><a class="link" href="#_배포_준비_9">6.6.1. 배포 준비</a></h4>
<div class="paragraph">
<p>본문서 <a href="./040.kubernetes_based_deployment.html#kubernetes_based_deployment-embedded-application-prepare">Embedded WAS 배포준비</a> 부분 설명을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="ecs_based_deployment_embedded_app_config"><a class="link" href="#ecs_based_deployment_embedded_app_config">6.6.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_14"><a class="link" href="#_기본_설정_항목_14">기본 설정 항목</a></h5>
<div class="paragraph">
<p>Embedded WAS Container는 다음과 같은 권고 설정을 기준으로 배포
된다..</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. ECS기반 Embedded WAS 설치 - 배포 기준</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 종류</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 8180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_4"><a class="link" href="#_적용시점_결정_항목_4">적용시점 결정 항목</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 Task 및 Service 설정에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. ECS기반 WAS 설치 - 적용시점 결정 항목</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-embedded:1.5.0.1-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task 및 Service name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task 및 Service 의 이름</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">label</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service와의 연결, 검색에 사용되는 Label로 Key: Value쌍으로
정의된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type: lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service검색시 Domain 주소의 Suffix로 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Discovery Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service검색시 Domain 주소의 Prefix로 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-was</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe (Health Check)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">체크 Page, 시작 Delay 시간, 주기는 Application
특성에 맞도록 설정 필요</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">‘/’ 호출</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다.
각 환경변수에 대한 상세한 설명은 본문서 <a href="./020.architecture_decision.html#architecture_decision_embedded_application_env">Embedded WAS 환경변수</a> 부분을 참조한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 50%;">
<col style="width: 16.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WAS-001:1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트<br>
(앞서 설치된 Manager의 Service 주소)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.default.svc.cluster.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_MONITORING_PORT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Manager 모니터링 Port 정보</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_APP_FILE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application Jar 파일 명</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sample-app.jar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_APP_DIR</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Application Jar 디렉토리 명</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local/lena</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_task_설정_4"><a class="link" href="#_task_설정_4">6.6.3. Task 설정</a></h4>
<div class="paragraph">
<p>Task의 이름, 권한등은 Project의 표준에 따라 입력하기를 권고하며, 하기에서는 Container 정의 중 LENA 운영을 위해 필요한 부분만 설명한다. 하기에 설명되는 설정의 기준은 본문서 <a href="#ecs_based_deployment_app_config">설정 항목</a> 부분의 설명을 참조한다.</p>
</div>
<div class="sect4">
<h5 id="_task정의_2"><a class="link" href="#_task정의_2">Task정의</a></h5>
<div class="paragraph">
<div class="title">ECS기반 Embedded WAS 설치 - Task정의</div>
<p>Container 정보를 포함하는 Task를 정의한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_task_def.png" alt="image" width="340" height="252">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_container_추가_4"><a class="link" href="#_container_추가_4">Container 추가</a></h5>
<div class="paragraph">
<p>이름, 이미지등의 기본 Container정보를 입력한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_task_con.png" alt="image" width="455" height="93">
</div>
<div class="title">Figure 39. ECS기반 Embedded WAS 설치 - Container 추가</div>
</div>
</div>
<div class="sect4">
<h5 id="_환경변수_설정_4"><a class="link" href="#_환경변수_설정_4">환경변수 설정</a></h5>
<div class="paragraph">
<p>Container 설정중 환경변수를 추가한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_task_env.png" alt="image" width="553" height="238">
</div>
<div class="title">Figure 40. ECS기반 Embedded WAS 설치 - 환경변수 설정</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_설정_4"><a class="link" href="#_service_설정_4">6.6.4. Service 설정</a></h4>
<div class="sect4">
<h5 id="_서비스_정의_4"><a class="link" href="#_서비스_정의_4">서비스 정의</a></h5>
<div class="paragraph">
<p>앞서 정의한 Task를 실제 기동/운영하기 위한 Service를 정의한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_svc_def.png" alt="image" width="343" height="288">
</div>
<div class="title">Figure 41. ECS기반 WAS 설치 - Service 정의</div>
</div>
</div>
<div class="sect4">
<h5 id="_서비스_검색_service_discovery_설정_4"><a class="link" href="#_서비스_검색_service_discovery_설정_4">서비스 검색 (Service Discovery) 설정</a></h5>
<div class="paragraph">
<p>AWS는 ECS간 서비스들을 연결하여 사용할 수 있도록 서비스 검색 (Service
Discovery) 기능을 지원한다. Manager는 Service Discovery 기능을 이용하여
고정된 주소를 확보하여, 타 Server의 설정 관리 및 모니터링 기능을 제공한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_svc_disc.png" alt="image" width="456" height="241">
</div>
<div class="title">Figure 42. ECS기반 Embedded WAS 설치 - Service Discovery 설정</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_기동_및_확인_4"><a class="link" href="#_service_기동_및_확인_4">6.6.5. Service 기동 및 확인</a></h4>
<div class="paragraph">
<p>Service 기동은 Service 정의를 저장하면 기동이 시작된다. ECS Cluster의
화면에서 서비스 및 작업 탭에서 운영중인 Service와 Task의 상태를
확인한다.</p>
</div>
<div class="sect4">
<h5 id="_service_상태_확인_4"><a class="link" href="#_service_상태_확인_4">Service 상태 확인</a></h5>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_svc_status.png" alt="image" width="504" height="159">
</div>
<div class="title">Figure 43. ECS기반 WAS 설치 - Service 상태 확인</div>
</div>
</div>
<div class="sect4">
<h5 id="_task_상태_확인_4"><a class="link" href="#_task_상태_확인_4">Task 상태 확인</a></h5>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_app_task_status.png" alt="image" width="501" height="207">
</div>
<div class="title">Figure 44. ECS기반 WAS 설치 - Task 상태 확인</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_server_배포_3"><a class="link" href="#_web_server_배포_3">6.7. Web Server 배포</a></h3>
<div class="sect3">
<h4 id="_배포준비"><a class="link" href="#_배포준비">6.7.1. 배포준비</a></h4>
<div class="paragraph">
<p>본 문서 <a href="#kubernetes_based_deployment-web-prepare">Web Server 배포 준비</a> 부분의 설명을 참조한다.</p>
</div>
</div>
<div class="sect3">
<h4 id="ecs_based_deployment_web_config"><a class="link" href="#ecs_based_deployment_web_config">6.7.2. 설정 항목</a></h4>
<div class="sect4">
<h5 id="_기본_설정_항목_15"><a class="link" href="#_기본_설정_항목_15">기본 설정 항목</a></h5>
<div class="paragraph">
<p>Web Server Container는 다음과 같은 권고 설정을 기준으로 배포되어야 한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. ECS기반 Web Server 설치 - 배포 기준</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설정 값 / 설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 종류</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replica</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP : 7180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_적용시점_결정_항목_5"><a class="link" href="#_적용시점_결정_항목_5">적용시점 결정 항목</a></h5>
<div class="paragraph">
<p>적용 시점 Project 환경에 따라 결정해서 적용해야 할 설정 요소와 이후
설명되는 ECS Task 및 Service 설정에 적용된 Sample 값은 다음과 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. ECS기반 Web Server 설치 - 적용시점 결정 항목</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">설정 관련 항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project별 Architecture 결정에 따라 선별된 OS 및 JDK
버전에 맞는 LENA Manager Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenacloud/lena-web:1.3.1.0_3-jdk8-openjdk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task 및 Service name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task의 이름, 이 값은 Task 이름 / Hostname의
Prefix로 사용된다.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-web</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replica 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container (Task) 개수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Probe (Health Check)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">시작 Delay시간, 주기는 Application 특성에 맞게
설정 필요</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">‘/’ 호출</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service검색시 Domain 주소의 Suffix로 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Discovery Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service검색시 Domain 주소의 Prefix로 사용</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-web</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>설정 가능한 환경변수는 다음과 같다. 각 환경변수에 대한 상세한 설명은 본문서 <a href="./020.architecture_decision.html#architecture_decision_web_env">Web Server 환경변수</a> 부분을 참조한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. ECS기반 Web Server 설치 - 환경변수</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">환경변수</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">Sample 값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_ID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service Cluster 명 : Revision No</p>
</li>
<li>
<p>Revision No가 빈값인 경우 Default Revision을 다운로드 받음</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEB-001:1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Service의 Domain 주소 : 포트
(앞서 설치된 Manager의 Service 주소)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-manager.local:7700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_MANAGER_KEY</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>LENA_MANAGER_KEY : Open API로 Manager 접근시 필요한 인증토큰</p>
</li>
<li>
<p>Manager의 Admin &gt; Users 메뉴에서 확인가능</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 Manager에서 확인 입력 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONFIG_TEMPLATE_DOWNLOAD</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>설정 정보 다운로드 여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_CONTRACT_CODE</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>라이선스 다운로드를 위한 계약 코드</p>
</li>
<li>
<p>라이선스 발급 시 제공된 코드 값</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(개별 코드 확인 필요)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_LICENSE_DOWNLOAD_URL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>라이선스 다운로드 위치</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_RUN_AGENT</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Agent 실행여부</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_task_설정_5"><a class="link" href="#_task_설정_5">6.7.3. Task 설정</a></h4>
<div class="paragraph">
<p>Task의 이름, 권한등은 Project의 표준에 따라 입력하고, Container 정의 중
LENA 운영을 위해 필요한 부분만 설명한다. 하기에 설명되는 설정의 기준은
본문서 <a href="#ecs_based_deployment_web_config">설정항목</a> 부분의 설명을 참조한다.</p>
</div>
<div class="sect4">
<h5 id="_task정의_3"><a class="link" href="#_task정의_3">Task정의</a></h5>
<div class="paragraph">
<p>Container 정보를 포함하는 Task를 정의한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_web_task_def.png" alt="image" width="336" height="241">
</div>
<div class="title">Figure 45. ECS기반 Web Server 설치 - Task 정의</div>
</div>
</div>
<div class="sect4">
<h5 id="_container_추가_5"><a class="link" href="#_container_추가_5">Container 추가</a></h5>
<div class="paragraph">
<p>이름, 이미지등의 기본 Container정보를 입력한다</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_web_task_con.png" alt="image" width="469" height="96">
</div>
<div class="title">Figure 46. ECS기반 Web Server 설치 - Container 추가</div>
</div>
</div>
<div class="sect4">
<h5 id="_환경변수_설정_5"><a class="link" href="#_환경변수_설정_5">환경변수 설정</a></h5>
<div class="paragraph">
<p>Container 설정중 환경변수를 추가한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_web_task_env.png" alt="image" width="623" height="269">
</div>
<div class="title">Figure 47. ECS기반 Web Server 설치 - 환경변수 설정</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_설정_5"><a class="link" href="#_service_설정_5">6.7.4. Service 설정</a></h4>
<div class="sect4">
<h5 id="_서비스_정의_5"><a class="link" href="#_서비스_정의_5">서비스 정의</a></h5>
<div class="paragraph">
<p>앞서 정의한 Task를 실제 기동/운영하기 위한 Service를 정의한다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_web_svc_def.png" alt="image" width="341" height="252">
</div>
<div class="title">Figure 48. ECS기반 Web Server 설치 - Service 정의</div>
</div>
</div>
<div class="sect4">
<h5 id="_서비스_검색_service_discovery_설정_5"><a class="link" href="#_서비스_검색_service_discovery_설정_5">서비스 검색 (Service Discovery) 설정</a></h5>
<div class="paragraph">
<p>Web Server는 ELB 또는 Service Discovery 기능을 이용하여 고정된 주소를
확보하여 외부 또는 타 서비스에 Web 서비스를 제공할 수 있다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_web_svc_disc.png" alt="image" width="342" height="181">
</div>
<div class="title">Figure 49. ECS기반 Web Server 설치 - Service Discovery 설정</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_service_기동_및_확인_5"><a class="link" href="#_service_기동_및_확인_5">6.7.5. Service 기동 및 확인</a></h4>
<div class="paragraph">
<p>Service 기동은 Service 정의를 저장하면 기동이 시작된다. ECS Cluster의
화면에서 서비스 및 작업 탭에서 운영중인 Service와 Task의 상태를
확인한다.</p>
</div>
<div class="sect4">
<h5 id="_service_상태_확인_5"><a class="link" href="#_service_상태_확인_5">Service 상태 확인</a></h5>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_web_svc_status.png" alt="image" width="454" height="131">
</div>
<div class="title">Figure 50. ECS기반 Web Server 설치 - Service 상태 확인</div>
</div>
</div>
<div class="sect4">
<h5 id="_task_상태_확인_5"><a class="link" href="#_task_상태_확인_5">Task 상태 확인</a></h5>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/ecs_based_deployment_web_task_status.png" alt="image" width="454" height="196">
</div>
<div class="title">Figure 51. ECS기반 Web Server 설치 - Task 상태 확인</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vmhost_기반_설치"><a class="link" href="#_vmhost_기반_설치">7. VM/Host 기반 설치</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_설치준비"><a class="link" href="#_설치준비">7.1. 설치준비</a></h3>
<div class="paragraph">
<p>설치 준비 작업으로 설치파일을 대상 서버에 업로드하고, Manager 및 Node
Agent를 설치 및 실행한다. 이후 설치 작업은 Manager의 Web UI를 통해서
설치가 가능하며, 방화벽 등으로 Web UI 접속이 되지 않은 경우, 커맨드
라인으로도 동일하게 설치가 가능하다.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lena_설치"><a class="link" href="#_lena_설치">7.2. LENA 설치</a></h3>
<div class="paragraph">
<p>LENA 설치파일은 gzip형식으로 제공되며, 설치 대상 서버에 업로드 후 설치
홈 디렉토리(${LENA_HOME} )에 압축을 해제한다. 기본 설치 경로는
‘/engn001/lena/1.3/’를 사용한다.</p>
</div>
<div class="listingblock">
<div class="title">LENA 설치</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[engn001]#
[engn001]# tar -xzvf lena-1.3.x.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>설치 모듈은 용도에 따라 다음과 같이 제공이 된다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. LENA 설치 모듈 목록</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scripts</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-[버전].tar.gz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web/Application 통합 설치 파일로 Application
Server, Web Server, Session Server 설치 모듈이 모두 포함</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-1.3.x.tar.gz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-enterprise-[버전].tar.gz</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enterprise 버전의 WAS설치 모듈</p>
</div>
<div class="paragraph">
<p>Enterprise 버전에는 Session Server가 포함</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-enterprise-1.3.x.tar.gz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-standard-[버전].tar.gz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard 버전의 WAS설치
모듈</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lena-standard-1.3.x.tar.gz</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_디렉토리_구성"><a class="link" href="#_디렉토리_구성">7.3. 디렉토리 구성</a></h3>
<div class="paragraph">
<p>LENA 설치를 위한 파일을 준비한다. LENA 설치 파일은 별도로 제공된다.</p>
</div>
<div class="paragraph">
<p>${LENA_HOME}의 디렉토리 구조는 아래와 같다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. 디렉토리 구조</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>디렉토리</strong></th>
<th class="tableblock halign-left valign-top"><strong>설명</strong></th>
<th class="tableblock halign-left valign-top"><strong>비고</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bin</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Node Agent와 Manager의 Start/Stop scripts,</p>
</div>
<div class="paragraph">
<p>install scripts 제공</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node Agent, Manager 등의 설정파일</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">모니터링에서 생성한 일별 데이터를 저장하는 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">depot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">설치를 위한 Local Repository</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">etc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">기타 메타 정보 및 설정 파일</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">license</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">License 정보를 관리하는 디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node Agent / Manager 로그파일</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>실행에 필요한 모듈이 위치하는 경로</p>
</div>
<div class="paragraph">
<p>(lena-node-agent, lena-installer, lena-manager 등)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">servers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server가 설치될 기본경로</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">임시디렉토리</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>제공하는 실행 Scripts 는 아래와 같다. (${LENA_HOME}/bin 에 위치)</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. 제공 Script 목록</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scripts</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">install.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">서버를 설치하기 위한 기본 script</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-compile.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Server를 컴파일하기 위한 script</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-package-install.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Server 컴파일 및 구동에 필요한 패키지
설치 script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux only, root 권한 필요</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">crypt.sh</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Datasource에 사용하는 Password 수동 암호화 실행</p>
</div>
<div class="paragraph">
<p>(입력한 문자열을 암호화 문자열로 변환)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env-manager.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager실행을 위한 환경변수</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager 설치시</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start-manager.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager의 실행</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager 설치시</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stop-manager.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager의 종료</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager 설치시</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps-manager.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager의 프로세스 확인</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager 설치시</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start-agent.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node Agent의 실행</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stop-agent.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node Agent의 종료</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ps-agent.sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node Agent의 프로세스 확인</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>환경설정 파일은 아래와 같다. (${LENA_HOME}/conf 에 위치)</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. 환경설정 파일 목록</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config File</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">manager.conf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager 관련 설정</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">agent.conf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node Agent 관련 설정</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_manager_설치"><a class="link" href="#_manager_설치">7.4. Manager 설치</a></h3>
<div class="paragraph">
<p>제공되는 LENA는 Web Server, WAS와 Session Server,
Node/Server에 설치되어 제어 및 Status를 확인하는 Agent와 관리자에게
제공되는 Manager로 구성된다.</p>
</div>
<div class="sect3">
<h4 id="_manager_설치_2"><a class="link" href="#_manager_설치_2">7.4.1. Manager 설치</a></h4>
<div class="paragraph">
<p>Manager는 install.sh을 이용하여 아래와 같은 순서로 설치한다.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>${LENA_HOME}/bin/install.sh create lena-manager</p>
</li>
<li>
<p>Service Port 정보를 입력한다. (default: 7700)</p>
</li>
<li>
<p>서버 상태정보를 수신 받을 port 정보를 입력한다. 기본 설정을 사용하며, Manager를 추가로 설치하는 경우에는 port를 변경한다. (default: 16100)</p>
</li>
<li>
<p>Manager를 실행할 OS계정을 입력한다. (default: 스크립트 실행
유저)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">LENA Manager 설치</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[bin]$ ./install.sh create lena-manager
*******************************
* LENA Server Install !       *
*******************************
+-------------------------------------------------------------------------------------
| 1. SERVICE_PORT is the port number used by Manager.
|    ex : 7700
| 2. MONITORING_PORT is the port number used by Manager for monitoring.
|    ex : 16100
| 3. RUN_USER is user running Argo Manager.
|    ex : tomat
+-------------------------------------------------------------------------------------
Input SERVICE_PORT for installation. (q:quit)
Default value is '7700'

Input MONITORING_PORT for installation. (q:quit)
Default value is '16100'

Input RUN_USER for installation. (q:quit)
Default value is 'lena'

========================= Execution Result ========================
LENA_HOME : /engn001/lena/1.3
JAVA_HOME : /engn001/java/jdk1.8.0_191
SERVER_ID : lena-manager
SERVICE_PORT : 7700
MONITORING_PORT : 16100
INSTALL_PATH : /engn001/lena/1.3/modules/lena-manager
RESULT : Success
MESSAGE : create succeeded
===================================================================

Execution is completed.!!
[bin]$</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>여러 대의 장비로 서비스를 하는 경우, Manager는 한대의 장비에만 설치한다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_manager_실행"><a class="link" href="#_manager_실행">7.4.2. Manager 실행</a></h4>
<div class="paragraph">
<p>Manager를 기동하여 정상적으로 설치되었는지 확인한다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>start-manager.sh 파일을 실행한다.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">LENA Manager 실행</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[bin]$ ./start-manager.sh
--------------------------------
            LENA Manager
--------------------------------
Using LENA_HOME :   /engn001/lena/1.3
Using JRE_HOME :    /engn001/java/jdk1.8.0_191
Using SERVER_PID :  /engn001/lena/1.3/modules/lena-manager/lena-manager_solmanager.pid
Using SERVER_HOME : /engn001/lena/1.3/modules/lena-manager
Using SERVER_ID :   lena-manager
Using INSTANCE_NAME : lena-manager_solmanager
LENA started.
[bin]$</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>http://[Manager IP]:7700 에 접속하여 아래 페이지를 확인한다.(초기값: admin/!admin1234)</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/vmhost_based_deployment_login.png" alt="image" width="535" height="307">
</div>
<div class="title">Figure 52. LENA Manager 로그인</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>stop-manager.sh 파일을 실행하여 종료 할 수 있다.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">LENA Manager 종료</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[bin]$ ./stop-manager.sh
--------------------------------
           LENA Manager
--------------------------------
Using LENA_HOME : /engn001/lena/1.3
Using JRE_HOME: /engn001/java/jdk1.8.0_191
Using SERVER_PID: /engn001/lena/1.3/modules/lena-manager/lena-manager_solmanager.pid
Using SERVER_HOME : /engn001/lena/1.3/modules/lena-manager
Using SERVER_ID : lena-manager
Using INSTANCE_NAME : lena-manager_solmanager
LENA stopped.
##### lena-manager_solmanager successfully shut down ######
[bin]$</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_node_agent_실행"><a class="link" href="#_node_agent_실행">7.5. Node Agent 실행</a></h3>
<div class="paragraph">
<p>Node Agent는 Node, Server의 제어 및 모니터링 기능을 담당하는 Agent 이다.
Node Agent는 LENA설치시 기본적으로 설치가 되며, Node에 대한 정보를
가져오기 위한 Agent를 실행하여야 한다. Node Agent는
Web/Application/Session Server의 상태조회 및 시작과 종료를 수행 할 수
있다.</p>
</div>
<div class="sect3">
<h4 id="_node_agent_실행_2"><a class="link" href="#_node_agent_실행_2">7.5.1. Node Agent 실행</a></h4>
<div class="paragraph">
<p>${LENA_HOME}/bin/start-agent.sh 파일을 실행한다. JAVA_HOME이 지정되지
않은 경우, terminal에서 JAVA_HOME을 입력하라는 메시지가 나오게 된다.
이때, JAVA_HOME의 경로를 입력하면 agent가 실행된다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[bin]# ./start-agent.sh
Input JAVA_HOME path for LENA. ( q: quit )
JAVA_HOME PATH :
/engn001/java/jdk1.8.0_191
Input Agent port for LENA Agent. ( q: quit )
Agent port (Default : 16800):
Input Agent user for LENA Agent. ( q: quit )
Agent user (Default : root):
root

--------------------------------
            LENA Agent
--------------------------------
Using LENA_HOME : /engn001/lena/1.3
Using JAVA_HOME : /engn001/java/jdk1.8.0_191/jre
Using CONF_FILE : /engn001/lena/1.3/conf/agent.conf
Using LOG_HOME : /engn001/lena/1.3/logs/lena-agent
Using RUN_USER : root
Using PORT : 16800
Using UUID : d03ddd60-de12-35df-9ea1-a409a3085eeb
LENA Agent is started.
[bin]#</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_node_agent_동작_여부_확인"><a class="link" href="#_node_agent_동작_여부_확인">7.5.2. Node Agent 동작 여부 확인</a></h4>
<div class="paragraph">
<p>${LENA_HOME}/bin/ps-agent.sh 파일을 실행하여 아래와 같이 Process의
상태를 확인한다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[bin]$ ./ps-agent.sh
lena     24208      1 62 14:00 ?      00:00:03 /engn001/java/jdk1.8.0_191/bin/java -Xms64m -Xmx256m -Dlena.home=/engn001/lena/1.3 -Dlog.home=/engn001/lena/1.3/logs/lena-agent -Dpatch.log.home=/engn001/lena/1.3/logs/lena-patcher -Djava.library.path=:/engn001/lena/1.3/modules/lena-agent/lib/sigar -Djava.net.preferIPv4Stack=true -cp .::/engn001/lena/1.3/modules/lena-agent/lib/bcprov-jdk15on-1.55.jar:/engn001/lena/1.3/modules/lena-agent/lib/lena-agent-1.3.0.jar:/engn001/lena/1.3/modules/lena-agent/lib:/engn001/java/jdk1.8.0_191/lib/tools.jar argo.node.agent.server.NodeAgentServer -start
[bin]$</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_node_agent_종료"><a class="link" href="#_node_agent_종료">7.5.3. Node Agent 종료</a></h4>
<div class="paragraph">
<p>stop-agent.sh를 실행하여 종료할 수 있다.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[bin]$ ./stop-agent.sh
--------------------------------
            LENA Agent
--------------------------------
Using LENA_HOME : /engn001/lena/1.3
Using JAVA_HOME : /engn001/java/jdk1.8.0_191/jre
Using CONF_FILE : /engn001/lena/1.3/conf/agent.conf
Using LOG_HOME : /engn001/lena/1.3/logs/lena-agent
Using RUN_USER : lena
Using PORT : 16800
Using UUID : 0d5f6a4a-1084-4bac-ad8c-70b67bf3e495
LENA Agent is stopped normally.
[bin]$</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_session_server_설치_web_ui_기반"><a class="link" href="#_session_server_설치_web_ui_기반">7.6. Session Server 설치 (WEB UI 기반)</a></h3>
<div class="paragraph">
<p>Session Server를 관리하기 위한 화면을 제공한다. Node에 설치한 Session
Server의 등록, 수정, 삭제가 가능하며, 시작과 종료 Shell을 실행할 수
있다.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/vmhost_based_deployment_session.png" alt="image" width="623" height="147">
</div>
<div class="title">Figure 53. Session Server 목록</div>
</div>
<div class="paragraph">
<p>Session Server의 속성은 아래와 같다. (*) 는 필수값</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Session Server의 속성</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server의 상태</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name(*)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server의 이름</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP(*)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server의 IP주소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server의 Identifier</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service 포트번호</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server의 유형</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start/Stop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server의 시작 및 종료</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon">+ 아이콘</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="button">Register 버튼</span> 또는 <span class="button">수정(연필) 버튼</span> 을 클릭하여 선택된 Server 정보가 변경 중임을 표시</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon">- 아이콘</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="button">삭제(휴지통) 버튼</span> 을 클릭하여 선택된
Server정보가 삭제됨을 표시</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_session_server_설치"><a class="link" href="#_session_server_설치">7.6.1. Session Server 설치</a></h4>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><span class="button">Install 버튼</span> 을 클릭한다.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/vmhost_based_deployment_ses_install.png" alt="image" width="413" height="304">
</div>
<div class="title">Figure 54. Session Server 설치시 입력 화면</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Server ID와 Service Port, Secondary Server IP/Port를 입력한다.</p>
</li>
<li>
<p>'Save' 버튼을 클릭하여 저장한다.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Node에 실제 설치되어 있는 서버와 Manager에서 관리하는 서버의 정보에는 차이가 있을 수 있다. (console기반 설치 시)</p>
</li>
<li>
<p>서버ID중복오류가 발생하는 경우, Register기능을 이용하여 설치된 서버정보를 확인한다.</p>
</li>
<li>
<p>Manager IP는 Node의 host IP로 자동 입력된다. 네트워크 구성에 따라 자동 입력된 IP가 실제 네트워크 IP와 다른 경우가 발생할 수 있다. 이때는 Manager IP를 수정하여 입력해야 한다.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_server_실행"><a class="link" href="#_server_실행">7.6.2. Server 실행</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><span class="button">Stop 버튼</span> 을 클릭하여 Server를 종료한다.</p>
</li>
<li>
<p><span class="button">Start 버튼</span> 을 클릭하여 Server를 시작한다.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>시작 가능한 상태일 경우에만 시작버튼이 활성화 된다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_server_삭제"><a class="link" href="#_server_삭제">7.6.3. Server 삭제</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><span class="button">삭제(휴지통) 버튼</span> 을 클릭하여 Server정보를 삭제 가능한 상태로 변경한다.</p>
</li>
<li>
<p><span class="button">Save 버튼</span> 을 클릭한다.</p>
</li>
<li>
<p>OK버튼을 누르면 Manager의 DB데이터와 물리적 서버를 완전히 삭제하고, Cancel버튼을 클릭하면 Manager의 DB 데이터만 삭제한다.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_server_등록"><a class="link" href="#_server_등록">7.6.4. Server 등록</a></h4>
<div class="paragraph">
<p>Console 기반으로 설치한 서버를 Manager를 통해서 관리하려면, Server 정보 등록이 필요하다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><span class="button">+Register 버튼</span> 을 클릭한다.</p>
</li>
<li>
<p>등록할 서버를 클릭한다.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="/resources/static/images/installation/container/vmhost_based_deployment_ses_regist.png" alt="image" width="623" height="146">
</div>
<div class="title">Figure 55. Session Server 등록시 Server 선택 화면</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p><span class="button">Save 버튼</span> 을 클릭하여 저장한다..</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_session_server_설치_cli_기반"><a class="link" href="#_session_server_설치_cli_기반">7.7. Session Server 설치 (CLI 기반)</a></h3>
<div class="sect3">
<h4 id="_session_server_설치_2"><a class="link" href="#_session_server_설치_2">7.7.1. Session Server 설치</a></h4>
<div class="paragraph">
<p>Session Server는 Embedded와 Standalone버전으로 구분된다. Embedded 버전의
경우 Application 서버 내에 포함되어 있어 별도 설치가 필요 없으며,
Standalone 버전 설치 시 install.sh을 이용하여 아래와 같은 순서로 설치한다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>${LENA_HOME}/bin/install.sh create lena-session</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Session Server 설치</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[bin]$ ./install.sh create lena-session
*******************************
* LENA Server Install !       *
*******************************
+-------------------------------------------------------------------------------------
| 1. SERVER_ID means business code of system and its number of letter is
from 3 to 5.
|    ex : tom1, tc01, svr01
| 2. SERVICE_PORT is the port number used by Session Server.
|    ex : 8080
| 3. SECONDARY_SERVER_IP is the ip number communicate with Secondary Session Server
|    ex : 127.0.0.1
| 4. SECONDARY_SERVICE_PORT is the port number used by Secondary Session
Server.
|    ex : 8080
| 5. RUN_USER is user running Session Server
|    ex : tomat, apahe
| 6. INSTALL_ROOT_PATH is is server root directory in filesystem.
|    ex : /ssw, /sw/server, /ssw/was
+-------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>입력 항목</p>
<div class="ulist">
<ul>
<li>
<p>항목별로 default값이 표시되며, 변경이 필요한 경우 사용자가 직접 입력하여 변경할 수 있다.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Session Server 설치시 입력 항목 예시</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">Input SERVER_ID for installation. (q:quit)
tm-session1
Input SERVICE_PORT for installation. (q:quit)
Default value is '5000'
5005
Input SECONDARY_SERVER_IP for installation. (q:quit)
127.0.0.1
Input SECONDARY_SERVICE_PORT for installation. (q:quit)
Default value is '5001'
5006
Input RUN_USER for installation. (q:quit)
Default value is 'lena'

Input INSTALL_ROOT_PATH for installation. (q:quit)
Default value is '/engn001/lena-1.3.0/tmservers'

 ========================= Execution Result =======================
LENA_HOME : /engn001/lena/1.3
JAVA_HOME : /engn001/java/jdk1.8.0_191/jre
SERVER_ID : tm-session1
SERVICE_PORT : 5005
SECONDARY_SERVER_IP : 127.0.01
SECONDARY_SERVICE_PORT : 5006
RUN_USER : lena
INSTALL_PATH : /engn001/lena/1.2/servers/session1
RESULT : Success
MESSAGE : create succeeded
 ===================================================================

create is completed.!!
[bin]$</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Session Server 설치시 입력 항목</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server의 ID</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVICE_PORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server의 서비스포트</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default: “5000”</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SECONDARY_SERVER_IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secondary Server의 IP주소</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SECONDARY_SERVICE_PORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secondary Server의 서비스포트</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default: “5001”</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RUN_USER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server를 실행하는 실행 계정명</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default: “스크립트
실행 계정”</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INSTALL_ROOT_PATH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Server를 설치할 상위 디렉토리</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default:
“${LENA_HOME}/tmservers”</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>$INSTALL_ROOT_PATH/tmservers/”SERVICE_ID” Directory생성을 확인한다.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>install.sh 수행 시 하나의 Session Server가 설치되며, N 개의 서버 설치 시 install.sh을 N회 수행해야 한다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_session_server_실행"><a class="link" href="#_session_server_실행">7.7.2. Session Server 실행</a></h4>
<div class="paragraph">
<p>Session Server를 기동하여 정상적으로 설치되었는지 확인한다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Session Server 설치 위치에서 start.sh 파일을 실행한다.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Session Server 기동</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[tm-session1]$ ./start.sh
--------------------------------
Start Session Server
--------------------------------
Using LENA_HOME : /engn001/lena/1.3
Using SERVER_HOME : /engn001/lena/1.3/servers/tm-session1
Using SERVER_ID : tm-session1
Using JAVA_HOME : /engn001/java/jdk1.8.0_191

Session Server Started..
[tm-session1]$</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>ps.sh 파일을 실행하여 프로세스의 상태를 확인한다.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Session Server 프로세스 상태 확인</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[tm-session1]$ ./ps.sh

lena 16232     1     1 09:56 pts/7 00:00:00 /engn001/java/jdk1.8.0_191/bin/java -Xmx1024m -Dzodiac.name=session_5105 -Dzodiac.logdir=/engn001/lena/1.3/logs/session-server -cp .::/engn001/lena/leesyong/1.2/servers/tm-session1/lib/lena-session-common-1.2.0.jar:/engn001/lena/leesyong/1.2/servers/tm-session1/lib/lena-session-server-1.2.0.jar -Dzodiac.config=session.conf zodiac.server.Main

[tm-session1]$</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Session Server 종료</div>
<ol class="arabic" start="3">
<li>
<p>stop.sh 파일을 실행하여 종료할 수 있다.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>[tm-session1]$ ./stop.sh
--------------------------------
Stop Session Server
--------------------------------
Using LENA_HOME : /engn001/lena/1.3
Using SERVER_HOME : /engn001/lena/1.3/servers/tm-session1
Using SERVER_ID : tm-session1
Using JAVA_HOME : /engn001/java/jdk1.8.0_191

Session Server Stoped..
[tm-session1]$</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_session_server_삭제"><a class="link" href="#_session_server_삭제">7.7.3. Session Server 삭제</a></h4>
<div class="paragraph">
<p>기 설치된 서버는 스크립트를 이용하여 Uninstall할 수 있다.</p>
</div>
<div class="paragraph">
<p>LENA에서는 설치된 서버의 정보를 별도의 xml파일에 저장하고 있다. 따라서,
directory를 직접 삭제하지 않고, install.sh 스크립트를 이용하여 Uninstall
해야 한다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>install.sh 스크립트 실행</p>
<div class="ulist">
<ul>
<li>
<p>Session Server : ${LENA_HOME}/bin/install.sh delete lena-session</p>
</li>
<li>
<p>Manager : ${LENA_HOME}/bin/install.sh delete lena-manager</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Session Server 삭제</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[lena@RNDTOMCAT1V bin]$ ./install.sh delete tm-session
*******************************
* LENA Server Install !       *
*******************************
+-------------------------------------------------------------------------------------
| 1. SERVER_ID : Server'id to delete
+-------------------------------------------------------------------------------------
Input SERVER_ID for installation. (q:quit)
tm-session
========================= Execution Result ========================
LENA_HOME : /engn001/lena/1.3
JAVA_HOME : /engn001/java/jdk1.8.0_191/jre
SERVER_ID : lenawas2
DELETE_PATH : /engn001/lena/1.3/servers/tm-session
RESULT : Success
MESSAGE : delete succeeded
===================================================================

delete is completed.!!

[bin]$</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>입력 항목</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Session Server 삭제시 이력 항목</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">항목</th>
<th class="tableblock halign-left valign-top">설명</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVER_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uninstall할 Server의 ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager의 경우 id가 lena-manager로
자동입력 되며, 별도로 Server ID를 입력 받지 않는다.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LENA에서는 설치된 서버의 정보를 별도의 xml파일에 저장하고 있다.
따라서, directory를 직접 삭제하지 않고, install.sh 스크립트를 이용하여 Uninstall해야 한다.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_별첨"><a class="link" href="#_별첨">8. 별첨</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lena_지원_spec별_버전"><a class="link" href="#_lena_지원_spec별_버전">8.1. LENA 지원 Spec별 버전</a></h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. LENA 지원 Spec</caption>
<colgroup>
<col style="width: 60%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Specification</strong></th>
<th class="tableblock halign-left valign-top"><strong>Version</strong></th>
<th class="tableblock halign-left valign-top"><strong>비고</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java Development Kit (JDK)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8~</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java Servlet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java Server Pages (JSP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expression Language (EL)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaServer Pages Standard Tag Library (JSTL)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise JavaBeans (EJB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java Message Service (JMS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java Transaction API (JTA)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java API for RESTful Services (JAX-RS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java API for XML Web Services (JAX-WS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_manager_db파일_백업"><a class="link" href="#_manager_db파일_백업">8.2. Manager DB파일 백업</a></h3>
<div class="paragraph">
<p>Manager의 내부데이터 관리를 위한 HSQL DB의 파일은 주기적으로(1일)
백업파일을 생성하고 있다. 생성위치는
${LENA_HOME}/repository/backup/lena-manager/script 이다.</p>
</div>
<div class="paragraph">
<p>기본적으로 30일 이전 백업정보는 삭제하도록 되어 있는데 보관기간을
변경하고 싶은 경우, ${LENA_HOME}/conf 폴더 하위에 manager.conf 파일을
열고, dbbackup.size=보관기간 을 입력 후 Manager를 재 기동하면 보관기간을
변경할 수 있다.</p>
</div>
</div>
<div class="sect2">
<h3 id="_manager_의_내부이력_삭제"><a class="link" href="#_manager_의_내부이력_삭제">8.3. Manager 의 내부이력 삭제</a></h3>
<div class="paragraph">
<p>Manager가 내부적으로 남기는 이력은 주기적으로 삭제하도록 스케쥴링이 되어
있다. 삭제하는 정보는 Action Trace 이력과 Server History 이력이다.</p>
</div>
<div class="paragraph">
<p>기본적으로 Action Trace이력은 30일까지만 보관하고, Server History 이력은
90일까지 보관하고 있다. 이 보관기간을 변경하고 싶은 경우
${LENA_HOME}/repository/conf 폴더 하위에 manager.conf 파일을 열고,
actiontrace.size=보관기간, serverhistory.size=보관기간을 입력 후
Manager를 재 기동하면 보관기간을 변경할 수 있다.</p>
</div>
</div>
<div class="sect2">
<h3 id="_manager_의_admin_패스워드_초기화"><a class="link" href="#_manager_의_admin_패스워드_초기화">8.4. Manager 의 admin 패스워드 초기화</a></h3>
<div class="paragraph">
<p>Manager의 admin사용자 패스워드를 분실하거나 비밀번호 오류횟수가
초과하였을 경우에는 console를 통하여 패스워드를 초기화해야 한다.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Manager가 설치된 장비에 console(telnet or ssh)로 접속한다.</p>
</li>
<li>
<p>$LENA_HOME/bin/reset_manager_pw.sh 파일을 실행한다.</p>
</li>
<li>
<p>패스워드를 초기화 할 user인 admin을 입력한다.</p>
</li>
<li>
<p>초기화할 패스워드를 입력한다. 단, 패스워드는 8자리이상,
알파벳/숫자/특수문자의 조합으로 입력한다. 패스워드는 보안을 위해
console에 표시되지 않는다.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Manager의 admin 패스워드 초기화</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[bin]$ ./reset-manager-pw.sh
*******************************
* LENA Server Install !       *
*******************************
+-------------------------------------------------------------------------------
| 1. USER_ID is the user id to reset
| ex : admin
| 2. NEW_PASSWORD is the password to change
| - password rule #1 : more than 8 length
| - password rule #2 : inclusion of one or more alphabet characters
| - password rule #3 : inclusion of one or more numerical digits
| - password rule #4 : inclusion of one or more special characters
+-------------------------------------------------------------------------------
Input USER_ID for installation. (q:quit)
administrator
Input NEW_PASSWORD for installation. (q:quit)

The password has been changed successfuly.
Execution is completed.!!s</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lena_설치_권장_os파라미터centos기준"><a class="link" href="#_lena_설치_권장_os파라미터centos기준">8.5. LENA 설치 권장 OS파라미터(CentOS기준)</a></h3>
<div class="paragraph">
<p>LENA 설치 시 OS파라미터는 max user processes 값을 8192이상으로 설정하는
것을 권장한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. 권장 OS파라미터  (CentOS 기준)</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter</th>
<th class="tableblock halign-left valign-top">권장값</th>
<th class="tableblock halign-left valign-top">기본값</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max user processes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8192<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">open files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8192<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>CentOS기준으로 max user processes 설정은 다음과 같이 ‘ulimit –a’
명령어를 실행하여 확인을 할 수 있다.</p>
</div>
<div class="listingblock">
<div class="title">OS 파라미터 max user processes 확인 (CentOS 기준)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ulimit -a +
core file size          (blocks, -c) 0 +
data seg size           (kbytes, -d) unlimited +
scheduling priority             (-e) 0 +
file size               (blocks, -f) 8192 +
pending signals                 (-i) 14891 +
max locked memory       (kbytes, -l) 64 +
max memory size         (kbytes, -m) unlimited +
open files                      (-n) 1024 +
pipe size            (512 bytes, -p) 8 +
POSIX message queues     (bytes, -q) 819200 +
real-time priority              (-r) 0 +
stack size              (kbytes, -s) 10240 +
cpu time               (seconds, -t) unlimited +
max user processes              (-u) 1024 +
virtual memory          (kbytes, -v) unlimited +
file locks                      (-x) unlimited</code></pre>
</div>
</div>
<div class="paragraph">
<p>CentOS를 기준으로 명령어 ‘ulimit –u’와 ‘ulimit –n’로 프로세스 수와
오픈파일 개수를 설정할 수 있다. 위 변경사항을 영구적으로 반영하기
위해서는 각 유저의 profile (.profile, .bash_profile)에 ulimit 실행명령을
추가하거나, 강제 설정할 수 있다 (CentOS 기준).</p>
</div>
<div class="listingblock">
<div class="title">OS 파라미터 설정 - 프로세스 수 및 오픈파일 개수 (CentOS 기준)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat $HOME/.bash_profile*
.. (생략)*
ulimit -u 8192*
ulimit -n 8192*</code></pre>
</div>
</div>
<div class="paragraph">
<p>또 다른 설정 방법으로는 /etc/security/limits.conf (CentOS 기준) 파일을
열어서 프로세스 최대수(nproc)와 오픈파일 최대수(nofile)를 설정한다.</p>
</div>
<div class="listingblock">
<div class="title">OS 파라미터 설정 - 프로세스 수 및 오픈파일 개수 (CentOS 기준)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat /etc/security/limits.conf*
.. (생략)*
*     soft nproc 8192*
*     hard nproc 8192*
*     soft nofile 8192*
*     hard nofile 8192*</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lena_주기적으로_증가하는_파일"><a class="link" href="#_lena_주기적으로_증가하는_파일">8.6. LENA 주기적으로 증가하는 파일</a></h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. 주기적으로 증가하는 파일</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">항목</th>
<th class="tableblock halign-left valign-top">경로</th>
<th class="tableblock halign-left valign-top">삭제주기</th>
<th class="tableblock halign-left valign-top">월 예상 증가량</th>
<th class="tableblock halign-left valign-top">비고</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager정기점검로깅</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME/repository/monitoringDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10MB ~
120MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">　</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager모니터링, 진단리포트</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME/repository/monitoringDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7일</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">자동삭제</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager진단통계</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME/repository/monitoringDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">영구</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1MB 이하</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">　</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager백업파일</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME/repository/backup/lena-manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">영구</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300MB
이하</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">　</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager Server 템플릿</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME/repository/container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">영구</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10MB /
Service Cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Cluster 개수에 따라 판단</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager로그</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME/logs/lena-manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30일</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10MB ~ 100MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">　</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Agent로그</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME/logs/lena-agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30일</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">자동삭제</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installer로그</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LENA_HOME/logs/lena-installer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">영구</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1MB 이하</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">　</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">서버인스턴스로그</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">서버인스턴스설치경로<br>
LENA_HOME/servers/server_id/logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">영구</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">부하에 따라 판단</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">경로변경가능</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_was_image_os_참조자료"><a class="link" href="#_was_image_os_참조자료">8.7. WAS Image OS 참조자료</a></h3>
<div class="paragraph">
<p>타 WAS 솔루션의 이미지는 다음과 같은 OS 를 사용한다.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. 타 WAS 솔루션 이미지 사용 현황 (2020년 기준)</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">WAS Image</th>
<th class="tableblock halign-left valign-top">OS Image</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jboss/<strong>wildfly</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>centos</strong>:7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">open-<strong>liberty</strong>:full-java8-openj9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>debian</strong>:buster<br>
(from adoptopenjdk/openjdk8-openj9)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">store/oracle/<strong>weblogic</strong>:12.2.1.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Oracle Linux</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ibmcom/<strong>websphere</strong>-traditional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ubuntu</strong>:16.04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tomcat 기본 이미지<br>
예) tomcat:9-jdk8</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>기본 Image Tag는 openJdk 기본 Tag</p>
</div>
<div class="paragraph">
<p>FROM openjdk:8-jdk
(FROM <strong>debian</strong>:buster)</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>연락처</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>담당부서</strong> : LG CNS 시스템솔루션사업팀</p>
</li>
<li>
<p><strong>주소</strong> : 서울특별시 강서구 마곡중앙10로 10 엘지사이언스파크 E13 [07796]</p>
</li>
<li>
<p><strong>전화</strong> : (02) 2099-6136</p>
</li>
<li>
<p><strong>이메일</strong> : <a href="mailto:lena-support@lgcns.com">lena-support@lgcns.com</a></p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.5.0.1<br>
Last updated 2021-07-27 14:39:34 +0900
</div>
</div>
</body>
</html>